{"remainingRequest":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/babel-loader/lib/index.js!/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/eslint-loader/index.js??ref--13-0!/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/StoryFormatParser.js","dependencies":[{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/StoryFormatParser.js","mtime":1604692362843},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubGFzdC1pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiL1VzZXJzL2p1c3Rpbnd1L0Rlc2t0b3AvR2l0bGFiX015VGFsZS9teXRhbGUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siKTsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCIvVXNlcnMvanVzdGlud3UvRGVza3RvcC9HaXRsYWJfTXlUYWxlL215dGFsZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpOwoKdmFyIFN0b3J5Rm9ybWF0ID0gcmVxdWlyZSgnLi9TdG9yeUZvcm1hdC5qcycpOwovKioKICogQGNsYXNzIFN0b3J5Rm9ybWF0UGFyc2VyCiAqIEBtb2R1bGUgU3RvcnlGb3JtYXRQYXJzZXIKICovCgoKdmFyIFN0b3J5Rm9ybWF0UGFyc2VyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAidXNlIHN0cmljdCI7CgogIC8qKgogICAqIEBmdW5jdGlvbiBTdG9yeUZvcm1hdFBhcnNlcgogICAqIEBjbGFzcwogICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50cyAtIFN0b3J5IEZvcm1hdCBmaWxlIHRvIHJlYWQKICAgKi8KICBmdW5jdGlvbiBTdG9yeUZvcm1hdFBhcnNlcigpIHsKICAgIHZhciBjb250ZW50cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyAnOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdG9yeUZvcm1hdFBhcnNlcik7CgogICAgdGhpcy5zdG9yeWZvcm1hdCA9IG51bGw7CiAgICB0aGlzLnBhcnNlKGNvbnRlbnRzKTsKICB9CiAgLyoqCiAgICogUGFyc2UgYSBTdG9yeSBGb3JtYXQgZmlsZQogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGUgLSBGaWxlIHRvIHJlYWQKICAgKiBAcmV0dXJucyB7dm9pZH0KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhTdG9yeUZvcm1hdFBhcnNlciwgW3sKICAgIGtleTogInBhcnNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZShjb250ZW50cykgewogICAgICAvLyBIYXJsb3dlIGhhcyBtYWxmb3JtZWQgSlNPTiwgc28gd2UgaGF2ZSB0byB0ZXN0IGZvciBpdAogICAgICB2YXIgaGFybG93ZVBvc2l0aW9uID0gY29udGVudHMuaW5kZXhPZignaGFybG93ZScpOwoKICAgICAgaWYgKGhhcmxvd2VQb3NpdGlvbiAhPT0gLTEpIHsKICAgICAgICAvLyBUaGUgJ3NldHVwJyBwcm9wZXJ0eSBpcyBtYWxmb3JtZWQKICAgICAgICB2YXIgc2V0dXBQb3NpdGlvbiA9IGNvbnRlbnRzLmxhc3RJbmRleE9mKCcsInNldHVwIjogZnVuY3Rpb24nKTsKICAgICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnNsaWNlKDAsIHNldHVwUG9zaXRpb24pICsgJ30nOwogICAgICB9CgogICAgICB2YXIgb3BlbmluZ0N1cmx5QnJhY2tldFBvc2l0aW9uID0gY29udGVudHMuaW5kZXhPZigneycpOwogICAgICB2YXIgY2xvc2luZ0N1cmx5QnJhY2tldFBvc2l0aW9uID0gY29udGVudHMubGFzdEluZGV4T2YoJ30nKTsKCiAgICAgIGlmIChvcGVuaW5nQ3VybHlCcmFja2V0UG9zaXRpb24gIT09IC0xICYmIGNsb3NpbmdDdXJseUJyYWNrZXRQb3NpdGlvbiAhPT0gLTEpIHsKICAgICAgICAvLyBTbGljZSBvdXQgdGhlIEpTT04KICAgICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnNsaWNlKG9wZW5pbmdDdXJseUJyYWNrZXRQb3NpdGlvbiwgY2xvc2luZ0N1cmx5QnJhY2tldFBvc2l0aW9uICsgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gZmluZCBUd2luZTIgSlNPTiBjaHVuayEnKTsKICAgICAgfQoKICAgICAgdmFyIGpzb25Db250ZW50ID0gJyc7CgogICAgICB0cnkgewogICAgICAgIGpzb25Db250ZW50ID0gSlNPTi5wYXJzZShjb250ZW50cyk7CiAgICAgIH0gY2F0Y2ggKGV2ZW50KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gcGFyc2UgVHdpbmUyIEpTT04gY2h1bmshJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuc3Rvcnlmb3JtYXQgPSBuZXcgU3RvcnlGb3JtYXQoanNvbkNvbnRlbnQpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN0b3J5Rm9ybWF0UGFyc2VyOwp9KCk7Cgptb2R1bGUuZXhwb3J0cyA9IFN0b3J5Rm9ybWF0UGFyc2VyOw=="},{"version":3,"sources":["/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/StoryFormatParser.js"],"names":["StoryFormat","require","StoryFormatParser","contents","storyformat","parse","harlowePosition","indexOf","setupPosition","lastIndexOf","slice","openingCurlyBracketPosition","closingCurlyBracketPosition","Error","jsonContent","JSON","event","module","exports"],"mappings":";;;;;;;;;;AAAA,IAAMA,WAAW,GAAGC,OAAO,CAAC,kBAAD,CAA3B;AACA;;;;;;IAIMC,iB;;;AACL;;;;;AAKA,+BAA4B;AAAA,QAAhBC,QAAgB,uEAAL,GAAK;;AAAA;;AAC3B,SAAKC,WAAL,GAAmB,IAAnB;AAEA,SAAKC,KAAL,CAAWF,QAAX;AACA;AAED;;;;;;;;;;0BAMMA,Q,EAAU;AACf;AACA,UAAMG,eAAe,GAAGH,QAAQ,CAACI,OAAT,CAAiB,SAAjB,CAAxB;;AAEA,UAAID,eAAe,KAAK,CAAC,CAAzB,EAA4B;AAC3B;AACA,YAAME,aAAa,GAAGL,QAAQ,CAACM,WAAT,CAAqB,oBAArB,CAAtB;AACAN,QAAAA,QAAQ,GAAGA,QAAQ,CAACO,KAAT,CAAe,CAAf,EAAkBF,aAAlB,IAAmC,GAA9C;AACA;;AAED,UAAMG,2BAA2B,GAAGR,QAAQ,CAACI,OAAT,CAAiB,GAAjB,CAApC;AACA,UAAMK,2BAA2B,GAAGT,QAAQ,CAACM,WAAT,CAAqB,GAArB,CAApC;;AAEA,UAAIE,2BAA2B,KAAK,CAAC,CAAjC,IAAsCC,2BAA2B,KAAK,CAAC,CAA3E,EAA8E;AAC7E;AACAT,QAAAA,QAAQ,GAAGA,QAAQ,CAACO,KAAT,CAAeC,2BAAf,EAA4CC,2BAA2B,GAAG,CAA1E,CAAX;AACA,OAHD,MAGO;AACN,cAAM,IAAIC,KAAJ,CAAU,mCAAV,CAAN;AACA;;AAED,UAAIC,WAAW,GAAG,EAAlB;;AAEA,UAAI;AACHA,QAAAA,WAAW,GAAGC,IAAI,CAACV,KAAL,CAAWF,QAAX,CAAd;AACA,OAFD,CAEE,OAAOa,KAAP,EAAc;AACf,cAAM,IAAIH,KAAJ,CAAU,oCAAV,CAAN;AACA;;AAED,WAAKT,WAAL,GAAmB,IAAIJ,WAAJ,CAAgBc,WAAhB,CAAnB;AACA;;;;;;AAGFG,MAAM,CAACC,OAAP,GAAiBhB,iBAAjB","sourcesContent":["const StoryFormat = require('./StoryFormat.js');\n/**\n * @class StoryFormatParser\n * @module StoryFormatParser\n */\nclass StoryFormatParser {\n\t/**\n\t * @function StoryFormatParser\n\t * @class\n\t * @param {string} contents - Story Format file to read\n\t */\n\tconstructor(contents = ' ') {\n\t\tthis.storyformat = null;\n\n\t\tthis.parse(contents);\n\t}\n\n\t/**\n\t * Parse a Story Format file\n\t *\n\t * @param {string} file - File to read\n\t * @returns {void}\n\t */\n\tparse(contents) {\n\t\t// Harlowe has malformed JSON, so we have to test for it\n\t\tconst harlowePosition = contents.indexOf('harlowe');\n\n\t\tif (harlowePosition !== -1) {\n\t\t\t// The 'setup' property is malformed\n\t\t\tconst setupPosition = contents.lastIndexOf(',\"setup\": function');\n\t\t\tcontents = contents.slice(0, setupPosition) + '}';\n\t\t}\n\n\t\tconst openingCurlyBracketPosition = contents.indexOf('{');\n\t\tconst closingCurlyBracketPosition = contents.lastIndexOf('}');\n\n\t\tif (openingCurlyBracketPosition !== -1 && closingCurlyBracketPosition !== -1) {\n\t\t\t// Slice out the JSON\n\t\t\tcontents = contents.slice(openingCurlyBracketPosition, closingCurlyBracketPosition + 1);\n\t\t} else {\n\t\t\tthrow new Error('Unable to find Twine2 JSON chunk!');\n\t\t}\n\n\t\tlet jsonContent = '';\n\n\t\ttry {\n\t\t\tjsonContent = JSON.parse(contents);\n\t\t} catch (event) {\n\t\t\tthrow new Error('Unable to parse Twine2 JSON chunk!');\n\t\t}\n\n\t\tthis.storyformat = new StoryFormat(jsonContent);\n\t}\n}\n\nmodule.exports = StoryFormatParser;\n"]}]}