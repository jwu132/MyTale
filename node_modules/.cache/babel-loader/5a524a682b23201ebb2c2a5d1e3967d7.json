{"remainingRequest":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js!/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js??ref--13-0!/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/StoryFormatParser.js","dependencies":[{"path":"/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/StoryFormatParser.js","mtime":1604692362843},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubGFzdC1pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiL1VzZXJzL2p1c3Rpbnd1L0Rlc2t0b3Avc3RvcnlfcGVyc29uYWxpemF0aW9uX3N5c3RlbS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoIi9Vc2Vycy9qdXN0aW53dS9EZXNrdG9wL3N0b3J5X3BlcnNvbmFsaXphdGlvbl9zeXN0ZW0vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKTsKCnZhciBTdG9yeUZvcm1hdCA9IHJlcXVpcmUoJy4vU3RvcnlGb3JtYXQuanMnKTsKLyoqCiAqIEBjbGFzcyBTdG9yeUZvcm1hdFBhcnNlcgogKiBAbW9kdWxlIFN0b3J5Rm9ybWF0UGFyc2VyCiAqLwoKCnZhciBTdG9yeUZvcm1hdFBhcnNlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgInVzZSBzdHJpY3QiOwoKICAvKioKICAgKiBAZnVuY3Rpb24gU3RvcnlGb3JtYXRQYXJzZXIKICAgKiBAY2xhc3MKICAgKiBAcGFyYW0ge3N0cmluZ30gY29udGVudHMgLSBTdG9yeSBGb3JtYXQgZmlsZSB0byByZWFkCiAgICovCiAgZnVuY3Rpb24gU3RvcnlGb3JtYXRQYXJzZXIoKSB7CiAgICB2YXIgY29udGVudHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcgJzsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RvcnlGb3JtYXRQYXJzZXIpOwoKICAgIHRoaXMuc3Rvcnlmb3JtYXQgPSBudWxsOwogICAgdGhpcy5wYXJzZShjb250ZW50cyk7CiAgfQogIC8qKgogICAqIFBhcnNlIGEgU3RvcnkgRm9ybWF0IGZpbGUKICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlIC0gRmlsZSB0byByZWFkCiAgICogQHJldHVybnMge3ZvaWR9CiAgICovCgoKICBfY3JlYXRlQ2xhc3MoU3RvcnlGb3JtYXRQYXJzZXIsIFt7CiAgICBrZXk6ICJwYXJzZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2UoY29udGVudHMpIHsKICAgICAgLy8gSGFybG93ZSBoYXMgbWFsZm9ybWVkIEpTT04sIHNvIHdlIGhhdmUgdG8gdGVzdCBmb3IgaXQKICAgICAgdmFyIGhhcmxvd2VQb3NpdGlvbiA9IGNvbnRlbnRzLmluZGV4T2YoJ2hhcmxvd2UnKTsKCiAgICAgIGlmIChoYXJsb3dlUG9zaXRpb24gIT09IC0xKSB7CiAgICAgICAgLy8gVGhlICdzZXR1cCcgcHJvcGVydHkgaXMgbWFsZm9ybWVkCiAgICAgICAgdmFyIHNldHVwUG9zaXRpb24gPSBjb250ZW50cy5sYXN0SW5kZXhPZignLCJzZXR1cCI6IGZ1bmN0aW9uJyk7CiAgICAgICAgY29udGVudHMgPSBjb250ZW50cy5zbGljZSgwLCBzZXR1cFBvc2l0aW9uKSArICd9JzsKICAgICAgfQoKICAgICAgdmFyIG9wZW5pbmdDdXJseUJyYWNrZXRQb3NpdGlvbiA9IGNvbnRlbnRzLmluZGV4T2YoJ3snKTsKICAgICAgdmFyIGNsb3NpbmdDdXJseUJyYWNrZXRQb3NpdGlvbiA9IGNvbnRlbnRzLmxhc3RJbmRleE9mKCd9Jyk7CgogICAgICBpZiAob3BlbmluZ0N1cmx5QnJhY2tldFBvc2l0aW9uICE9PSAtMSAmJiBjbG9zaW5nQ3VybHlCcmFja2V0UG9zaXRpb24gIT09IC0xKSB7CiAgICAgICAgLy8gU2xpY2Ugb3V0IHRoZSBKU09OCiAgICAgICAgY29udGVudHMgPSBjb250ZW50cy5zbGljZShvcGVuaW5nQ3VybHlCcmFja2V0UG9zaXRpb24sIGNsb3NpbmdDdXJseUJyYWNrZXRQb3NpdGlvbiArIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGZpbmQgVHdpbmUyIEpTT04gY2h1bmshJyk7CiAgICAgIH0KCiAgICAgIHZhciBqc29uQ29udGVudCA9ICcnOwoKICAgICAgdHJ5IHsKICAgICAgICBqc29uQ29udGVudCA9IEpTT04ucGFyc2UoY29udGVudHMpOwogICAgICB9IGNhdGNoIChldmVudCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIHBhcnNlIFR3aW5lMiBKU09OIGNodW5rIScpOwogICAgICB9CgogICAgICB0aGlzLnN0b3J5Zm9ybWF0ID0gbmV3IFN0b3J5Rm9ybWF0KGpzb25Db250ZW50KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBTdG9yeUZvcm1hdFBhcnNlcjsKfSgpOwoKbW9kdWxlLmV4cG9ydHMgPSBTdG9yeUZvcm1hdFBhcnNlcjs="},{"version":3,"sources":["/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/StoryFormatParser.js"],"names":["StoryFormat","require","StoryFormatParser","contents","storyformat","parse","harlowePosition","indexOf","setupPosition","lastIndexOf","slice","openingCurlyBracketPosition","closingCurlyBracketPosition","Error","jsonContent","JSON","event","module","exports"],"mappings":";;;;;;;;;;AAAA,IAAMA,WAAW,GAAGC,OAAO,CAAC,kBAAD,CAA3B;AACA;;;;;;IAIMC,iB;;;AACL;;;;;AAKA,+BAA4B;AAAA,QAAhBC,QAAgB,uEAAL,GAAK;;AAAA;;AAC3B,SAAKC,WAAL,GAAmB,IAAnB;AAEA,SAAKC,KAAL,CAAWF,QAAX;AACA;AAED;;;;;;;;;;0BAMMA,Q,EAAU;AACf;AACA,UAAMG,eAAe,GAAGH,QAAQ,CAACI,OAAT,CAAiB,SAAjB,CAAxB;;AAEA,UAAID,eAAe,KAAK,CAAC,CAAzB,EAA4B;AAC3B;AACA,YAAME,aAAa,GAAGL,QAAQ,CAACM,WAAT,CAAqB,oBAArB,CAAtB;AACAN,QAAAA,QAAQ,GAAGA,QAAQ,CAACO,KAAT,CAAe,CAAf,EAAkBF,aAAlB,IAAmC,GAA9C;AACA;;AAED,UAAMG,2BAA2B,GAAGR,QAAQ,CAACI,OAAT,CAAiB,GAAjB,CAApC;AACA,UAAMK,2BAA2B,GAAGT,QAAQ,CAACM,WAAT,CAAqB,GAArB,CAApC;;AAEA,UAAIE,2BAA2B,KAAK,CAAC,CAAjC,IAAsCC,2BAA2B,KAAK,CAAC,CAA3E,EAA8E;AAC7E;AACAT,QAAAA,QAAQ,GAAGA,QAAQ,CAACO,KAAT,CAAeC,2BAAf,EAA4CC,2BAA2B,GAAG,CAA1E,CAAX;AACA,OAHD,MAGO;AACN,cAAM,IAAIC,KAAJ,CAAU,mCAAV,CAAN;AACA;;AAED,UAAIC,WAAW,GAAG,EAAlB;;AAEA,UAAI;AACHA,QAAAA,WAAW,GAAGC,IAAI,CAACV,KAAL,CAAWF,QAAX,CAAd;AACA,OAFD,CAEE,OAAOa,KAAP,EAAc;AACf,cAAM,IAAIH,KAAJ,CAAU,oCAAV,CAAN;AACA;;AAED,WAAKT,WAAL,GAAmB,IAAIJ,WAAJ,CAAgBc,WAAhB,CAAnB;AACA;;;;;;AAGFG,MAAM,CAACC,OAAP,GAAiBhB,iBAAjB","sourcesContent":["const StoryFormat = require('./StoryFormat.js');\n/**\n * @class StoryFormatParser\n * @module StoryFormatParser\n */\nclass StoryFormatParser {\n\t/**\n\t * @function StoryFormatParser\n\t * @class\n\t * @param {string} contents - Story Format file to read\n\t */\n\tconstructor(contents = ' ') {\n\t\tthis.storyformat = null;\n\n\t\tthis.parse(contents);\n\t}\n\n\t/**\n\t * Parse a Story Format file\n\t *\n\t * @param {string} file - File to read\n\t * @returns {void}\n\t */\n\tparse(contents) {\n\t\t// Harlowe has malformed JSON, so we have to test for it\n\t\tconst harlowePosition = contents.indexOf('harlowe');\n\n\t\tif (harlowePosition !== -1) {\n\t\t\t// The 'setup' property is malformed\n\t\t\tconst setupPosition = contents.lastIndexOf(',\"setup\": function');\n\t\t\tcontents = contents.slice(0, setupPosition) + '}';\n\t\t}\n\n\t\tconst openingCurlyBracketPosition = contents.indexOf('{');\n\t\tconst closingCurlyBracketPosition = contents.lastIndexOf('}');\n\n\t\tif (openingCurlyBracketPosition !== -1 && closingCurlyBracketPosition !== -1) {\n\t\t\t// Slice out the JSON\n\t\t\tcontents = contents.slice(openingCurlyBracketPosition, closingCurlyBracketPosition + 1);\n\t\t} else {\n\t\t\tthrow new Error('Unable to find Twine2 JSON chunk!');\n\t\t}\n\n\t\tlet jsonContent = '';\n\n\t\ttry {\n\t\t\tjsonContent = JSON.parse(contents);\n\t\t} catch (event) {\n\t\t\tthrow new Error('Unable to parse Twine2 JSON chunk!');\n\t\t}\n\n\t\tthis.storyformat = new StoryFormat(jsonContent);\n\t}\n}\n\nmodule.exports = StoryFormatParser;\n"]}]}