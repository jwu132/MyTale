{"remainingRequest":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js!/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js??ref--13-0!/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/Page.js","dependencies":[{"path":"/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/Page.js","mtime":1604692362842},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giKTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCIvVXNlcnMvanVzdGlud3UvRGVza3RvcC9zdG9yeV9wZXJzb25hbGl6YXRpb25fc3lzdGVtL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIik7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiL1VzZXJzL2p1c3Rpbnd1L0Rlc2t0b3Avc3RvcnlfcGVyc29uYWxpemF0aW9uX3N5c3RlbS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpOwoKLyoqCiAqIEBjbGFzcyBQYWdlCiAqIEBtb2R1bGUgUGFnZQogKi8KdmFyIFBhZ2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgLyoqCiAgICogQGZ1bmN0aW9uIFBhZ2UKICAgKiBAY2xhc3MgCiAgICogQHBhcmFtIHBhc3NhZ2UgLSBQYXNzYWdlIE9iamVjdFwKICAgKi8KICBmdW5jdGlvbiBQYWdlKGRpc3BQYXNzYWdlLCBsaW5rUGFzc2FnZSwgdGhlbWUsIHBhZ2VOdW1iZXIsIG1ldGFkYXRhKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGFnZSk7CgogICAgdGhpcy5kaXNwUGFzc2FnZSA9IGRpc3BQYXNzYWdlOwogICAgdGhpcy5saW5rUGFzc2FnZSA9IGxpbmtQYXNzYWdlOwogICAgdGhpcy5zdG9yeSA9IG1ldGFkYXRhLnN0b3J5OwogICAgdGhpcy5wYWdlcyA9IG1ldGFkYXRhLnBhZ2VzOwogICAgdGhpcy50aGVtZSA9IHRoZW1lOwogICAgdGhpcy5wYWdlTnVtYmVyID0gcGFnZU51bWJlcjsKICAgIHRoaXMucGFnZU5hbWUgPSB0aGlzLmxpbmtQYXNzYWdlLm5hbWU7CiAgICB0aGlzLmltYWdlRmlsZXMgPSBbXTsKICAgIHRoaXMuYXVkaW9GaWxlcyA9IFtdOwogICAgdGhpcy5saW5rcyA9IFtdOwogICAgdmFyIGZvdW5kID0gZmFsc2U7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmtQYXNzYWdlLnRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRoaXMubGlua1Bhc3NhZ2UudGFnc1tpXS5pbmNsdWRlcygidGhlbWVfIikpIHsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRhZ3NbaV0gPSAidGhlbWVfIiArIHRoaXMucGFnZU51bWJlcjsKICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIWZvdW5kKSB7CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGFncy5wdXNoKCJ0aGVtZV8iICsgdGhpcy5wYWdlTnVtYmVyKTsKICAgIH0KCiAgICB0aGlzLnJlcGFyc2VMaW5rcygpOwogIH0KICAvKioKICAgKiBJbnNlcnRzIGEgbGluayB0byB0aGUgYm90dG9tIG9mIHRoZSBwYWdlCiAgICogCiAgICogQGZ1bmN0aW9uIGFkZExpbmsKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSAKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhQYWdlLCBbewogICAga2V5OiAiYWRkTGluayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTGluayhuYW1lKSB7CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCArPSAiXG5bWyIgKyBuYW1lICsgIl1dIjsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgaW5zdGFuY2VzIG9mIGEgbGluayBmcm9tIGEgcGFnZS4KICAgICAqIAogICAgICogQGZ1bmN0aW9uIHJlbW92ZUxpbmsKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUxpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUxpbmsobmFtZSkgewogICAgICB2YXIgcHJvY2VzcyA9IGZhbHNlOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMubGlua3NbaV0ubmFtZSA9PSBuYW1lKSB7CiAgICAgICAgICBwcm9jZXNzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChwcm9jZXNzKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMubGlua1Bhc3NhZ2UudGV4dDsKICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoIltbIik7CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc291cmNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoc291cmNlW2pdLmluY2x1ZGVzKCJdXSIpKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2VTcGxpdCA9IHNvdXJjZVtqXS5zcGxpdCgiXV0iKTsKICAgICAgICAgICAgdmFyIHBhc3NhZ2VOYW1lID0gc291cmNlU3BsaXRbMF07IC8vY29uc29sZS5sb2cocGFzc2FnZU5hbWUpOwoKICAgICAgICAgICAgdmFyIGNvbnRhaW5zID0gcGFzc2FnZU5hbWUuaW5jbHVkZXMobmFtZSk7CgogICAgICAgICAgICBpZiAoIWNvbnRhaW5zKSB7CiAgICAgICAgICAgICAgc291cmNlU3BsaXRbMF0gPSBwYXNzYWdlTmFtZTsKICAgICAgICAgICAgICBzb3VyY2Vbal0gPSBzb3VyY2VTcGxpdC5qb2luKCJdXSIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNvdXJjZVNwbGl0WzBdID0gIiI7CiAgICAgICAgICAgICAgc291cmNlW2pdID0gc291cmNlU3BsaXQuam9pbigiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNvdXJjZSA9IHNvdXJjZS5maWx0ZXIoZnVuY3Rpb24gKHN0cikgewogICAgICAgICAgcmV0dXJuIHN0ciAhPSAiIjsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSBzb3VyY2Uuam9pbigiW1siKTsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSB0aGlzLmxpbmtQYXNzYWdlLnRleHQudHJpbSgpOwogICAgICAgIHRoaXMudmFsaWRhdGUoKTsKICAgICAgICB0aGlzLnJlcGFyc2VMaW5rcygpOwogICAgICAgIHRoaXMucmVwYXJzZU1lZGlhKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXBhcnNlTWVkaWEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGFyc2VNZWRpYShpbWFnZVZhck1hcCwgYXVkaW9WYXJNYXApIHsKICAgICAgdGhpcy5pbWFnZUZpbGVzID0gW107CiAgICAgIHRoaXMuYXVkaW9GaWxlcyA9IFtdOwogICAgICB2YXIgc29ydGVkS2V5cyA9IFtdOwogICAgICBpbWFnZVZhck1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgc29ydGVkS2V5cy5wdXNoKGtleSk7CiAgICAgIH0pOwogICAgICBhdWRpb1Zhck1hcC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgc29ydGVkS2V5cy5wdXNoKGtleSk7CiAgICAgIH0pOwogICAgICBzb3J0ZWRLZXlzID0gc29ydGVkS2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIubGVuZ3RoIC0gYS5sZW5ndGg7CiAgICAgIH0pOwogICAgICB2YXIgc291cmNlID0gdGhpcy5saW5rUGFzc2FnZS50ZXh0OwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0ZWRLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHNvdXJjZS5pbmNsdWRlcyhzb3J0ZWRLZXlzW2ldKSkgewogICAgICAgICAgaWYgKGF1ZGlvVmFyTWFwLmhhcyhzb3J0ZWRLZXlzW2ldKSkgewogICAgICAgICAgICB0aGlzLmF1ZGlvRmlsZXMucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogc29ydGVkS2V5c1tpXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VWYXJNYXAuaGFzKHNvcnRlZEtleXNbaV0pKSB7CiAgICAgICAgICAgIHRoaXMuaW1hZ2VGaWxlcy5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiBzb3J0ZWRLZXlzW2ldCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHdoaWxlIChzb3VyY2UuaW5jbHVkZXMoc29ydGVkS2V5c1tpXSkpIHsKICAgICAgICAgICAgc291cmNlID0gc291cmNlLnJlcGxhY2Uoc29ydGVkS2V5c1tpXSwgIiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgbGlua3MgZm91bmQgaW4gdGhlIHBhc3NhZ2UKICAgICAqIEBmdW5jdGlvbiByZXBhcnNlTGlua3MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXBhcnNlTGlua3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGFyc2VMaW5rcygpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMubGlua1Bhc3NhZ2UudGV4dDsKICAgICAgc291cmNlID0gc291cmNlLnNwbGl0KCJbWyIpOwogICAgICB0aGlzLmxpbmtzID0gW107CiAgICAgIHZhciBsaW5rc0FkZGVkID0gW107CgogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNvdXJjZS5sZW5ndGg7IGorKykgewogICAgICAgIGlmIChzb3VyY2Vbal0uaW5jbHVkZXMoIl1dIikpIHsKICAgICAgICAgIHZhciBwYXNzYWdlTmFtZSA9IHNvdXJjZVtqXS5zcGxpdCgiXV0iKVswXTsgLy9jb25zb2xlLmxvZyhwYXNzYWdlTmFtZSk7CgogICAgICAgICAgaWYgKHBhc3NhZ2VOYW1lLmluY2x1ZGVzKCItJmd0OyIpKSB7CiAgICAgICAgICAgIHBhc3NhZ2VOYW1lID0gcGFzc2FnZU5hbWUuc3BsaXQoIi0mZ3Q7IilbMV07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLnN0b3J5LmdldFN0b3J5UGFzc2FnZXMoKS5sZW5ndGg7IGsrKykgewogICAgICAgICAgICBpZiAodGhpcy5zdG9yeS5nZXRTdG9yeVBhc3NhZ2VzKClba10ubmFtZSA9PSBwYXNzYWdlTmFtZSkgewogICAgICAgICAgICAgIGlmICghbGlua3NBZGRlZC5pbmNsdWRlcyhwYXNzYWdlTmFtZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMubGlua3MucHVzaCh7CiAgICAgICAgICAgICAgICAgIG5hbWU6IHBhc3NhZ2VOYW1lLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogawogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsaW5rc0FkZGVkLnB1c2gocGFzc2FnZU5hbWUpOwogICAgICAgICAgICAgIH0gLy9jb25zb2xlLmxvZygiUHVzaGVkOiIgKyBKU09OLnN0cmluZ2lmeSh7bmFtZTogcGFzc2FnZU5hbWUsIGxvY2F0aW9uOiBrfSkpOwoKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXBsYWNlcyB0aGUgbGlua3Mgd2l0aGluIHRoZSBzdG9yeQogICAgICogCiAgICAgKiBAZnVuY3Rpb24gcmVwbGFjZUxpbmtzCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXBsYWNlTGlua3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2VMaW5rcyhldmVudCkgewogICAgICB2YXIgcHJvY2VzcyA9IGZhbHNlOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMubGlua3NbaV0ubmFtZSA9PSBldmVudC5wcmV2TmFtZSkgewogICAgICAgICAgcHJvY2VzcyA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocHJvY2VzcykgewogICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmxpbmtQYXNzYWdlLnRleHQ7CiAgICAgICAgc291cmNlID0gc291cmNlLnNwbGl0KCJbWyIpOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNvdXJjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKHNvdXJjZVtqXS5pbmNsdWRlcygiXV0iKSkgewogICAgICAgICAgICB2YXIgc291cmNlU3BsaXQgPSBzb3VyY2Vbal0uc3BsaXQoIl1dIik7CiAgICAgICAgICAgIHZhciBwYXNzYWdlTmFtZSA9IHNvdXJjZVNwbGl0WzBdOyAvL2NvbnNvbGUubG9nKHBhc3NhZ2VOYW1lKTsKCiAgICAgICAgICAgIHZhciBzcGxpdCA9IGZhbHNlOwogICAgICAgICAgICB2YXIgc3BsaXRBcnI7CgogICAgICAgICAgICBpZiAocGFzc2FnZU5hbWUuaW5jbHVkZXMoIi0mZ3Q7IikpIHsKICAgICAgICAgICAgICBzcGxpdEFyciA9IHBhc3NhZ2VOYW1lLnNwbGl0KCItJmd0OyIpOwogICAgICAgICAgICAgIHBhc3NhZ2VOYW1lID0gc3BsaXRBcnJbMV07CiAgICAgICAgICAgICAgc3BsaXQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVidWlsdFRleHQgPSAiIjsKICAgICAgICAgICAgdmFyIGNvbnRhaW5zID0gZXZlbnQubmV3TmFtZSAhPSAiIjsKCiAgICAgICAgICAgIGlmIChwYXNzYWdlTmFtZSA9PSBldmVudC5wcmV2TmFtZSkgewogICAgICAgICAgICAgIGlmIChzcGxpdCkgewogICAgICAgICAgICAgICAgc3BsaXRBcnJbMV0gPSBldmVudC5uZXdOYW1lOwogICAgICAgICAgICAgICAgcmVidWlsdFRleHQgPSBzcGxpdEFyci5qb2luKCItJmd0OyIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWJ1aWx0VGV4dCA9IGV2ZW50Lm5ld05hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29udGFpbnMpIHsKICAgICAgICAgICAgICAgIHNvdXJjZVNwbGl0WzBdID0gcmVidWlsdFRleHQ7CiAgICAgICAgICAgICAgICBzb3VyY2Vbal0gPSBzb3VyY2VTcGxpdC5qb2luKCJdXSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzb3VyY2VTcGxpdFswXSA9ICIiOwogICAgICAgICAgICAgICAgc291cmNlW2pdID0gc291cmNlU3BsaXQuam9pbigiIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzb3VyY2UgPSBzb3VyY2UuZmlsdGVyKGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICAgIHJldHVybiBzdHIgIT0gIiI7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5saW5rUGFzc2FnZS50ZXh0ID0gc291cmNlLmpvaW4oIltbIik7CiAgICAgICAgdGhpcy5saW5rUGFzc2FnZS50ZXh0ID0gdGhpcy5saW5rUGFzc2FnZS50ZXh0LnRyaW0oKTsKICAgICAgICB0aGlzLnZhbGlkYXRlKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIHZhcmlhYmxlcyBhcyBkaWN0YXRlZCBieSB0aGUgZXZlbnQKICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IAogICAgICogQHBhcmFtIHtNYXB9IHZhcmlhYmxlcyAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXBsYWNlVmFyaWFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2VWYXJpYWJsZShldmVudCwgdmFyaWFibGVzKSB7CiAgICAgIHZhciBzb3J0ZWRLZXlzID0gW107CiAgICAgIHZhcmlhYmxlcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgc29ydGVkS2V5cy5wdXNoKGtleSk7CiAgICAgIH0pOwogICAgICB2YXIgcHJvY2VzcyA9IHNvcnRlZEtleXMuaW5jbHVkZXMoZXZlbnQucHJldk5hbWUpOwoKICAgICAgaWYgKHByb2Nlc3MpIHsKICAgICAgICBzb3J0ZWRLZXlzID0gc29ydGVkS2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSB0aGlzLnJlY3Vyc2l2ZVJlcGxhY2UoZXZlbnQsIHNvcnRlZEtleXMsIHRoaXMubGlua1Bhc3NhZ2UudGV4dCwgMCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIHRoZSB2YXJpYWJsZXMgcmVjdXJzaXZlbHkgdGhhdCBuZWVkIHRvIGJlIHJlcGxhY2VkLgogICAgICogCiAgICAgKiBAZnVuY3Rpb24gcmVjdXJzaXZlUmVwbGFjZQogICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgCiAgICAgKiBAcGFyYW0ge0FycmF5fSBzb3J0ZWRLZXlzIAogICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVjdXJzaXZlUmVwbGFjZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVjdXJzaXZlUmVwbGFjZShldmVudCwgc29ydGVkS2V5cywgdGV4dCwgaW5kZXgpIHsKICAgICAgdmFyIGtleSA9IHNvcnRlZEtleXNbaW5kZXhdOwogICAgICB2YXIgc291cmNlID0gdGV4dC5zcGxpdChrZXkpOwoKICAgICAgaWYgKGtleSA9PSBldmVudC5wcmV2TmFtZSkgewogICAgICAgIGlmIChzb3VyY2UubGVuZ3RoID09IDEpIHsKICAgICAgICAgIHJldHVybiBzb3VyY2VbMF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc291cmNlLmpvaW4oZXZlbnQubmV3TmFtZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJldCA9ICIiOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGkgPCBzb3VyY2UubGVuZ3RoIC0gMSkgewogICAgICAgICAgICByZXQgKz0gdGhpcy5yZWN1cnNpdmVSZXBsYWNlKGV2ZW50LCBzb3J0ZWRLZXlzLCBzb3VyY2VbaV0sIGluZGV4ICsgMSkgKyBrZXk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgKz0gdGhpcy5yZWN1cnNpdmVSZXBsYWNlKGV2ZW50LCBzb3J0ZWRLZXlzLCBzb3VyY2VbaV0sIGluZGV4ICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgaW1hZ2UgdG8gcGFnZQogICAgICogCiAgICAgKiBAZnVuY3Rpb24gYWRkSW1hZ2UKICAgICAqIEBwYXJhbSB7Kn0gaW1hZ2VEYXRhCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkSW1hZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEltYWdlKGltYWdlRGF0YSkgewogICAgICB2YXIgcHJvY2VzcyA9IHRydWU7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW1hZ2VGaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmltYWdlRmlsZXNbaV0ubmFtZSA9PSBpbWFnZURhdGEubmFtZSkgewogICAgICAgICAgcHJvY2VzcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByb2Nlc3MpIHRoaXMuaW1hZ2VGaWxlcy5wdXNoKGltYWdlRGF0YSk7CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCArPSAiXG4iICsgaW1hZ2VEYXRhLm5hbWU7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYWxsIG9jY3VyZW5jZXMgb2YgaW1hZ2UgZnJvbSBwYWdlCiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiByZW1vdmVJbWFnZQogICAgICogQHBhcmFtIHsqfSBpbWFnZURhdGEgCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlSW1hZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUltYWdlKGltYWdlRGF0YSkgewogICAgICB0aGlzLnJlbW92ZUtleUZyb21UZXh0KHRoaXMuaW1hZ2VGaWxlcy5jb25jYXQodGhpcy5hdWRpb0ZpbGVzKSwgaW1hZ2VEYXRhLm5hbWUpOwogICAgICB0aGlzLmltYWdlRmlsZXMgPSB0aGlzLmltYWdlRmlsZXMuZmlsdGVyKGZ1bmN0aW9uIChpbWcpIHsKICAgICAgICByZXR1cm4gaW1nLm5hbWUgIT0gaW1hZ2VEYXRhLm5hbWU7CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGF1ZGlvIGZpbGUgdG8gcGFnZQogICAgICogCiAgICAgKiBAZnVuY3Rpb24gYWRkQXVkaW8KICAgICAqIEBwYXJhbSB7Kn0gYXVkaW8gCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkQXVkaW8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEF1ZGlvKGF1ZGlvRGF0YSkgewogICAgICB2YXIgcHJvY2VzcyA9IHRydWU7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXVkaW9GaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmF1ZGlvRmlsZXNbaV0ubmFtZSA9PSBhdWRpb0RhdGEubmFtZSkgewogICAgICAgICAgcHJvY2VzcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByb2Nlc3MpIHRoaXMuYXVkaW9GaWxlcy5wdXNoKGF1ZGlvRGF0YSk7CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCArPSAiXG4iICsgYXVkaW9EYXRhLm5hbWU7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYWxsIG9jY3VyZW5jZXMgb2YgYXVkaW8gZnJvbSBwYWdlCiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiByZW1vdmVBdWRpbwogICAgICogQHBhcmFtIHsqfSBhdWRpbyAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVBdWRpbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQXVkaW8oYXVkaW9EYXRhKSB7CiAgICAgIHRoaXMucmVtb3ZlS2V5RnJvbVRleHQodGhpcy5hdWRpb0ZpbGVzLmNvbmNhdCh0aGlzLmltYWdlRmlsZXMpLCBhdWRpb0RhdGEubmFtZSk7CiAgICAgIHRoaXMuYXVkaW9GaWxlcyA9IHRoaXMuYXVkaW9GaWxlcy5maWx0ZXIoZnVuY3Rpb24gKGF1ZCkgewogICAgICAgIHJldHVybiBhdWQubmFtZSAhPSBhdWRpb0RhdGEubmFtZTsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIAogICAgICogUmVtb3ZlcyBhbGwgb2NjdXJhbmNlcyBvZiAna2V5JyBmcm9tIHRleHQKICAgICAqIAogICAgICogQGZ1bmN0aW9uIHJlbW92ZUtleUZyb21UZXh0CiAgICAgKiBAcGFyYW0ge0FycmF5fSBkYXRhQXJyIAogICAgICogQHBhcmFtIHtTdHJpbmd9IGtleSAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVLZXlGcm9tVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlS2V5RnJvbVRleHQoZGF0YUFyciwga2V5KSB7CiAgICAgIHZhciBzb3J0ZWRLZXlzID0gW107CiAgICAgIGRhdGFBcnIuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBzb3J0ZWRLZXlzLnB1c2godmFsdWUubmFtZSk7CiAgICAgIH0pOwogICAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgcHJldk5hbWU6IGtleSwKICAgICAgICBuZXdOYW1lOiAiIgogICAgICB9OwogICAgICBzb3J0ZWRLZXlzID0gc29ydGVkS2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIubGVuZ3RoIC0gYS5sZW5ndGg7CiAgICAgIH0pOwogICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSB0aGlzLnJlY3Vyc2l2ZVJlcGxhY2UoZXZlbnQsIHNvcnRlZEtleXMsIHRoaXMubGlua1Bhc3NhZ2UudGV4dCwgMCk7CiAgICAgIHRoaXMudmFsaWRhdGUoKTsKICAgIH0KICAgIC8qKgogICAgICogVXNlZCB0byBkZXRlcm1pbmUgc3R5bGluZyBmb3IgdGhpcyBzdG9yeS4KICAgICAqIAogICAgICogQGZ1bmN0aW9uIGluamVjdENTU1RleHQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpbmplY3RDU1NUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbmplY3RDU1NUZXh0KCkgewogICAgICB2YXIgaW5qZWN0ID0gInR3LXN0b3J5W3RhZ3N+PSciOwogICAgICBpbmplY3QgKz0gInRoZW1lXyIgKyB0aGlzLnBhZ2VOdW1iZXIgKyAiJ117XG4iOwogICAgICBpbmplY3QgKz0gIlx0IiArIHRoaXMudGhlbWUgKyAiXG4iOwogICAgICBpbmplY3QgKz0gIn0iOwogICAgICByZXR1cm4gaW5qZWN0OwogICAgfQogICAgLyoqCiAgICAgKiBAZnVuY3Rpb24gZXh0cmFjdENTU1Byb3BlcnR5CiAgICAgKiBAcGFyYW0gcHJvcGVydHkKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHByb3BlcnR5IGRlc2NyaXB0aW9uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZXh0cmFjdENTU1Byb3BlcnR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0Q1NTUHJvcGVydHkocHJvcGVydHkpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMudGhlbWU7CiAgICAgIHZhciBzb3VyY2VBcnIgPSBzb3VyY2Uuc3BsaXQoIjsiKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlQXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHByb3AgPSBzb3VyY2VBcnJbaV0uc3BsaXQoIjoiKVswXS50cmltKCk7CiAgICAgICAgdmFyIHZhbCA9IHNvdXJjZUFycltpXS5zcGxpdCgiOiIpWzFdLnRyaW0oKTsKCiAgICAgICAgaWYgKHByb3AgPT0gcHJvcGVydHkpIHsKICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfSAvL2NvbnNvbGUubG9nKHByb3AgKyAnOicgKyB2YWwpOwoKICAgICAgfQoKICAgICAgcmV0dXJuICJQcm9wZXJ0eSBub3QgZm91bmQiOwogICAgfQogICAgLyoqCiAgICAgKiBWYWxpZGF0ZXMgYW5kIGNsZWFucyB0aGUgbGluayB0ZXh0CiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiB2YWxpZGF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogInZhbGlkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZSgpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMubGlua1Bhc3NhZ2UudGV4dC5zcGxpdCgiW1siKTsKICAgICAgdmFyIHJlYnVpbGQgPSAiIjsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgIHJlYnVpbGQgKz0gc291cmNlW2ldOwoKICAgICAgICBpZiAoc291cmNlW2kgKyAxXS5pbmNsdWRlcygiXV0iKSkgewogICAgICAgICAgcmVidWlsZCArPSAiW1siOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVidWlsZCArPSBzb3VyY2Vbc291cmNlLmxlbmd0aCAtIDFdOwogICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSByZWJ1aWxkLnRyaW0oKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBQYWdlOwp9KCk7Cgptb2R1bGUuZXhwb3J0cyA9IFBhZ2U7"},{"version":3,"sources":["/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/Page.js"],"names":["Page","dispPassage","linkPassage","theme","pageNumber","metadata","story","pages","pageName","name","imageFiles","audioFiles","links","found","i","tags","length","includes","push","reparseLinks","text","process","source","split","j","sourceSplit","passageName","contains","join","filter","str","trim","validate","reparseMedia","imageVarMap","audioVarMap","sortedKeys","forEach","value","key","sort","a","b","has","replace","linksAdded","k","getStoryPassages","location","event","prevName","splitArr","rebuiltText","newName","variables","recursiveReplace","index","ret","imageData","removeKeyFromText","concat","img","audioData","aud","dataArr","inject","property","sourceArr","prop","val","rebuild","module","exports"],"mappings":"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","sourcesContent":["/**\n * @class Page\n * @module Page\n */\nclass Page {\n    /**\n     * @function Page\n     * @class \n     * @param passage - Passage Object\\\n     */\n\tconstructor(dispPassage, linkPassage, theme, pageNumber, metadata) {\n\t\tthis.dispPassage = dispPassage;\n\t\tthis.linkPassage = linkPassage;\n\n\t\tthis.story = metadata.story;\n\t\tthis.pages = metadata.pages;\n\n\t\tthis.theme = theme;\n\t\tthis.pageNumber = pageNumber;\n\t\tthis.pageName = this.linkPassage.name;\n\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\t\tthis.links = [];\n\n\t\tvar found = false;\n\n\t\tfor(var i = 0; i < this.linkPassage.tags.length; i++){\t\n\t\t\tif(this.linkPassage.tags[i].includes(\"theme_\")){\n\t\t\t\tthis.linkPassage.tags[i] = \"theme_\" + this.pageNumber;\n\t\t\t\tfound = true;\n\t\t\t} \n\t\t}\n\n\t\tif(!found){\n\t\t\tthis.linkPassage.tags.push(\"theme_\" + this.pageNumber);\n\t\t}\n\n\t\tthis.reparseLinks();\n\t}\n\n\t/**\n\t * Inserts a link to the bottom of the page\n\t * \n\t * @function addLink\n\t * @param {String} name \n\t */\n\taddLink(name){\n\t\tthis.linkPassage.text += \"\\n[[\" + name + \"]]\";\n\t}\n\n\t/**\n\t * Removes all instances of a link from a page.\n\t * \n\t * @function removeLink\n\t * @param {String} name \n\t */\n\tremoveLink(name){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == name){ process = true; }\n\t\t}\n\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\n\t\t\t\t\tvar contains = passageName.includes(name);\n\n\t\t\t\t\tif(!contains){\n\t\t\t\t\t\tsourceSplit[0] = passageName;\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\n\t\t\tthis.reparseLinks();\n\t\t\tthis.reparseMedia();\n\t\t}\n\t}\n\n\treparseMedia(imageVarMap, audioVarMap){\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\n\t\tvar sortedKeys = [];\n\n\t\timageVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\taudioVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t)\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\n\t\tvar source = this.linkPassage.text;\n\n\t\tfor(var i = 0; i < sortedKeys.length; i++){\n\t\t\tif(source.includes(sortedKeys[i])){\n\t\t\t\t\n\t\t\t\tif(audioVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.audioFiles.push({name: sortedKeys[i]});\n\t\t\t\t} else if(imageVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.imageFiles.push({name: sortedKeys[i]});\n\t\t\t\t}\n\n\t\t\t\twhile(source.includes(sortedKeys[i])){\n\t\t\t\t\tsource = source.replace(sortedKeys[i], \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate the links found in the passage\n\t * @function reparseLinks\n\t */\n\treparseLinks(){\n\t\tvar source = this.linkPassage.text;\n\n\t\tsource = source.split(\"[[\");\n\n\t\tthis.links = [];\n\t\tvar linksAdded = [];\n\n\t\tfor(var j = 0; j < source.length; j++){\n\t\t\tif(source[j].includes(\"]]\")){\n\t\t\t\tvar passageName = source[j].split(\"]]\")[0];\n\t\t\t\t\n\t\t\t\t//console.log(passageName);\n\n\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\tpassageName = passageName.split(\"-&gt;\")[1];\n\t\t\t\t}\n\n\t\t\t\tfor(var k = 0; k < this.story.getStoryPassages().length; k++){\n\t\t\t\t\tif(this.story.getStoryPassages()[k].name == passageName){\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!linksAdded.includes(passageName)){\n\t\t\t\t\t\t\tthis.links.push({name: passageName, location: k});\n\t\t\t\t\t\t\tlinksAdded.push(passageName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log(\"Pushed:\" + JSON.stringify({name: passageName, location: k}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Replaces the links within the story\n\t * \n\t * @function replaceLinks\n\t * @param {Event} event \n\t */\n\treplaceLinks(event){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == event.prevName){ process = true; }\n\t\t}\n\t\t\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\t\t\t\t\tvar split = false;\n\t\t\t\t\tvar splitArr;\n\n\t\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\t\tsplitArr = passageName.split(\"-&gt;\");\n\t\t\t\t\t\tpassageName = splitArr[1];\n\t\t\t\t\t\tsplit = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar rebuiltText = \"\";\n\n\t\t\t\t\tvar contains = event.newName != \"\";\n\n\t\t\t\t\tif(passageName == event.prevName){\n\t\t\t\t\t\tif(split){\n\t\t\t\t\t\t\tsplitArr[1] = event.newName;\n\t\t\t\t\t\t\trebuiltText = splitArr.join(\"-&gt;\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trebuiltText = event.newName;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(contains){\n\t\t\t\t\t\t\tsourceSplit[0] = rebuiltText;\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all variables as dictated by the event\n\t * @param {Event} event \n\t * @param {Map} variables \n\t */\n\treplaceVariable(event, variables){\n\t\tvar sortedKeys = [];\n\n\t\tvariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\t\t\n\t\tvar process = sortedKeys.includes(event.prevName);\n\t\t\n\t\tif(process){\n\t\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\n\t\t\t\n\t\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all the variables recursively that need to be replaced.\n\t * \n\t * @function recursiveReplace\n\t * @param {Event} event \n\t * @param {Array} sortedKeys \n\t * @param {String} text \n\t */\n\trecursiveReplace(event, sortedKeys, text, index){\n\t\tvar key = sortedKeys[index]; \n\t\tvar source = text.split(key);\n\t\t\n\t\tif(key == event.prevName){\n\t\t\tif(source.length == 1){\n\t\t\t\treturn source[0];\n\t\t\t}\n\n\t\t\treturn source.join(event.newName);\n\t\t} else {\n\t\t\tvar ret = \"\";\n\n\t\t\tfor(var i = 0; i < source.length; i++){\n\t\t\t\tif(i < source.length - 1){\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1) + key;\n\t\t\t\t} else {\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\t/**\n\t * Adds image to page\n\t * \n\t * @function addImage\n\t * @param {*} imageData\n\t */\n\taddImage(imageData){\n\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.imageFiles.length; i++){\n\t\t\tif(this.imageFiles[i].name == imageData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.imageFiles.push(imageData);\n\n\t\tthis.linkPassage.text += \"\\n\" + imageData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of image from page\n\t * \n\t * @function removeImage\n\t * @param {*} imageData \n\t */\n\tremoveImage(imageData){\n\n\t\tthis.removeKeyFromText(this.imageFiles.concat(this.audioFiles), imageData.name);\n\n\t\tthis.imageFiles = this.imageFiles.filter(function(img){\n\t\t\treturn img.name != imageData.name;\n\t\t});\n\t}\n\n\t/**\n\t * Adds audio file to page\n\t * \n\t * @function addAudio\n\t * @param {*} audio \n\t */\n\taddAudio(audioData){\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.audioFiles.length; i++){\n\t\t\tif(this.audioFiles[i].name == audioData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.audioFiles.push(audioData);\n\n\t\tthis.linkPassage.text += \"\\n\" + audioData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of audio from page\n\t * \n\t * @function removeAudio\n\t * @param {*} audio \n\t */\n\tremoveAudio(audioData){\n\n\t\tthis.removeKeyFromText(this.audioFiles.concat(this.imageFiles), audioData.name);\n\n\t\tthis.audioFiles = this.audioFiles.filter(function(aud){\n\t\t\treturn aud.name != audioData.name;\n\t\t});\t\t\n\t}\n\n\t/**\n\t * \n\t * Removes all occurances of 'key' from text\n\t * \n\t * @function removeKeyFromText\n\t * @param {Array} dataArr \n\t * @param {String} key \n\t */\n\tremoveKeyFromText(dataArr, key){\n\t\tvar sortedKeys = [];\n\n\t\tdataArr.forEach(\n\t\t\tfunction(value){\n\t\t\t\tsortedKeys.push(value.name);\n\t\t\t}\n\t\t);\n\n\t\tvar event = {prevName: key, newName: \"\"};\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\t\t\n\t\t\n\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\n\t\tthis.validate();\n\t}\n\n\t/**\n\t * Used to determine styling for this story.\n\t * \n\t * @function injectCSSText\n\t */\n\tinjectCSSText(){\n\t\tvar inject = \"tw-story[tags~='\";\n\t\t\tinject += \"theme_\" + this.pageNumber + \"']{\\n\";\n\t\t\tinject +=  \"\\t\" + this.theme + \"\\n\";\n\t\t\tinject += \"}\";\n\n\t\treturn inject;\n\t}\n\n\t/**\n\t * @function extractCSSProperty\n\t * @param property\n\t * @returns {String} property description\n\t */\n\n\textractCSSProperty(property){\n\t\tvar source = this.theme;\n\n\t\tvar sourceArr = source.split(\";\");\n\n\t\tfor(var i = 0; i < sourceArr.length; i++){\n\t\t\t\n\t\t\tvar prop = sourceArr[i].split(\":\")[0].trim();\n\t\t\tvar val = sourceArr[i].split(\":\")[1].trim();\n\n\t\t\tif(prop == property){\n\t\t\t\treturn val;\n\t\t\t}\n\n\t\t\t//console.log(prop + ':' + val);\n\t\t}\n\n\t\treturn \"Property not found\";\n\t}\n\t\n\t/**\n\t * Validates and cleans the link text\n\t * \n\t * @function validate\n\t */\n\tvalidate(){\n\t\tvar source = this.linkPassage.text.split(\"[[\");\n\t\tvar rebuild = \"\";\n\n\t\tfor(var i = 0; i < source.length - 1; i++){\n\t\t\t\n\t\t\trebuild += source[i];\n\n\t\t\tif(source[i + 1].includes(\"]]\")){\n\t\t\t\trebuild += \"[[\";\n\t\t\t}\n\t\t}\n\n\t\trebuild += source[source.length - 1];\n\n\t\tthis.linkPassage.text = rebuild.trim();\n\t}\n}\n\nmodule.exports = Page;\n"]}]}