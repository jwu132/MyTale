{"remainingRequest":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/babel-loader/lib/index.js!/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/eslint-loader/index.js??ref--13-0!/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/Page.js","dependencies":[{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/Page.js","mtime":1604692362842},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giKTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCIvVXNlcnMvanVzdGlud3UvRGVza3RvcC9HaXRsYWJfTXlUYWxlL215dGFsZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoIi9Vc2Vycy9qdXN0aW53dS9EZXNrdG9wL0dpdGxhYl9NeVRhbGUvbXl0YWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIik7CgovKioKICogQGNsYXNzIFBhZ2UKICogQG1vZHVsZSBQYWdlCiAqLwp2YXIgUGFnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgInVzZSBzdHJpY3QiOwoKICAvKioKICAgKiBAZnVuY3Rpb24gUGFnZQogICAqIEBjbGFzcyAKICAgKiBAcGFyYW0gcGFzc2FnZSAtIFBhc3NhZ2UgT2JqZWN0XAogICAqLwogIGZ1bmN0aW9uIFBhZ2UoZGlzcFBhc3NhZ2UsIGxpbmtQYXNzYWdlLCB0aGVtZSwgcGFnZU51bWJlciwgbWV0YWRhdGEpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQYWdlKTsKCiAgICB0aGlzLmRpc3BQYXNzYWdlID0gZGlzcFBhc3NhZ2U7CiAgICB0aGlzLmxpbmtQYXNzYWdlID0gbGlua1Bhc3NhZ2U7CiAgICB0aGlzLnN0b3J5ID0gbWV0YWRhdGEuc3Rvcnk7CiAgICB0aGlzLnBhZ2VzID0gbWV0YWRhdGEucGFnZXM7CiAgICB0aGlzLnRoZW1lID0gdGhlbWU7CiAgICB0aGlzLnBhZ2VOdW1iZXIgPSBwYWdlTnVtYmVyOwogICAgdGhpcy5wYWdlTmFtZSA9IHRoaXMubGlua1Bhc3NhZ2UubmFtZTsKICAgIHRoaXMuaW1hZ2VGaWxlcyA9IFtdOwogICAgdGhpcy5hdWRpb0ZpbGVzID0gW107CiAgICB0aGlzLmxpbmtzID0gW107CiAgICB2YXIgZm91bmQgPSBmYWxzZTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGlua1Bhc3NhZ2UudGFncy5sZW5ndGg7IGkrKykgewogICAgICBpZiAodGhpcy5saW5rUGFzc2FnZS50YWdzW2ldLmluY2x1ZGVzKCJ0aGVtZV8iKSkgewogICAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGFnc1tpXSA9ICJ0aGVtZV8iICsgdGhpcy5wYWdlTnVtYmVyOwogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGlmICghZm91bmQpIHsKICAgICAgdGhpcy5saW5rUGFzc2FnZS50YWdzLnB1c2goInRoZW1lXyIgKyB0aGlzLnBhZ2VOdW1iZXIpOwogICAgfQoKICAgIHRoaXMucmVwYXJzZUxpbmtzKCk7CiAgfQogIC8qKgogICAqIEluc2VydHMgYSBsaW5rIHRvIHRoZSBib3R0b20gb2YgdGhlIHBhZ2UKICAgKiAKICAgKiBAZnVuY3Rpb24gYWRkTGluawogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIAogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKFBhZ2UsIFt7CiAgICBrZXk6ICJhZGRMaW5rIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMaW5rKG5hbWUpIHsKICAgICAgdGhpcy5saW5rUGFzc2FnZS50ZXh0ICs9ICJcbltbIiArIG5hbWUgKyAiXV0iOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGFsbCBpbnN0YW5jZXMgb2YgYSBsaW5rIGZyb20gYSBwYWdlLgogICAgICogCiAgICAgKiBAZnVuY3Rpb24gcmVtb3ZlTGluawogICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlTGluayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTGluayhuYW1lKSB7CiAgICAgIHZhciBwcm9jZXNzID0gZmFsc2U7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5saW5rc1tpXS5uYW1lID09IG5hbWUpIHsKICAgICAgICAgIHByb2Nlc3MgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByb2Nlc3MpIHsKICAgICAgICB2YXIgc291cmNlID0gdGhpcy5saW5rUGFzc2FnZS50ZXh0OwogICAgICAgIHNvdXJjZSA9IHNvdXJjZS5zcGxpdCgiW1siKTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzb3VyY2UubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChzb3VyY2Vbal0uaW5jbHVkZXMoIl1dIikpIHsKICAgICAgICAgICAgdmFyIHNvdXJjZVNwbGl0ID0gc291cmNlW2pdLnNwbGl0KCJdXSIpOwogICAgICAgICAgICB2YXIgcGFzc2FnZU5hbWUgPSBzb3VyY2VTcGxpdFswXTsgLy9jb25zb2xlLmxvZyhwYXNzYWdlTmFtZSk7CgogICAgICAgICAgICB2YXIgY29udGFpbnMgPSBwYXNzYWdlTmFtZS5pbmNsdWRlcyhuYW1lKTsKCiAgICAgICAgICAgIGlmICghY29udGFpbnMpIHsKICAgICAgICAgICAgICBzb3VyY2VTcGxpdFswXSA9IHBhc3NhZ2VOYW1lOwogICAgICAgICAgICAgIHNvdXJjZVtqXSA9IHNvdXJjZVNwbGl0LmpvaW4oIl1dIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc291cmNlU3BsaXRbMF0gPSAiIjsKICAgICAgICAgICAgICBzb3VyY2Vbal0gPSBzb3VyY2VTcGxpdC5qb2luKCIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc291cmNlID0gc291cmNlLmZpbHRlcihmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICByZXR1cm4gc3RyICE9ICIiOwogICAgICAgIH0pOwogICAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCA9IHNvdXJjZS5qb2luKCJbWyIpOwogICAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCA9IHRoaXMubGlua1Bhc3NhZ2UudGV4dC50cmltKCk7CiAgICAgICAgdGhpcy52YWxpZGF0ZSgpOwogICAgICAgIHRoaXMucmVwYXJzZUxpbmtzKCk7CiAgICAgICAgdGhpcy5yZXBhcnNlTWVkaWEoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInJlcGFyc2VNZWRpYSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVwYXJzZU1lZGlhKGltYWdlVmFyTWFwLCBhdWRpb1Zhck1hcCkgewogICAgICB0aGlzLmltYWdlRmlsZXMgPSBbXTsKICAgICAgdGhpcy5hdWRpb0ZpbGVzID0gW107CiAgICAgIHZhciBzb3J0ZWRLZXlzID0gW107CiAgICAgIGltYWdlVmFyTWFwLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICBzb3J0ZWRLZXlzLnB1c2goa2V5KTsKICAgICAgfSk7CiAgICAgIGF1ZGlvVmFyTWFwLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICBzb3J0ZWRLZXlzLnB1c2goa2V5KTsKICAgICAgfSk7CiAgICAgIHNvcnRlZEtleXMgPSBzb3J0ZWRLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDsKICAgICAgfSk7CiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmxpbmtQYXNzYWdlLnRleHQ7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvcnRlZEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoc291cmNlLmluY2x1ZGVzKHNvcnRlZEtleXNbaV0pKSB7CiAgICAgICAgICBpZiAoYXVkaW9WYXJNYXAuaGFzKHNvcnRlZEtleXNbaV0pKSB7CiAgICAgICAgICAgIHRoaXMuYXVkaW9GaWxlcy5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiBzb3J0ZWRLZXlzW2ldCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChpbWFnZVZhck1hcC5oYXMoc29ydGVkS2V5c1tpXSkpIHsKICAgICAgICAgICAgdGhpcy5pbWFnZUZpbGVzLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IHNvcnRlZEtleXNbaV0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgd2hpbGUgKHNvdXJjZS5pbmNsdWRlcyhzb3J0ZWRLZXlzW2ldKSkgewogICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2UucmVwbGFjZShzb3J0ZWRLZXlzW2ldLCAiIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIHRoZSBsaW5rcyBmb3VuZCBpbiB0aGUgcGFzc2FnZQogICAgICogQGZ1bmN0aW9uIHJlcGFyc2VMaW5rcwogICAgICovCgogIH0sIHsKICAgIGtleTogInJlcGFyc2VMaW5rcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVwYXJzZUxpbmtzKCkgewogICAgICB2YXIgc291cmNlID0gdGhpcy5saW5rUGFzc2FnZS50ZXh0OwogICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoIltbIik7CiAgICAgIHRoaXMubGlua3MgPSBbXTsKICAgICAgdmFyIGxpbmtzQWRkZWQgPSBbXTsKCiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc291cmNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgaWYgKHNvdXJjZVtqXS5pbmNsdWRlcygiXV0iKSkgewogICAgICAgICAgdmFyIHBhc3NhZ2VOYW1lID0gc291cmNlW2pdLnNwbGl0KCJdXSIpWzBdOyAvL2NvbnNvbGUubG9nKHBhc3NhZ2VOYW1lKTsKCiAgICAgICAgICBpZiAocGFzc2FnZU5hbWUuaW5jbHVkZXMoIi0mZ3Q7IikpIHsKICAgICAgICAgICAgcGFzc2FnZU5hbWUgPSBwYXNzYWdlTmFtZS5zcGxpdCgiLSZndDsiKVsxXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMuc3RvcnkuZ2V0U3RvcnlQYXNzYWdlcygpLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0b3J5LmdldFN0b3J5UGFzc2FnZXMoKVtrXS5uYW1lID09IHBhc3NhZ2VOYW1lKSB7CiAgICAgICAgICAgICAgaWYgKCFsaW5rc0FkZGVkLmluY2x1ZGVzKHBhc3NhZ2VOYW1lKSkgewogICAgICAgICAgICAgICAgdGhpcy5saW5rcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgbmFtZTogcGFzc2FnZU5hbWUsCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBrCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpbmtzQWRkZWQucHVzaChwYXNzYWdlTmFtZSk7CiAgICAgICAgICAgICAgfSAvL2NvbnNvbGUubG9nKCJQdXNoZWQ6IiArIEpTT04uc3RyaW5naWZ5KHtuYW1lOiBwYXNzYWdlTmFtZSwgbG9jYXRpb246IGt9KSk7CgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlcGxhY2VzIHRoZSBsaW5rcyB3aXRoaW4gdGhlIHN0b3J5CiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiByZXBsYWNlTGlua3MKICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlcGxhY2VMaW5rcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVwbGFjZUxpbmtzKGV2ZW50KSB7CiAgICAgIHZhciBwcm9jZXNzID0gZmFsc2U7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5saW5rc1tpXS5uYW1lID09IGV2ZW50LnByZXZOYW1lKSB7CiAgICAgICAgICBwcm9jZXNzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChwcm9jZXNzKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMubGlua1Bhc3NhZ2UudGV4dDsKICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoIltbIik7CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc291cmNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoc291cmNlW2pdLmluY2x1ZGVzKCJdXSIpKSB7CiAgICAgICAgICAgIHZhciBzb3VyY2VTcGxpdCA9IHNvdXJjZVtqXS5zcGxpdCgiXV0iKTsKICAgICAgICAgICAgdmFyIHBhc3NhZ2VOYW1lID0gc291cmNlU3BsaXRbMF07IC8vY29uc29sZS5sb2cocGFzc2FnZU5hbWUpOwoKICAgICAgICAgICAgdmFyIHNwbGl0ID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBzcGxpdEFycjsKCiAgICAgICAgICAgIGlmIChwYXNzYWdlTmFtZS5pbmNsdWRlcygiLSZndDsiKSkgewogICAgICAgICAgICAgIHNwbGl0QXJyID0gcGFzc2FnZU5hbWUuc3BsaXQoIi0mZ3Q7Iik7CiAgICAgICAgICAgICAgcGFzc2FnZU5hbWUgPSBzcGxpdEFyclsxXTsKICAgICAgICAgICAgICBzcGxpdCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZWJ1aWx0VGV4dCA9ICIiOwogICAgICAgICAgICB2YXIgY29udGFpbnMgPSBldmVudC5uZXdOYW1lICE9ICIiOwoKICAgICAgICAgICAgaWYgKHBhc3NhZ2VOYW1lID09IGV2ZW50LnByZXZOYW1lKSB7CiAgICAgICAgICAgICAgaWYgKHNwbGl0KSB7CiAgICAgICAgICAgICAgICBzcGxpdEFyclsxXSA9IGV2ZW50Lm5ld05hbWU7CiAgICAgICAgICAgICAgICByZWJ1aWx0VGV4dCA9IHNwbGl0QXJyLmpvaW4oIi0mZ3Q7Iik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlYnVpbHRUZXh0ID0gZXZlbnQubmV3TmFtZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjb250YWlucykgewogICAgICAgICAgICAgICAgc291cmNlU3BsaXRbMF0gPSByZWJ1aWx0VGV4dDsKICAgICAgICAgICAgICAgIHNvdXJjZVtqXSA9IHNvdXJjZVNwbGl0LmpvaW4oIl1dIik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNvdXJjZVNwbGl0WzBdID0gIiI7CiAgICAgICAgICAgICAgICBzb3VyY2Vbal0gPSBzb3VyY2VTcGxpdC5qb2luKCIiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNvdXJjZSA9IHNvdXJjZS5maWx0ZXIoZnVuY3Rpb24gKHN0cikgewogICAgICAgICAgcmV0dXJuIHN0ciAhPSAiIjsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSBzb3VyY2Uuam9pbigiW1siKTsKICAgICAgICB0aGlzLmxpbmtQYXNzYWdlLnRleHQgPSB0aGlzLmxpbmtQYXNzYWdlLnRleHQudHJpbSgpOwogICAgICAgIHRoaXMudmFsaWRhdGUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgdmFyaWFibGVzIGFzIGRpY3RhdGVkIGJ5IHRoZSBldmVudAogICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgCiAgICAgKiBAcGFyYW0ge01hcH0gdmFyaWFibGVzIAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlcGxhY2VWYXJpYWJsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVwbGFjZVZhcmlhYmxlKGV2ZW50LCB2YXJpYWJsZXMpIHsKICAgICAgdmFyIHNvcnRlZEtleXMgPSBbXTsKICAgICAgdmFyaWFibGVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICBzb3J0ZWRLZXlzLnB1c2goa2V5KTsKICAgICAgfSk7CiAgICAgIHZhciBwcm9jZXNzID0gc29ydGVkS2V5cy5pbmNsdWRlcyhldmVudC5wcmV2TmFtZSk7CgogICAgICBpZiAocHJvY2VzcykgewogICAgICAgIHNvcnRlZEtleXMgPSBzb3J0ZWRLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBiLmxlbmd0aCAtIGEubGVuZ3RoOwogICAgICAgIH0pOwogICAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCA9IHRoaXMucmVjdXJzaXZlUmVwbGFjZShldmVudCwgc29ydGVkS2V5cywgdGhpcy5saW5rUGFzc2FnZS50ZXh0LCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgdGhlIHZhcmlhYmxlcyByZWN1cnNpdmVseSB0aGF0IG5lZWQgdG8gYmUgcmVwbGFjZWQuCiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiByZWN1cnNpdmVSZXBsYWNlCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCAKICAgICAqIEBwYXJhbSB7QXJyYXl9IHNvcnRlZEtleXMgCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWN1cnNpdmVSZXBsYWNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWN1cnNpdmVSZXBsYWNlKGV2ZW50LCBzb3J0ZWRLZXlzLCB0ZXh0LCBpbmRleCkgewogICAgICB2YXIga2V5ID0gc29ydGVkS2V5c1tpbmRleF07CiAgICAgIHZhciBzb3VyY2UgPSB0ZXh0LnNwbGl0KGtleSk7CgogICAgICBpZiAoa2V5ID09IGV2ZW50LnByZXZOYW1lKSB7CiAgICAgICAgaWYgKHNvdXJjZS5sZW5ndGggPT0gMSkgewogICAgICAgICAgcmV0dXJuIHNvdXJjZVswXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzb3VyY2Uuam9pbihldmVudC5uZXdOYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmV0ID0gIiI7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoaSA8IHNvdXJjZS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHJldCArPSB0aGlzLnJlY3Vyc2l2ZVJlcGxhY2UoZXZlbnQsIHNvcnRlZEtleXMsIHNvdXJjZVtpXSwgaW5kZXggKyAxKSArIGtleTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldCArPSB0aGlzLnJlY3Vyc2l2ZVJlcGxhY2UoZXZlbnQsIHNvcnRlZEtleXMsIHNvdXJjZVtpXSwgaW5kZXggKyAxKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkcyBpbWFnZSB0byBwYWdlCiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiBhZGRJbWFnZQogICAgICogQHBhcmFtIHsqfSBpbWFnZURhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRJbWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkSW1hZ2UoaW1hZ2VEYXRhKSB7CiAgICAgIHZhciBwcm9jZXNzID0gdHJ1ZTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pbWFnZUZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2VGaWxlc1tpXS5uYW1lID09IGltYWdlRGF0YS5uYW1lKSB7CiAgICAgICAgICBwcm9jZXNzID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocHJvY2VzcykgdGhpcy5pbWFnZUZpbGVzLnB1c2goaW1hZ2VEYXRhKTsKICAgICAgdGhpcy5saW5rUGFzc2FnZS50ZXh0ICs9ICJcbiIgKyBpbWFnZURhdGEubmFtZTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgb2NjdXJlbmNlcyBvZiBpbWFnZSBmcm9tIHBhZ2UKICAgICAqIAogICAgICogQGZ1bmN0aW9uIHJlbW92ZUltYWdlCiAgICAgKiBAcGFyYW0geyp9IGltYWdlRGF0YSAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVJbWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSW1hZ2UoaW1hZ2VEYXRhKSB7CiAgICAgIHRoaXMucmVtb3ZlS2V5RnJvbVRleHQodGhpcy5pbWFnZUZpbGVzLmNvbmNhdCh0aGlzLmF1ZGlvRmlsZXMpLCBpbWFnZURhdGEubmFtZSk7CiAgICAgIHRoaXMuaW1hZ2VGaWxlcyA9IHRoaXMuaW1hZ2VGaWxlcy5maWx0ZXIoZnVuY3Rpb24gKGltZykgewogICAgICAgIHJldHVybiBpbWcubmFtZSAhPSBpbWFnZURhdGEubmFtZTsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYXVkaW8gZmlsZSB0byBwYWdlCiAgICAgKiAKICAgICAqIEBmdW5jdGlvbiBhZGRBdWRpbwogICAgICogQHBhcmFtIHsqfSBhdWRpbyAKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRBdWRpbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkQXVkaW8oYXVkaW9EYXRhKSB7CiAgICAgIHZhciBwcm9jZXNzID0gdHJ1ZTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5hdWRpb0ZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYXVkaW9GaWxlc1tpXS5uYW1lID09IGF1ZGlvRGF0YS5uYW1lKSB7CiAgICAgICAgICBwcm9jZXNzID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocHJvY2VzcykgdGhpcy5hdWRpb0ZpbGVzLnB1c2goYXVkaW9EYXRhKTsKICAgICAgdGhpcy5saW5rUGFzc2FnZS50ZXh0ICs9ICJcbiIgKyBhdWRpb0RhdGEubmFtZTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgb2NjdXJlbmNlcyBvZiBhdWRpbyBmcm9tIHBhZ2UKICAgICAqIAogICAgICogQGZ1bmN0aW9uIHJlbW92ZUF1ZGlvCiAgICAgKiBAcGFyYW0geyp9IGF1ZGlvIAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUF1ZGlvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBdWRpbyhhdWRpb0RhdGEpIHsKICAgICAgdGhpcy5yZW1vdmVLZXlGcm9tVGV4dCh0aGlzLmF1ZGlvRmlsZXMuY29uY2F0KHRoaXMuaW1hZ2VGaWxlcyksIGF1ZGlvRGF0YS5uYW1lKTsKICAgICAgdGhpcy5hdWRpb0ZpbGVzID0gdGhpcy5hdWRpb0ZpbGVzLmZpbHRlcihmdW5jdGlvbiAoYXVkKSB7CiAgICAgICAgcmV0dXJuIGF1ZC5uYW1lICE9IGF1ZGlvRGF0YS5uYW1lOwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogCiAgICAgKiBSZW1vdmVzIGFsbCBvY2N1cmFuY2VzIG9mICdrZXknIGZyb20gdGV4dAogICAgICogCiAgICAgKiBAZnVuY3Rpb24gcmVtb3ZlS2V5RnJvbVRleHQKICAgICAqIEBwYXJhbSB7QXJyYXl9IGRhdGFBcnIgCiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUtleUZyb21UZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVLZXlGcm9tVGV4dChkYXRhQXJyLCBrZXkpIHsKICAgICAgdmFyIHNvcnRlZEtleXMgPSBbXTsKICAgICAgZGF0YUFyci5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHNvcnRlZEtleXMucHVzaCh2YWx1ZS5uYW1lKTsKICAgICAgfSk7CiAgICAgIHZhciBldmVudCA9IHsKICAgICAgICBwcmV2TmFtZToga2V5LAogICAgICAgIG5ld05hbWU6ICIiCiAgICAgIH07CiAgICAgIHNvcnRlZEtleXMgPSBzb3J0ZWRLZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDsKICAgICAgfSk7CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCA9IHRoaXMucmVjdXJzaXZlUmVwbGFjZShldmVudCwgc29ydGVkS2V5cywgdGhpcy5saW5rUGFzc2FnZS50ZXh0LCAwKTsKICAgICAgdGhpcy52YWxpZGF0ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBVc2VkIHRvIGRldGVybWluZSBzdHlsaW5nIGZvciB0aGlzIHN0b3J5LgogICAgICogCiAgICAgKiBAZnVuY3Rpb24gaW5qZWN0Q1NTVGV4dAogICAgICovCgogIH0sIHsKICAgIGtleTogImluamVjdENTU1RleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluamVjdENTU1RleHQoKSB7CiAgICAgIHZhciBpbmplY3QgPSAidHctc3RvcnlbdGFnc349JyI7CiAgICAgIGluamVjdCArPSAidGhlbWVfIiArIHRoaXMucGFnZU51bWJlciArICInXXtcbiI7CiAgICAgIGluamVjdCArPSAiXHQiICsgdGhpcy50aGVtZSArICJcbiI7CiAgICAgIGluamVjdCArPSAifSI7CiAgICAgIHJldHVybiBpbmplY3Q7CiAgICB9CiAgICAvKioKICAgICAqIEBmdW5jdGlvbiBleHRyYWN0Q1NTUHJvcGVydHkKICAgICAqIEBwYXJhbSBwcm9wZXJ0eQogICAgICogQHJldHVybnMge1N0cmluZ30gcHJvcGVydHkgZGVzY3JpcHRpb24KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJleHRyYWN0Q1NTUHJvcGVydHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGV4dHJhY3RDU1NQcm9wZXJ0eShwcm9wZXJ0eSkgewogICAgICB2YXIgc291cmNlID0gdGhpcy50aGVtZTsKICAgICAgdmFyIHNvdXJjZUFyciA9IHNvdXJjZS5zcGxpdCgiOyIpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2VBcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcHJvcCA9IHNvdXJjZUFycltpXS5zcGxpdCgiOiIpWzBdLnRyaW0oKTsKICAgICAgICB2YXIgdmFsID0gc291cmNlQXJyW2ldLnNwbGl0KCI6IilbMV0udHJpbSgpOwoKICAgICAgICBpZiAocHJvcCA9PSBwcm9wZXJ0eSkgewogICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9IC8vY29uc29sZS5sb2cocHJvcCArICc6JyArIHZhbCk7CgogICAgICB9CgogICAgICByZXR1cm4gIlByb3BlcnR5IG5vdCBmb3VuZCI7CiAgICB9CiAgICAvKioKICAgICAqIFZhbGlkYXRlcyBhbmQgY2xlYW5zIHRoZSBsaW5rIHRleHQKICAgICAqIAogICAgICogQGZ1bmN0aW9uIHZhbGlkYXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKCkgewogICAgICB2YXIgc291cmNlID0gdGhpcy5saW5rUGFzc2FnZS50ZXh0LnNwbGl0KCJbWyIpOwogICAgICB2YXIgcmVidWlsZCA9ICIiOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgcmVidWlsZCArPSBzb3VyY2VbaV07CgogICAgICAgIGlmIChzb3VyY2VbaSArIDFdLmluY2x1ZGVzKCJdXSIpKSB7CiAgICAgICAgICByZWJ1aWxkICs9ICJbWyI7CiAgICAgICAgfQogICAgICB9CgogICAgICByZWJ1aWxkICs9IHNvdXJjZVtzb3VyY2UubGVuZ3RoIC0gMV07CiAgICAgIHRoaXMubGlua1Bhc3NhZ2UudGV4dCA9IHJlYnVpbGQudHJpbSgpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBhZ2U7Cn0oKTsKCm1vZHVsZS5leHBvcnRzID0gUGFnZTs="},{"version":3,"sources":["/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/js/extwee_utils/Page.js"],"names":["Page","dispPassage","linkPassage","theme","pageNumber","metadata","story","pages","pageName","name","imageFiles","audioFiles","links","found","i","tags","length","includes","push","reparseLinks","text","process","source","split","j","sourceSplit","passageName","contains","join","filter","str","trim","validate","reparseMedia","imageVarMap","audioVarMap","sortedKeys","forEach","value","key","sort","a","b","has","replace","linksAdded","k","getStoryPassages","location","event","prevName","splitArr","rebuiltText","newName","variables","recursiveReplace","index","ret","imageData","removeKeyFromText","concat","img","audioData","aud","dataArr","inject","property","sourceArr","prop","val","rebuild","module","exports"],"mappings":"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","sourcesContent":["/**\n * @class Page\n * @module Page\n */\nclass Page {\n    /**\n     * @function Page\n     * @class \n     * @param passage - Passage Object\\\n     */\n\tconstructor(dispPassage, linkPassage, theme, pageNumber, metadata) {\n\t\tthis.dispPassage = dispPassage;\n\t\tthis.linkPassage = linkPassage;\n\n\t\tthis.story = metadata.story;\n\t\tthis.pages = metadata.pages;\n\n\t\tthis.theme = theme;\n\t\tthis.pageNumber = pageNumber;\n\t\tthis.pageName = this.linkPassage.name;\n\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\t\tthis.links = [];\n\n\t\tvar found = false;\n\n\t\tfor(var i = 0; i < this.linkPassage.tags.length; i++){\t\n\t\t\tif(this.linkPassage.tags[i].includes(\"theme_\")){\n\t\t\t\tthis.linkPassage.tags[i] = \"theme_\" + this.pageNumber;\n\t\t\t\tfound = true;\n\t\t\t} \n\t\t}\n\n\t\tif(!found){\n\t\t\tthis.linkPassage.tags.push(\"theme_\" + this.pageNumber);\n\t\t}\n\n\t\tthis.reparseLinks();\n\t}\n\n\t/**\n\t * Inserts a link to the bottom of the page\n\t * \n\t * @function addLink\n\t * @param {String} name \n\t */\n\taddLink(name){\n\t\tthis.linkPassage.text += \"\\n[[\" + name + \"]]\";\n\t}\n\n\t/**\n\t * Removes all instances of a link from a page.\n\t * \n\t * @function removeLink\n\t * @param {String} name \n\t */\n\tremoveLink(name){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == name){ process = true; }\n\t\t}\n\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\n\t\t\t\t\tvar contains = passageName.includes(name);\n\n\t\t\t\t\tif(!contains){\n\t\t\t\t\t\tsourceSplit[0] = passageName;\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\n\t\t\tthis.reparseLinks();\n\t\t\tthis.reparseMedia();\n\t\t}\n\t}\n\n\treparseMedia(imageVarMap, audioVarMap){\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\n\t\tvar sortedKeys = [];\n\n\t\timageVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\taudioVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t)\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\n\t\tvar source = this.linkPassage.text;\n\n\t\tfor(var i = 0; i < sortedKeys.length; i++){\n\t\t\tif(source.includes(sortedKeys[i])){\n\t\t\t\t\n\t\t\t\tif(audioVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.audioFiles.push({name: sortedKeys[i]});\n\t\t\t\t} else if(imageVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.imageFiles.push({name: sortedKeys[i]});\n\t\t\t\t}\n\n\t\t\t\twhile(source.includes(sortedKeys[i])){\n\t\t\t\t\tsource = source.replace(sortedKeys[i], \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate the links found in the passage\n\t * @function reparseLinks\n\t */\n\treparseLinks(){\n\t\tvar source = this.linkPassage.text;\n\n\t\tsource = source.split(\"[[\");\n\n\t\tthis.links = [];\n\t\tvar linksAdded = [];\n\n\t\tfor(var j = 0; j < source.length; j++){\n\t\t\tif(source[j].includes(\"]]\")){\n\t\t\t\tvar passageName = source[j].split(\"]]\")[0];\n\t\t\t\t\n\t\t\t\t//console.log(passageName);\n\n\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\tpassageName = passageName.split(\"-&gt;\")[1];\n\t\t\t\t}\n\n\t\t\t\tfor(var k = 0; k < this.story.getStoryPassages().length; k++){\n\t\t\t\t\tif(this.story.getStoryPassages()[k].name == passageName){\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!linksAdded.includes(passageName)){\n\t\t\t\t\t\t\tthis.links.push({name: passageName, location: k});\n\t\t\t\t\t\t\tlinksAdded.push(passageName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log(\"Pushed:\" + JSON.stringify({name: passageName, location: k}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Replaces the links within the story\n\t * \n\t * @function replaceLinks\n\t * @param {Event} event \n\t */\n\treplaceLinks(event){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == event.prevName){ process = true; }\n\t\t}\n\t\t\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\t\t\t\t\tvar split = false;\n\t\t\t\t\tvar splitArr;\n\n\t\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\t\tsplitArr = passageName.split(\"-&gt;\");\n\t\t\t\t\t\tpassageName = splitArr[1];\n\t\t\t\t\t\tsplit = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar rebuiltText = \"\";\n\n\t\t\t\t\tvar contains = event.newName != \"\";\n\n\t\t\t\t\tif(passageName == event.prevName){\n\t\t\t\t\t\tif(split){\n\t\t\t\t\t\t\tsplitArr[1] = event.newName;\n\t\t\t\t\t\t\trebuiltText = splitArr.join(\"-&gt;\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trebuiltText = event.newName;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(contains){\n\t\t\t\t\t\t\tsourceSplit[0] = rebuiltText;\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all variables as dictated by the event\n\t * @param {Event} event \n\t * @param {Map} variables \n\t */\n\treplaceVariable(event, variables){\n\t\tvar sortedKeys = [];\n\n\t\tvariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\t\t\n\t\tvar process = sortedKeys.includes(event.prevName);\n\t\t\n\t\tif(process){\n\t\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\n\t\t\t\n\t\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all the variables recursively that need to be replaced.\n\t * \n\t * @function recursiveReplace\n\t * @param {Event} event \n\t * @param {Array} sortedKeys \n\t * @param {String} text \n\t */\n\trecursiveReplace(event, sortedKeys, text, index){\n\t\tvar key = sortedKeys[index]; \n\t\tvar source = text.split(key);\n\t\t\n\t\tif(key == event.prevName){\n\t\t\tif(source.length == 1){\n\t\t\t\treturn source[0];\n\t\t\t}\n\n\t\t\treturn source.join(event.newName);\n\t\t} else {\n\t\t\tvar ret = \"\";\n\n\t\t\tfor(var i = 0; i < source.length; i++){\n\t\t\t\tif(i < source.length - 1){\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1) + key;\n\t\t\t\t} else {\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\t/**\n\t * Adds image to page\n\t * \n\t * @function addImage\n\t * @param {*} imageData\n\t */\n\taddImage(imageData){\n\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.imageFiles.length; i++){\n\t\t\tif(this.imageFiles[i].name == imageData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.imageFiles.push(imageData);\n\n\t\tthis.linkPassage.text += \"\\n\" + imageData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of image from page\n\t * \n\t * @function removeImage\n\t * @param {*} imageData \n\t */\n\tremoveImage(imageData){\n\n\t\tthis.removeKeyFromText(this.imageFiles.concat(this.audioFiles), imageData.name);\n\n\t\tthis.imageFiles = this.imageFiles.filter(function(img){\n\t\t\treturn img.name != imageData.name;\n\t\t});\n\t}\n\n\t/**\n\t * Adds audio file to page\n\t * \n\t * @function addAudio\n\t * @param {*} audio \n\t */\n\taddAudio(audioData){\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.audioFiles.length; i++){\n\t\t\tif(this.audioFiles[i].name == audioData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.audioFiles.push(audioData);\n\n\t\tthis.linkPassage.text += \"\\n\" + audioData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of audio from page\n\t * \n\t * @function removeAudio\n\t * @param {*} audio \n\t */\n\tremoveAudio(audioData){\n\n\t\tthis.removeKeyFromText(this.audioFiles.concat(this.imageFiles), audioData.name);\n\n\t\tthis.audioFiles = this.audioFiles.filter(function(aud){\n\t\t\treturn aud.name != audioData.name;\n\t\t});\t\t\n\t}\n\n\t/**\n\t * \n\t * Removes all occurances of 'key' from text\n\t * \n\t * @function removeKeyFromText\n\t * @param {Array} dataArr \n\t * @param {String} key \n\t */\n\tremoveKeyFromText(dataArr, key){\n\t\tvar sortedKeys = [];\n\n\t\tdataArr.forEach(\n\t\t\tfunction(value){\n\t\t\t\tsortedKeys.push(value.name);\n\t\t\t}\n\t\t);\n\n\t\tvar event = {prevName: key, newName: \"\"};\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\t\t\n\t\t\n\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\n\t\tthis.validate();\n\t}\n\n\t/**\n\t * Used to determine styling for this story.\n\t * \n\t * @function injectCSSText\n\t */\n\tinjectCSSText(){\n\t\tvar inject = \"tw-story[tags~='\";\n\t\t\tinject += \"theme_\" + this.pageNumber + \"']{\\n\";\n\t\t\tinject +=  \"\\t\" + this.theme + \"\\n\";\n\t\t\tinject += \"}\";\n\n\t\treturn inject;\n\t}\n\n\t/**\n\t * @function extractCSSProperty\n\t * @param property\n\t * @returns {String} property description\n\t */\n\n\textractCSSProperty(property){\n\t\tvar source = this.theme;\n\n\t\tvar sourceArr = source.split(\";\");\n\n\t\tfor(var i = 0; i < sourceArr.length; i++){\n\t\t\t\n\t\t\tvar prop = sourceArr[i].split(\":\")[0].trim();\n\t\t\tvar val = sourceArr[i].split(\":\")[1].trim();\n\n\t\t\tif(prop == property){\n\t\t\t\treturn val;\n\t\t\t}\n\n\t\t\t//console.log(prop + ':' + val);\n\t\t}\n\n\t\treturn \"Property not found\";\n\t}\n\t\n\t/**\n\t * Validates and cleans the link text\n\t * \n\t * @function validate\n\t */\n\tvalidate(){\n\t\tvar source = this.linkPassage.text.split(\"[[\");\n\t\tvar rebuild = \"\";\n\n\t\tfor(var i = 0; i < source.length - 1; i++){\n\t\t\t\n\t\t\trebuild += source[i];\n\n\t\t\tif(source[i + 1].includes(\"]]\")){\n\t\t\t\trebuild += \"[[\";\n\t\t\t}\n\t\t}\n\n\t\trebuild += source[source.length - 1];\n\n\t\tthis.linkPassage.text = rebuild.trim();\n\t}\n}\n\nmodule.exports = Page;\n"]}]}