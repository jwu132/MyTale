{"remainingRequest":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js!/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js??ref--13-0!/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/TweeParser.js","dependencies":[{"path":"/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/TweeParser.js","mtime":1604692362843},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/story_personalization_system/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubGFzdC1pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIik7Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiL1VzZXJzL2p1c3Rpbnd1L0Rlc2t0b3Avc3RvcnlfcGVyc29uYWxpemF0aW9uX3N5c3RlbS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoIi9Vc2Vycy9qdXN0aW53dS9EZXNrdG9wL3N0b3J5X3BlcnNvbmFsaXphdGlvbl9zeXN0ZW0vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiKTsKCnZhciBQYXNzYWdlID0gcmVxdWlyZSgnLi9QYXNzYWdlLmpzJyk7Cgp2YXIgU3RvcnkgPSByZXF1aXJlKCcuL1N0b3J5LmpzJyk7Ci8qKgogKiBAY2xhc3MgVHdlZVBhcnNlcgogKiBAbW9kdWxlIFR3ZWVQYXJzZXIKICovCgoKdmFyIFR3ZWVQYXJzZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgLyoqCiAgICogQGZ1bmN0aW9uIFR3ZWVQYXJzZXIKICAgKiBAY2xhc3MKICAgKiBAcGFyYW0ge3N0cmluZ30gY29udGVudCAtIFR3ZWUgY29udGVudCB0byBwYXJzZQogICAqLwogIGZ1bmN0aW9uIFR3ZWVQYXJzZXIoKSB7CiAgICB2YXIgY29udGVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFR3ZWVQYXJzZXIpOwoKICAgIHRoaXMuc3RvcnkgPSBuZXcgU3RvcnkoKTsKICAgIHRoaXMuX3Bhc3NhZ2VNZXRhZGF0YUVycm9yID0gZmFsc2U7CiAgICB0aGlzLl9zdG9yeWRhdGFFcnJvciA9IGZhbHNlOwogICAgdGhpcy5wYXJzZShjb250ZW50KTsKICB9CiAgLyoqCiAgICogUGFyc2UgVHdlZQogICAqCiAgICogQGZ1bmN0aW9uIHBhcnNlCiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVDb250ZW50cyAtIEZpbGUgY29udGVudHMgdG8gcGFyc2UKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhUd2VlUGFyc2VyLCBbewogICAga2V5OiAicGFyc2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlKGZpbGVDb250ZW50cykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy8gVGhyb3cgZXJyb3IgaWYgZmlsZUNvbnRlbnRzIGlzIGVtcHR5CiAgICAgIGlmIChmaWxlQ29udGVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBmaWxlIGNvbnRlbnRzIScpOwogICAgICB9CgogICAgICB2YXIgcGFzc2FnZXMgPSBbXTsKICAgICAgdmFyIGFkanVzdGVkID0gJyc7IC8vIENoZWNrIGlmIHRoZXJlIGFyZSBleHRyYSBjb250ZW50IGluIHRoZSBmaWxlcwogICAgICAvLyBJZiBzbywgY3V0IGl0IGFsbCBvdXQgZm9yIHRoZSBwYXJzZXIKCiAgICAgIGlmIChmaWxlQ29udGVudHNbMF0gIT09ICc6JyAmJiBmaWxlQ29udGVudHNbMV0gIT09ICc6JykgewogICAgICAgIGFkanVzdGVkID0gZmlsZUNvbnRlbnRzLnNsaWNlKGZpbGVDb250ZW50cy5pbmRleE9mKCc6OicpLCBmaWxlQ29udGVudHMubGVuZ3RoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhZGp1c3RlZCA9IGZpbGVDb250ZW50czsKICAgICAgfSAvLyBTcGxpdCB0aGUgZmlsZSBiYXNlZCBvbiB0aGUgcGFzc2FnZSBzaWdpbCAoOjopIHByb2NlZWRlZCBieSBhIG5ld2xpbmUKCgogICAgICB2YXIgcGFyc2luZ1Bhc3NhZ2VzID0gYWRqdXN0ZWQuc3BsaXQoJ1xuOjonKTsgLy8gRml4IHRoZSBmaXJzdCByZXN1bHQKCiAgICAgIHBhcnNpbmdQYXNzYWdlc1swXSA9IHBhcnNpbmdQYXNzYWdlc1swXS5zbGljZSgyLCBwYXJzaW5nUGFzc2FnZXNbMF0ubGVuZ3RoKTsgLy8gU2V0IHRoZSBpbml0aWFsIHBpZAoKICAgICAgdmFyIHBpZCA9IDA7IC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgcGFzc2FnZXMKCiAgICAgIHBhcnNpbmdQYXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXNzYWdlKSB7CiAgICAgICAgLy8gU2V0IGRlZmF1bHQgdmFsdWVzCiAgICAgICAgdmFyIHRhZ3MgPSAnJzsKICAgICAgICB2YXIgbWV0YWRhdGEgPSAnJzsKICAgICAgICB2YXIgdGV4dCA9ICcnOwogICAgICAgIHZhciBuYW1lID0gJyc7IC8vIEhlYWRlciBpcyBldmVyeXRoaW5nIHRvIHRoZSBmaXJzdCBuZXdsaW5lCgogICAgICAgIHZhciBoZWFkZXIgPSBwYXNzYWdlLnNsaWNlKDAsIHBhc3NhZ2UuaW5kZXhPZignXG4nKSk7IC8vIFRleHQgaXMgZXZlcnl0aGluZyBlbHNlCiAgICAgICAgLy8gKEFsc28gZWF0IHRoZSBsZWFkaW5nIG5ld2xpbmUgY2hhcmFjdGVyLikKICAgICAgICAvLyAoQW5kIHRyaW0gYW55IHJlbWFpbmluZyB3aGl0ZXNwYWNlLikKCiAgICAgICAgdGV4dCA9IHBhc3NhZ2Uuc3Vic3RyaW5nKGhlYWRlci5sZW5ndGggKyAxLCBwYXNzYWdlLmxlbmd0aCkudHJpbSgpOyAvLyBUZXN0IGZvciBtZXRhZGF0YQoKICAgICAgICB2YXIgb3BlbmluZ0N1cmx5QnJhY2tldFBvc2l0aW9uID0gaGVhZGVyLmxhc3RJbmRleE9mKCd7Jyk7CiAgICAgICAgdmFyIGNsb3NpbmdDdXJseUJyYWNrZXRQb3NpdGlvbiA9IGhlYWRlci5sYXN0SW5kZXhPZignfScpOwoKICAgICAgICBpZiAob3BlbmluZ0N1cmx5QnJhY2tldFBvc2l0aW9uICE9PSAtMSAmJiBjbG9zaW5nQ3VybHlCcmFja2V0UG9zaXRpb24gIT09IC0xKSB7CiAgICAgICAgICAvLyBTYXZlIHRoZSB0ZXh0IG1ldGFkYXRhCiAgICAgICAgICBtZXRhZGF0YSA9IGhlYWRlci5zbGljZShvcGVuaW5nQ3VybHlCcmFja2V0UG9zaXRpb24sIGNsb3NpbmdDdXJseUJyYWNrZXRQb3NpdGlvbiArIDEpOyAvLyBSZW1vdmUgdGhlIG1ldGFkYXRhIGZyb20gdGhlIGhlYWRlcgoKICAgICAgICAgIGhlYWRlciA9IGhlYWRlci5zdWJzdHJpbmcoMCwgb3BlbmluZ0N1cmx5QnJhY2tldFBvc2l0aW9uKSArIGhlYWRlci5zdWJzdHJpbmcoY2xvc2luZ0N1cmx5QnJhY2tldFBvc2l0aW9uICsgMSk7CiAgICAgICAgfSAvLyBUaGVyZSB3YXMgcGFzc2FnZSBtZXRhZGF0YQoKCiAgICAgICAgaWYgKG1ldGFkYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSB0aGUgbWV0YWRhdGEKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1ldGFkYXRhID0gSlNPTi5wYXJzZShtZXRhZGF0YSk7CiAgICAgICAgICB9IGNhdGNoIChldmVudCkgewogICAgICAgICAgICBfdGhpcy5fcGFzc2FnZU1ldGFkYXRhRXJyb3IgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gVGVzdCBmb3IgdGFncwoKCiAgICAgICAgdmFyIG9wZW5pbmdTcXVhcmVCcmFja2V0UG9zaXRpb24gPSBoZWFkZXIubGFzdEluZGV4T2YoJ1snKTsKICAgICAgICB2YXIgY2xvc2luZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiA9IGhlYWRlci5sYXN0SW5kZXhPZignXScpOwoKICAgICAgICBpZiAob3BlbmluZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiAhPT0gLTEgJiYgY2xvc2luZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiAhPT0gLTEpIHsKICAgICAgICAgIHRhZ3MgPSBoZWFkZXIuc2xpY2Uob3BlbmluZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiwgY2xvc2luZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiArIDEpOyAvLyBSZW1vdmUgdGhlIHRhZ3MgZnJvbSB0aGUgaGVhZGVyCgogICAgICAgICAgaGVhZGVyID0gaGVhZGVyLnN1YnN0cmluZygwLCBvcGVuaW5nU3F1YXJlQnJhY2tldFBvc2l0aW9uKSArIGhlYWRlci5zdWJzdHJpbmcoY2xvc2luZ1NxdWFyZUJyYWNrZXRQb3NpdGlvbiArIDEpOwogICAgICAgIH0gLy8gUGFyc2UgdGFncwoKCiAgICAgICAgaWYgKHRhZ3MubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8gRWF0IHRoZSBvcGVuaW5nIGFuZCBjbG9zaW5nIHNxdWFyZSBicmFja2V0cwogICAgICAgICAgdGFncyA9IHRhZ3Muc3Vic3RyaW5nKDEsIHRhZ3MubGVuZ3RoIC0gMSk7IC8vIFNldCBlbXB0eSBkZWZhdWx0CgogICAgICAgICAgdmFyIHRhZ3NBcnJheSA9IFtdOyAvLyBUZXN0IGlmIHRhZ3MgaXMgbm90IHNpbmdsZSwgZW1wdHkgc3RyaW5nCgogICAgICAgICAgaWYgKCEodGFncyA9PT0gJycpKSB7CiAgICAgICAgICAgIHRhZ3NBcnJheSA9IHRhZ3Muc3BsaXQoJyAnKTsKICAgICAgICAgIH0gLy8gVGhlcmUgYXJlIG11bHRpcGxlIHRhZ3MKCgogICAgICAgICAgaWYgKHRhZ3NBcnJheS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBmdXR1cmUgYXJyYXkKICAgICAgICAgICAgdmFyIGZ1dHVyZVRhZ0FycmF5ID0gW107IC8vIE1vdmUgdGhyb3VnaCBlbnRyaWVzCiAgICAgICAgICAgIC8vIEFkZCBhIHRyaW1tZWQgdmVyc2lvbiBpbnRvIGZ1dHVyZSBhcnJheQoKICAgICAgICAgICAgdGFnc0FycmF5LmZvckVhY2goZnVuY3Rpb24gKHRhZykgewogICAgICAgICAgICAgIGZ1dHVyZVRhZ0FycmF5LnB1c2godGFnLnRyaW0oKSk7CiAgICAgICAgICAgIH0pOyAvLyBTZXQgdGhlIHRhZ3MgYmFjayB0byB0aGUgZnV0dXJlIGFycmF5CgogICAgICAgICAgICB0YWdzID0gZnV0dXJlVGFnQXJyYXk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRhZ3NBcnJheS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgLy8gVGhlcmUgd2FzIG9ubHkgb25lIHRhZwogICAgICAgICAgICAvLyBTdG9yZSBpdAogICAgICAgICAgICB2YXIgdGVtcCA9IHRhZ3M7IC8vIFN3aXRjaCB0YWdzIG92ZXIgdG8gYW4gYXJyYXkKCiAgICAgICAgICAgIHRhZ3MgPSBbXTsgLy8gUHVzaCB0aGUgc2luZ2xlIGVudHJ5CgogICAgICAgICAgICB0YWdzLnB1c2godGVtcCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGFncyBpcyBzZXQgdG8gZW1wdHkgYXJyYXkgaWYgbm8gdGFncyB3ZXJlIGZvdW5kCiAgICAgICAgICAgIHRhZ3MgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gVGhlcmUgd2VyZSBubyB0YWdzLCBzbyBzZXQgaXQgdG8gYW4gZW1wdHkgYXJyYXk7CiAgICAgICAgICB0YWdzID0gW107CiAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IGFueSBlbXB0eSBzdHJpbmcgdGFncwoKCiAgICAgICAgdGFncyA9IHRhZ3MuZmlsdGVyKGZ1bmN0aW9uICh0YWcpIHsKICAgICAgICAgIHJldHVybiB0YWcgIT09ICcnOwogICAgICAgIH0pOyAvLyBUcmltIGFueSByZW1haW5pbmcgd2hpdGVzcGFjZQoKICAgICAgICBoZWFkZXIgPSBoZWFkZXIudHJpbSgpOyAvLyBDaGVjayBpZiB0aGVyZSBpcyBhIG5hbWUgbGVmdAoKICAgICAgICBpZiAoaGVhZGVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgIG5hbWUgPSBoZWFkZXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIE5vIG5hbWUgbGVmdC4gU29tZXRoaW5nIHdlbnQgd3JvbmcuIEJsYW1lIHVzZXIuCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01hbGZvcm1lZCBwYXNzYWdlIGhlYWRlciEnKTsKICAgICAgICB9CgogICAgICAgIGlmIChfdGhpcy5fcGFzc2FnZU1ldGFkYXRhRXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUud2FybignRXJyb3IgcGFyc2luZyBtZXRhZGF0YSBmb3IgIicgKyBuYW1lICsgJyIuIEl0IHdhcyBpZ25vcmVkLicpOwogICAgICAgIH0gLy8gQWRkIHRoZSBuZXcgUGFzc2FnZSB0byB0aGUgaW50ZXJuYWwgYXJyYXkKCgogICAgICAgIHBhc3NhZ2VzLnB1c2gobmV3IFBhc3NhZ2UobmFtZSwgdGFncywgbWV0YWRhdGEsIHRleHQsIHBpZCkpOyAvLyBJbmNyZWFzZSBwaWQKCiAgICAgICAgcGlkKys7CiAgICAgIH0pOyAvLyBBbGwgZm9ybWF0cyBzaGFyZSBTdG9yeVRpdGxlCiAgICAgIC8vIEZpbmQgaXQgYW5kIHNldCBpdAoKICAgICAgdmFyIHBvcyA9IHBhc3NhZ2VzLmZpbmQoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgcmV0dXJuIGVsLm5hbWUgPT09ICdTdG9yeVRpdGxlJzsKICAgICAgfSk7CgogICAgICBpZiAocG9zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnN0b3J5Lm5hbWUgPSBwb3MudGV4dDsgLy8gUmVtb3ZlIHRoZSBTdG9yeVRpdGxlIHBhc3NhZ2UKCiAgICAgICAgcGFzc2FnZXMgPSBwYXNzYWdlcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgIHJldHVybiBwLm5hbWUgIT09ICdTdG9yeVRpdGxlJzsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGVyZSB3YXMgbm8gU3RvcnlUaXRsZSBwYXNzYWdlCiAgICAgICAgLy8gU2V0IGEgdmFsdWUgb2YgIlVua25vd24iCiAgICAgICAgdGhpcy5zdG9yeS5uYW1lID0gJ1Vua25vd24nOwogICAgICB9IC8vIExvb2sgZm9yIFN0b3J5RGF0YQoKCiAgICAgIHBvcyA9IHBhc3NhZ2VzLmZpbmQoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgcmV0dXJuIGVsLm5hbWUgPT09ICdTdG9yeURhdGEnOwogICAgICB9KTsKCiAgICAgIGlmIChwb3MgIT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIFRyeSB0byBwYXJzZSB0aGUgU3RvcnlEYXRhCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuc3RvcnkubWV0YWRhdGEgPSBKU09OLnBhcnNlKHBvcy50ZXh0KTsKICAgICAgICB9IGNhdGNoIChldmVudCkgewogICAgICAgICAgLy8gU2lsZW50bHkgZmFpbCB3aXRoIGRlZmF1bHQgdmFsdWVzCiAgICAgICAgICB0aGlzLl9zdG9yeWRhdGFFcnJvciA9IHRydWU7CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIFN0b3J5RGF0YSBwYXNzYWdlCgoKICAgICAgICBwYXNzYWdlcyA9IHBhc3NhZ2VzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgcmV0dXJuIHAubmFtZSAhPT0gJ1N0b3J5RGF0YSc7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9zdG9yeWRhdGFFcnJvcikgewogICAgICAgIGNvbnNvbGUud2FybignRXJyb3Igd2l0aCBwcm9jZXNzaW5nIFN0b3J5RGF0YSBKU09OIGRhdGEuIEl0IHdhcyBpZ25vcmVkLicpOwogICAgICB9IC8vIFNldCB0aGUgcGFzc2FnZXMgdG8gdGhlIGludGVybmFsIHN0b3J5CgoKICAgICAgdGhpcy5zdG9yeS5wYXNzYWdlcyA9IHBhc3NhZ2VzOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFR3ZWVQYXJzZXI7Cn0oKTsKCm1vZHVsZS5leHBvcnRzID0gVHdlZVBhcnNlcjs="},{"version":3,"sources":["/Users/justinwu/Desktop/story_personalization_system/src/js/extwee_utils/TweeParser.js"],"names":["Passage","require","Story","TweeParser","content","story","_passageMetadataError","_storydataError","parse","fileContents","length","Error","passages","adjusted","slice","indexOf","parsingPassages","split","pid","forEach","passage","tags","metadata","text","name","header","substring","trim","openingCurlyBracketPosition","lastIndexOf","closingCurlyBracketPosition","JSON","event","openingSquareBracketPosition","closingSquareBracketPosition","tagsArray","futureTagArray","tag","push","temp","filter","console","warn","pos","find","el","undefined","p","module","exports"],"mappings":"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","sourcesContent":["const Passage = require('./Passage.js');\nconst Story = require('./Story.js');\n/**\n * @class TweeParser\n * @module TweeParser\n */\nclass TweeParser {\n  /**\n   * @function TweeParser\n   * @class\n   * @param {string} content - Twee content to parse\n   */\n  constructor (content = '') {\n    this.story = new Story();\n    this._passageMetadataError = false;\n    this._storydataError = false;\n\n    this.parse(content);\n  }\n\n  /**\n   * Parse Twee\n   *\n   * @function parse\n   * @param {string} fileContents - File contents to parse\n   */\n  parse (fileContents) {\n    // Throw error if fileContents is empty\n    if (fileContents.length === 0) {\n      throw new Error('No file contents!');\n    }\n\n    let passages = [];\n    let adjusted = '';\n\n    // Check if there are extra content in the files\n    // If so, cut it all out for the parser\n    if (fileContents[0] !== ':' && fileContents[1] !== ':') {\n      adjusted = fileContents.slice(fileContents.indexOf('::'), fileContents.length);\n    } else {\n      adjusted = fileContents;\n    }\n\n    // Split the file based on the passage sigil (::) proceeded by a newline\n    const parsingPassages = adjusted.split('\\n::');\n\n    // Fix the first result\n    parsingPassages[0] = parsingPassages[0].slice(2, parsingPassages[0].length);\n\n    // Set the initial pid\n    let pid = 0;\n\n    // Iterate through the passages\n    parsingPassages.forEach((passage) => {\n      // Set default values\n      let tags = '';\n      let metadata = '';\n      let text = '';\n      let name = '';\n\n      // Header is everything to the first newline\n      let header = passage.slice(0, passage.indexOf('\\n'));\n      // Text is everything else\n      // (Also eat the leading newline character.)\n      // (And trim any remaining whitespace.)\n      text = passage.substring(header.length + 1, passage.length).trim();\n\n      // Test for metadata\n      const openingCurlyBracketPosition = header.lastIndexOf('{');\n      const closingCurlyBracketPosition = header.lastIndexOf('}');\n\n      if (openingCurlyBracketPosition !== -1 && closingCurlyBracketPosition !== -1) {\n        // Save the text metadata\n        metadata = header.slice(openingCurlyBracketPosition, closingCurlyBracketPosition + 1);\n\n        // Remove the metadata from the header\n        header = header.substring(0, openingCurlyBracketPosition) + header.substring(closingCurlyBracketPosition + 1);\n      }\n\n      // There was passage metadata\n      if (metadata.length > 0) {\n        // Try to parse the metadata\n        try {\n          metadata = JSON.parse(metadata);\n        } catch (event) {\n          this._passageMetadataError = true;\n        }\n      }\n\n      // Test for tags\n      const openingSquareBracketPosition = header.lastIndexOf('[');\n      const closingSquareBracketPosition = header.lastIndexOf(']');\n\n      if (openingSquareBracketPosition !== -1 && closingSquareBracketPosition !== -1) {\n        tags = header.slice(openingSquareBracketPosition, closingSquareBracketPosition + 1);\n\n        // Remove the tags from the header\n        header = header.substring(0, openingSquareBracketPosition) + header.substring(closingSquareBracketPosition + 1);\n      }\n\n      // Parse tags\n      if (tags.length > 0) {\n        // Eat the opening and closing square brackets\n        tags = tags.substring(1, tags.length - 1);\n\n        // Set empty default\n        let tagsArray = [];\n\n        // Test if tags is not single, empty string\n        if (!(tags === '')) {\n          tagsArray = tags.split(' ');\n        }\n\n        // There are multiple tags\n        if (tagsArray.length > 1) {\n        // Create future array\n          const futureTagArray = [];\n\n          // Move through entries\n          // Add a trimmed version into future array\n          tagsArray.forEach((tag) => { futureTagArray.push(tag.trim()); });\n\n          // Set the tags back to the future array\n          tags = futureTagArray;\n        } else if (tagsArray.length === 1) {\n        // There was only one tag\n        // Store it\n          const temp = tags;\n\n          // Switch tags over to an array\n          tags = [];\n          // Push the single entry\n          tags.push(temp);\n        } else {\n        // Make sure tags is set to empty array if no tags were found\n          tags = [];\n        }\n      } else {\n        // There were no tags, so set it to an empty array;\n        tags = [];\n      }\n\n      // Filter out any empty string tags\n      tags = tags.filter(tag => tag !== '');\n\n      // Trim any remaining whitespace\n      header = header.trim();\n\n      // Check if there is a name left\n      if (header.length > 0) {\n        name = header;\n      } else {\n        // No name left. Something went wrong. Blame user.\n        throw new Error('Malformed passage header!');\n      }\n\n      if (this._passageMetadataError) {\n        console.warn('Error parsing metadata for \"' + name + '\". It was ignored.');\n      }\n\n      // Add the new Passage to the internal array\n      passages.push(new Passage(name, tags, metadata, text, pid));\n\n      // Increase pid\n      pid++;\n    });\n\n    // All formats share StoryTitle\n    // Find it and set it\n    let pos = passages.find((el) => { return el.name === 'StoryTitle'; });\n\n    if (pos !== undefined) {\n      this.story.name = pos.text;\n      // Remove the StoryTitle passage\n      passages = passages.filter(p => p.name !== 'StoryTitle');\n    } else {\n    // There was no StoryTitle passage\n    // Set a value of \"Unknown\"\n      this.story.name = 'Unknown';\n    }\n\n    // Look for StoryData\n    pos = passages.find((el) => { return el.name === 'StoryData'; });\n\n    if (pos !== undefined) {\n    // Try to parse the StoryData\n      try {\n        this.story.metadata = JSON.parse(pos.text);\n      } catch (event) {\n        // Silently fail with default values\n        this._storydataError = true;\n      }\n\n      // Remove the StoryData passage\n      passages = passages.filter(p => p.name !== 'StoryData');\n    }\n\n    if (this._storydataError) {\n      console.warn('Error with processing StoryData JSON data. It was ignored.');\n    }\n\n    // Set the passages to the internal story\n    this.story.passages = passages;\n  }\n}\n\nmodule.exports = TweeParser;\n"]}]}