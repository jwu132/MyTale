{"remainingRequest":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/components/stories/storyPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/src/components/stories/storyPage.vue","mtime":1604692362841},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/justinwu/Desktop/Gitlab_MyTale/mytale/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZScKaW1wb3J0IHN0b3J5TWl4aW4gZnJvbSAiQC9taXhpbnMvc3RvcnlNaXhpbiIKaW1wb3J0IGZpcmViYXNlTWl4aW4gZnJvbSAiQC9taXhpbnMvZmlyZWJhc2VNaXhpbiIKaW1wb3J0IGJyb3dzZXJFZGl0b3JNaXhpbiBmcm9tICJAL21peGlucy9icm93c2VyRWRpdG9yTWl4aW4iCmltcG9ydCB7IGNvbW1lbnRzUmVmIH0gZnJvbSAiQC9maXJlYmFzZUNvbmZpZyIKaW1wb3J0IGFkZENvbW1lbnQgZnJvbSAnQC9jb21wb25lbnRzL2NvbW1lbnRzL2FkZENvbW1lbnRzLnZ1ZScgCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1N0b3J5JywKICBjb21wb25lbnRzOnsKICAgIGFkZENvbW1lbnQsCiAgfSwKICBkYXRhICgpewogICAgcmV0dXJuewogICAgICBzdG9yeUlEOiAnJywKICAgICAgdGFnc0RhdGE6W10sCiAgICAgIGdpdmVuU3Rvcnk6W3t9XSwKICAgICAgc3RvcnlDb21tZW50czogW10sCiAgICAgIGdpdmVuU3RvcnlDb21tZW50czogW10sCiAgICAgIGlzTG9nZ2VkSW46IGZhbHNlLAogICAgICBpc1ZlcmlmaWVkOiBmYWxzZSwgCiAgICAgIHNob3dBZGRDb21tZW50OiBmYWxzZSwKICAgICAgaXNNeUNvbW1lbnQ6IGZhbHNlLAogICAgICB1c2VyRW1haWw6ICcnLAogICAgICB1c2VySUQ6ICcnLAogICAgICBlZGl0Q29tbWVudEtleTogJycsCiAgICAgIGNvbW1lbnRFZGl0OiAnJywKICAgICAgY3VycmVudGx5RWRpdGluZzogZmFsc2UsCiAgICAgIGlzRGVsZXRlZDogZmFsc2UsCiAgICB9CiAgfSwKICBmaXJlYmFzZTp7CiAgICBzdG9yeUNvbW1lbnRzOiBjb21tZW50c1JlZiwKICB9LAogIG1ldGhvZHM6IHsKICAgIHBvcHVsYXRlVGFnc09iaigpewogICAgICB2YXIgYXJyID0gW10KICAgICAgdmFyIGtleXMgPSB7fQogICAgICBjb25zdCBxdWVyeSA9IGNvbW1lbnRzUmVmLm9yZGVyQnlLZXkoKTsKICAgICAgcXVlcnkub25jZSgndmFsdWUnKQogICAgICAgIC50aGVuKGZ1bmN0aW9uKHNuYXBzaG90KSB7CiAgICAgICAgICBzbmFwc2hvdC5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkU25hcHNob3QpIHsKICAgICAgICAgICAgdmFyIGtleSA9IGNoaWxkU25hcHNob3QudmFsKCkuc3RvcnlUaXRsZTsKICAgICAgICAgICAgaWYodHlwZW9mIGtleXNba2V5XSA9PT0gInVuZGVmaW5lZCIpewogICAgICAgICAgICAgIGtleXNba2V5XSA9IHt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hpbGRTbmFwc2hvdC52YWwoKS5oZWxwZnVsVGFncy5mb3JFYWNoKGZ1bmN0aW9uKHRhZykgewogICAgICAgICAgICAgIGlmKHR5cGVvZiBrZXlzW2tleV1bdGFnXSA9PT0gInVuZGVmaW5lZCIpewogICAgICAgICAgICAgICAga2V5c1trZXldW3RhZ10gPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBrZXlzW2tleV1bdGFnXSArPSAxOwogICAgICAgICAgICB9KQogICAgICAgICAgfSkKICAgICAgICAgIGZvcihsZXQga2V5IGluIGtleXMpewogICAgICAgICAgICBrZXlzW2tleV0gPSBPYmplY3QuZW50cmllcyhrZXlzW2tleV0pCiAgICAgICAgICAgIGtleXNba2V5XS5zb3J0KGZ1bmN0aW9uKGEsYil7CiAgICAgICAgICAgICAgcmV0dXJuIGJbMV0tYVsxXQogICAgICAgICAgICB9KQogICAgICAgICAgICBpZihrZXlzW2tleV0ubGVuZ3RoPjMpewogICAgICAgICAgICAgIGtleXNba2V5XSA9IGtleXNba2V5XS5zbGljZSgwLDMpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGFyci5wdXNoKGtleXMpCiAgICAgICAgfSkKICAgICAgcmV0dXJuIGFycjsKICAgIH0sCiAgICBzaG93QWRkKCkgewogICAgICB0aGlzLlNob3dBZGRDb21tZW50cyA9IHRydWU7CiAgICB9LAogICAgY29uZmlybUVkaXQoY29tbWVudEtleSwgY29tbWVudCl7CiAgICAgIHRoaXMuZWRpdENvbW1lbnRLZXkgPSBjb21tZW50S2V5OwogICAgICB0aGlzLmNvbW1lbnRFZGl0ID0gY29tbWVudDsKICAgICAgdGhpcy5jdXJyZW50bHlFZGl0aW5nID0gdHJ1ZTsKICAgIH0sCiAgfSwKICBhc3luYyBjcmVhdGVkKCl7CiAgICBpZihmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXIpewogICAgICB0aGlzLmlzVmVyaWZpZWQgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXIuZW1haWxWZXJpZmllZAogICAgICB0aGlzLmlzTG9nZ2VkSW4gPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7CiAgICAgIHRoaXMudXNlckVtYWlsID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyLmVtYWlsOwogICAgICB0aGlzLnVzZXJJRCA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlci51aWQ7CiAgICB9CiAgICB0aGlzLnRhZ3NEYXRhID0gdGhpcy5wb3B1bGF0ZVRhZ3NPYmooKTsKICAgIHRoaXMuc3RvcnlJRCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgIHRoaXMuZ2l2ZW5TdG9yeSA9IGF3YWl0IHRoaXMuZ2V0U3RvcnkodGhpcy5zdG9yeUlEKQoKICAKICB9LAogIG1peGluczogW3N0b3J5TWl4aW4sIGJyb3dzZXJFZGl0b3JNaXhpbiwgZmlyZWJhc2VNaXhpbl0sCn0K"},{"version":3,"sources":["storyPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA","file":"storyPage.vue","sourceRoot":"src/components/stories","sourcesContent":["<template>\n  <div v-if=\"givenStory[0]\">\n    <v-card flat class=\"container\" v-if=\"!isDeleted\">\n      <v-card-title v-if=\"givenStory\" class=\"display-1\">\n        {{givenStory[0].title}} \n        <v-spacer></v-spacer>\n        <v-btn outlined v-on:click=\"updateViewsBrowser(givenStory[0])\">View in Browser</v-btn>\n        <v-btn outlined class=\"ml-2\" v-on:click=\"updateViewsEditor(givenStory[0])\">Edit Story</v-btn>\n        <v-btn outlined class=\"ml-2\" v-if=\"givenStory[0].creator === userEmail\" v-on:click=\"removeStory(givenStory[0].id, givenStory[0].storyKey)\">Delete Story</v-btn>\n        \n      </v-card-title>\n\n        <v-card-subtitle>\n        by {{givenStory[0].author}}\n        <v-spacer></v-spacer>\n        Created on {{givenStory[0].dateAdded}} | {{givenStory[0].views}} views\n      </v-card-subtitle>\n\n      <v-card-title>Synopsis</v-card-title>\n      <v-card-text>{{givenStory[0].synopsis}}</v-card-text>\n      \n      <v-card-actions>\n        <v-chip class=\"ml-2\">\n          <v-icon small>mdi-tag</v-icon> Tags\n        </v-chip>\n        <v-chip class=\"ml-2\" color=\"orange\" text-color=\"white\" v-for=\"tag of givenStory[0].tags\" v-bind:key=\"tag['.key']\">\n          {{tag}}\n        </v-chip>\n      </v-card-actions>\n\n      <v-list two-line>\n        <v-card-title class=\"pb-0\">Comments</v-card-title>\n        <div v-for=\"comment of storyComments\" v-bind:key=\"comment['.key']\">\n          <v-list-item class= \"comment\" v-if=\"comment.storyTitle === givenStory[0].title\">\n            <v-list-item-content v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-list-item-title class=\"text-wrap\">{{comment.comment}}</v-list-item-title>\n              <v-list-item-subtitle>\n                {{comment.name}} {{comment.dateAdded}}\n              </v-list-item-subtitle>\n            </v-list-item-content>  \n            \n            <v-list-item-action class = \"comment-actions\" v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-btn title = \"Edit Comment\" icon v-if=\"userEmail === comment.email\" v-on:click=\"confirmEdit(comment.commentKey, comment.comment)\">\n                <v-icon>mdi-pencil</v-icon>\n              </v-btn>\n            </v-list-item-action>\n            <v-list-item-action class = \"comment-actions\" v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-btn title = \"Remove Comment\" icon v-if=\"userEmail === comment.email\" v-on:click=\"removeComment(comment.commentKey, userID)\">\n                <v-icon>mdi-delete</v-icon>\n              </v-btn>\n            </v-list-item-action>\n\n            <v-list-item-content v-if=\"comment.commentKey === editCommentKey\">\n              <form class = \"edit-comment\">\n                <v-text-field v-model=\"commentEdit\"></v-text-field>\n                <v-btn class=\"mb-2\" outlined small v-on:click=\"editComment(comment.commentKey, userID, commentEdit)\">Submit</v-btn>\n              </form>\n            </v-list-item-content>\n          </v-list-item>\n        </div>\n      </v-list>\n\n      <v-card-text class=\"pt-1\">\n        <v-btn outlined small @click=\"showAddComment = true\">Add Comment</v-btn>\n        <div class=\"add-comment\" v-if=\"showAddComment\">\n          <addComment v-if=\"isVerified\" v-bind:givenStoryTitle = \"givenStory[0].title\" />\n          <p v-if=\"!isLoggedIn\"> You need to log in to comment</p>\n        </div>\n      </v-card-text>\n    </v-card>\n\n    <!--<h3>Ratings for Tags:</h3>\n    <div v-for=\"(object,i) in tagsData\" :key=\"i\">\n      <ul v-for=\"(tag,i) in object[givenStory[0].title]\" :key=\"i\">\n        <li>\n          {{tag[0]}}: {{tag[1]}}\n        </li>\n      </ul>\n    </div>-->\n\n    <h3 v-if=\"isDeleted\">This story has been deleted!</h3>\n  </div>\n</template>\n\n<script>\nimport firebase from 'firebase'\nimport storyMixin from \"@/mixins/storyMixin\"\nimport firebaseMixin from \"@/mixins/firebaseMixin\"\nimport browserEditorMixin from \"@/mixins/browserEditorMixin\"\nimport { commentsRef } from \"@/firebaseConfig\"\nimport addComment from '@/components/comments/addComments.vue' \n\nexport default {\n  name: 'Story',\n  components:{\n    addComment,\n  },\n  data (){\n    return{\n      storyID: '',\n      tagsData:[],\n      givenStory:[{}],\n      storyComments: [],\n      givenStoryComments: [],\n      isLoggedIn: false,\n      isVerified: false, \n      showAddComment: false,\n      isMyComment: false,\n      userEmail: '',\n      userID: '',\n      editCommentKey: '',\n      commentEdit: '',\n      currentlyEditing: false,\n      isDeleted: false,\n    }\n  },\n  firebase:{\n    storyComments: commentsRef,\n  },\n  methods: {\n    populateTagsObj(){\n      var arr = []\n      var keys = {}\n      const query = commentsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot) {\n          snapshot.forEach(function(childSnapshot) {\n            var key = childSnapshot.val().storyTitle;\n            if(typeof keys[key] === \"undefined\"){\n              keys[key] = {}\n            }\n            childSnapshot.val().helpfulTags.forEach(function(tag) {\n              if(typeof keys[key][tag] === \"undefined\"){\n                keys[key][tag] = 0;\n              }\n              keys[key][tag] += 1;\n            })\n          })\n          for(let key in keys){\n            keys[key] = Object.entries(keys[key])\n            keys[key].sort(function(a,b){\n              return b[1]-a[1]\n            })\n            if(keys[key].length>3){\n              keys[key] = keys[key].slice(0,3)\n            }\n          }\n          arr.push(keys)\n        })\n      return arr;\n    },\n    showAdd() {\n      this.ShowAddComments = true;\n    },\n    confirmEdit(commentKey, comment){\n      this.editCommentKey = commentKey;\n      this.commentEdit = comment;\n      this.currentlyEditing = true;\n    },\n  },\n  async created(){\n    if(firebase.auth().currentUser){\n      this.isVerified = firebase.auth().currentUser.emailVerified\n      this.isLoggedIn = firebase.auth().currentUser;\n      this.userEmail = firebase.auth().currentUser.email;\n      this.userID = firebase.auth().currentUser.uid;\n    }\n    this.tagsData = this.populateTagsObj();\n    this.storyID = this.$route.params.id;\n    this.givenStory = await this.getStory(this.storyID)\n\n  \n  },\n  mixins: [storyMixin, browserEditorMixin, firebaseMixin],\n}\n</script>\n\n<style scoped>\n.comment .comment-actions{\n  visibility: hidden;\n}\n.comment:hover .comment-actions{\n  visibility: visible;\n}\n</style>\n"]}]}