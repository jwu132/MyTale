{"version":3,"sources":["Typesense/Configuration.js"],"names":["Configuration","options","nodes","map","node","_setDefaultPathInNode","nearestNode","connectionTimeoutSeconds","timeoutSeconds","healthcheckIntervalSeconds","numRetries","length","retryIntervalSeconds","apiKey","logger","logLevel","setLevel","_showDeprecationWarnings","validate","_validateNodes","Error","some","_isNodeMissingAnyParameters","every","key","hasOwnProperty","path","warn","masterNode","readReplicaNodes"],"mappings":"AAAA;;;;;;;;;;;;;AAEA;;IAEqBA,a;AACnB,2BAA2B;AAAA;;AAAA,QAAdC,OAAc,uEAAJ,EAAI;AAAA;AACzB,SAAKC,KAAL,GAAaD,OAAO,CAACC,KAAR,IAAiB,EAA9B;AACA,SAAKA,KAAL,GAAa,KAAKA,KAAL,CAAWC,GAAX,CAAe,UAAAC,IAAI;AAAA,aAAI,KAAI,CAACC,qBAAL,CAA2BD,IAA3B,CAAJ;AAAA,KAAnB,CAAb;AACA,SAAKE,WAAL,GAAmBL,OAAO,CAACK,WAAR,IAAuB,IAA1C;AACA,SAAKA,WAAL,GAAmB,KAAKD,qBAAL,CAA2B,KAAKC,WAAhC,CAAnB;AACA,SAAKC,wBAAL,GAAgCN,OAAO,CAACM,wBAAR,IAAoCN,OAAO,CAACO,cAA5C,IAA8D,EAA9F;AACA,SAAKC,0BAAL,GAAkCR,OAAO,CAACQ,0BAAR,IAAsC,EAAxE;AACA,SAAKC,UAAL,GAAkBT,OAAO,CAACS,UAAR,IAAsB,KAAKR,KAAL,CAAWS,MAAX,IAAqB,KAAKL,WAAL,IAAoB,IAApB,GAA2B,CAA3B,GAA+B,CAApD,CAAtB,IAAgF,CAAlG;AACA,SAAKM,oBAAL,GAA4BX,OAAO,CAACW,oBAAR,IAAgC,GAA5D;AACA,SAAKC,MAAL,GAAcZ,OAAO,CAACY,MAAtB;AAEA,SAAKC,MAAL,GAAcb,OAAO,CAACa,MAAR,IAAkBA,iBAAhC;AACA,SAAKC,QAAL,GAAgBd,OAAO,CAACc,QAAR,IAAoB,MAApC;AACA,SAAKD,MAAL,CAAYE,QAAZ,CAAqB,KAAKD,QAA1B;;AAEA,SAAKE,wBAAL,CAA8BhB,OAA9B;;AACA,SAAKiB,QAAL;AACD;;;;+BAEW;AACV,UAAI,KAAKhB,KAAL,IAAc,IAAd,IAAsB,KAAKA,KAAL,CAAWS,MAAX,KAAsB,CAA5C,IAAiD,KAAKQ,cAAL,EAArD,EAA4E;AAC1E,cAAM,IAAIC,KAAJ,CAAU,sGAAV,CAAN;AACD;;AAED,UAAI,KAAKP,MAAL,IAAe,IAAnB,EAAyB;AACvB,cAAM,IAAIO,KAAJ,CAAU,4DAAV,CAAN;AACD;AACF;;;qCAEiB;AAAA;;AAChB,aAAO,KAAKlB,KAAL,CAAWmB,IAAX,CAAgB,UAACjB,IAAD,EAAU;AAC/B,eAAO,MAAI,CAACkB,2BAAL,CAAiClB,IAAjC,CAAP;AACD,OAFM,CAAP;AAGD;;;gDAE4BA,I,EAAM;AACjC,aAAO,CAAC,CAAC,UAAD,EAAa,MAAb,EAAqB,MAArB,EAA6B,MAA7B,EAAqCmB,KAArC,CAA2C,UAACC,GAAD,EAAS;AAC1D,eAAOpB,IAAI,CAACqB,cAAL,CAAoBD,GAApB,CAAP;AACD,OAFO,CAAR;AAGD;;;0CAEsBpB,I,EAAM;AAC3B,UAAIA,IAAI,IAAI,IAAR,IAAgB,CAACA,IAAI,CAACqB,cAAL,CAAoB,MAApB,CAArB,EAAkD;AAChDrB,QAAAA,IAAI,CAACsB,IAAL,GAAY,EAAZ;AACD;;AACD,aAAOtB,IAAP;AACD;;;6CAEyBH,O,EAAS;AACjC,UAAIA,OAAO,CAACO,cAAZ,EAA4B;AAC1B,aAAKM,MAAL,CAAYa,IAAZ,CAAiB,gFAAjB;AACD;;AACD,UAAI1B,OAAO,CAAC2B,UAAZ,EAAwB;AACtB,aAAKd,MAAL,CAAYa,IAAZ,CAAiB,oGAAjB;AACD;;AACD,UAAI1B,OAAO,CAAC4B,gBAAZ,EAA8B;AAC5B,aAAKf,MAAL,CAAYa,IAAZ,CAAiB,0GAAjB;AACD;AACF","sourcesContent":["'use strict'\n\nimport logger from 'loglevel'\n\nexport default class Configuration {\n  constructor (options = {}) {\n    this.nodes = options.nodes || []\n    this.nodes = this.nodes.map(node => this._setDefaultPathInNode(node))\n    this.nearestNode = options.nearestNode || null\n    this.nearestNode = this._setDefaultPathInNode(this.nearestNode)\n    this.connectionTimeoutSeconds = options.connectionTimeoutSeconds || options.timeoutSeconds || 10\n    this.healthcheckIntervalSeconds = options.healthcheckIntervalSeconds || 15\n    this.numRetries = options.numRetries || this.nodes.length + (this.nearestNode == null ? 0 : 1) || 3\n    this.retryIntervalSeconds = options.retryIntervalSeconds || 0.1\n    this.apiKey = options.apiKey\n\n    this.logger = options.logger || logger\n    this.logLevel = options.logLevel || 'warn'\n    this.logger.setLevel(this.logLevel)\n\n    this._showDeprecationWarnings(options)\n    this.validate()\n  }\n\n  validate () {\n    if (this.nodes == null || this.nodes.length === 0 || this._validateNodes()) {\n      throw new Error('Missing required configuration. Ensure that nodes[].protocol, nodes[].host and nodes[].port are set.')\n    }\n\n    if (this.apiKey == null) {\n      throw new Error('Missing required configuration. Ensure that apiKey is set.')\n    }\n  }\n\n  _validateNodes () {\n    return this.nodes.some((node) => {\n      return this._isNodeMissingAnyParameters(node)\n    })\n  }\n\n  _isNodeMissingAnyParameters (node) {\n    return !['protocol', 'host', 'port', 'path'].every((key) => {\n      return node.hasOwnProperty(key)\n    })\n  }\n\n  _setDefaultPathInNode (node) {\n    if (node != null && !node.hasOwnProperty('path')) {\n      node.path = ''\n    }\n    return node\n  }\n\n  _showDeprecationWarnings (options) {\n    if (options.timeoutSeconds) {\n      this.logger.warn('Deprecation warning: timeoutSeconds is now renamed to connectionTimeoutSeconds')\n    }\n    if (options.masterNode) {\n      this.logger.warn('Deprecation warning: masterNode is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n    if (options.readReplicaNodes) {\n      this.logger.warn('Deprecation warning: readReplicaNodes is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n  }\n}\n"],"file":"Configuration.js"}