{"version":3,"sources":["webpack:///./src/firebaseConfig.js","webpack:///./src/js/extwee_utils/StoryFormatParser.js","webpack:///./src/mixins/StateManager.js","webpack:///./src/js/extwee_utils/HTMLWriter.js","webpack:///./src/components/homepage/NavBar.vue?f246","webpack:///src/components/homepage/NavBar.vue","webpack:///./src/components/homepage/NavBar.vue?eaea","webpack:///./src/components/homepage/NavBar.vue","webpack:///./src/plugins/vuetify.js","webpack:///./src/store/index.js","webpack:///./src/mixins/firebaseMixin.js","webpack:///./src/js/extwee_utils/StoryFormat.js","webpack:///./src/mixins/tweeConverterMixin.js","webpack:///./src/js/extwee_utils/Page.js","webpack:///./src/mixins/browserEditorMixin.js","webpack:///./src/mixins/storyMixin.js","webpack:///./src/js/extwee_utils/Passage.js","webpack:///./src/components/stories/storyPage.vue?a740","webpack:///./src/components/comments/addComments.vue?befe","webpack:///src/components/comments/addComments.vue","webpack:///./src/components/comments/addComments.vue?a595","webpack:///./src/components/comments/addComments.vue","webpack:///src/components/stories/storyPage.vue","webpack:///./src/components/stories/storyPage.vue?633d","webpack:///./src/components/stories/storyPage.vue?e9ed","webpack:///./src/components/stories/storyPage.vue?c6fb","webpack:///./src/mixins/titleMixin.js","webpack:///./src/js/extwee_utils/TweeWriter.js","webpack:///./src/js/extwee_utils/StoryEditor.js","webpack:///./src/js/extwee_utils/HTMLParser.js","webpack:///./src/js/extwee_utils/Story.js","webpack:///./src/js/extwee_utils/TweeParser.js"],"names":["app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","db","database","firestoredb","firestore","commentsRef","ref","accountsRef","tagsRef","StoryFormat","require","StoryFormatParser","contents","this","storyformat","parse","harlowePosition","indexOf","setupPosition","lastIndexOf","slice","openingCurlyBracketPosition","closingCurlyBracketPosition","Error","jsonContent","JSON","event","module","exports","methods","storageAvailable","type","storage","window","x","setItem","removeItem","e","DOMException","code","name","length","Story","HTMLWriter","story","storyFormat","css","js","output","cssContent","jsContent","writeFile","outputContents","storyData","getStartingPassage","creator","creatorVersion","metadata","ifid","zoom","version","stylePassages","getStylePassages","content","text","scriptPassages","getScriptPassages","getStoryPassages","passage","pid","tags","t","Object","prototype","hasOwnProperty","call","position","size","source","replace","render","_vm","_h","$createElement","_c","_self","attrs","_v","staticClass","_e","isVerified","staticRenderFns","data","isLoggedIn","currentUser","user","userLink","created","component","VAppBar","VBtn","VSpacer","VToolbarTitle","VToolbar","Vue","use","Vuetify","Vuex","Store","state","storyLocation","storyContent","String","storyToPublish","hello","getters","mutations","updateDirectory","payload","searchLocation","updateContent","updateStoryPublish","updateHello","actions","getName","UID","arr","query","orderByKey","once","then","snapshot","val","push","getUserComments","commentsObj","comments","key","getVarVals","profileObj","profile","getVarNames","getStoriesWithDrafts","storyObj","draftsObj","drafts","getDraftsData","title","dateUpdated","removeStoryDrafts","storyTitle","confirm","userID","remove","location","reload","removeComment","commentKey","editComment","comment","alert","commentObj","update","editCommentKey","commentEdit","currentlyEditing","addTag","tag","tagObj","addingTag","getTags","tagsObj","mixins","storyMixin","object","description","author","image","url","license","proofing","html","tweeContent","TweeParser","editor","StoryEditor","generateViewStory","htmlWrite","twee","htmlContent","HTMLParser","tweeWrite","TweeWriter","Axios","get","response","format","Page","dispPassage","linkPassage","theme","pageNumber","pages","pageName","imageFiles","audioFiles","links","found","i","includes","reparseLinks","process","split","j","sourceSplit","passageName","contains","join","filter","str","trim","validate","reparseMedia","imageVarMap","audioVarMap","sortedKeys","forEach","value","sort","a","b","has","linksAdded","k","prevName","splitArr","rebuiltText","newName","variables","recursiveReplace","index","ret","imageData","removeKeyFromText","concat","img","audioData","aud","dataArr","inject","property","sourceArr","prop","rebuild","browserView","item","linkBlob","Blob","link","document","createElement","href","URL","createObjectURL","target","click","revokeObjectURL","editorView","sessionStorage","updateViewsBrowser","updateViews","id","synopsis","views","dateNow","dateAdded","storyKey","updateViewsEditor","tweeConverter","Typesense","client","stories","createClient","Client","addStory","newStory","storeKey","collection","doc","collections","documents","create","set","isSubmitted","removeStory","ID","delete","isDeleted","updatedViewsStory","console","log","returnData","getStory","storyHolder","retrieve","retrieveTitles","titleArray","export","retrieveStoryTags","tagArray","retrieveUserStories","userEmail","storiesArray","removeTitleSpaces","replaced","Passage","givenStory","_s","on","$event","_l","email","confirmEdit","model","callback","$$v","expression","showAddComment","commentChecker","newComment","$set","commentComplete","tagsInStory","tagsComplete","post","d","Date","props","now","getMonth","nameArray","computed","newKey","givenStoryTitle","VSelect","VTextField","components","addComment","storyID","tagsData","storyComments","givenStoryComments","isMyComment","firebase","populateTagsObj","keys","showAdd","ShowAddComments","VCard","VCardActions","VCardSubtitle","VCardText","VCardTitle","VChip","VIcon","VList","VListItem","VListItemAction","VListItemContent","VListItemSubtitle","VListItemTitle","getTitle","vm","$options","stringify","undefined","passages","VAR_TAG","NUM_VARS","NUM_IMG_VARS","NUM_AUD_VARS","baseStory","exportedStoryPages","Map","imageVariables","audioVariables","regeneratePages","parseVariables","generateStoryText","line","pos1","pos2","newVal","pos","variable","charAt","variablePassage","results","clear","variableText","lines","extractVariable","defVal","extractDefault","color","varData","extractArr","imgSrc","extractSrc","substring","file","fileName","path","src","uploaded","audSrc","l","detVariableColors","printVariableData","chunk","getItem","detTextVariableColors","detImageVariableColors","detAudioVariableColors","varMap","idA","idB","oR","oG","oB","randR","Math","random","randG","randB","addAudio","removeAudio","addImage","removeImage","replaceLinks","mergedMap","replaceVariable","addLink","removeLink","remText","baseText","prevLink","nLinkPassage","page","variableName","newText","checkEvent","replaceVariables","media","viewStory","passageObj","textToPush","temp","injectVariableText","injectMedia","injectCSSText","cloudStory","hidden","inVariables","inMedia","processTextVariables","processMediaVariables","nPassage","substr","injectPublishVariableText","HtmlParser","dom","lowerCaseTagName","script","style","pre","querySelector","attributes","formatVersion","start","startnode","storyPassages","querySelectorAll","attr","rawText","_escapeMetacharacters","styleElement","scriptElement","result","pkg","obj","assign","searchTag","searchName","_passageMetadataError","_storydataError","fileContents","adjusted","parsingPassages","header","openingSquareBracketPosition","closingSquareBracketPosition","tagsArray","futureTagArray","warn","find","el","p"],"mappings":"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","file":"js/chunk-common.2cc6e3cd.js","sourcesContent":["import {initializeApp} from 'firebase'\n\nconst app =  initializeApp({\n  apiKey: \"AIzaSyAu5EUOxMPPdrRrZo-hfQs19RDNaJ4mgR4\",\n  authDomain: \"mytale-comments.firebaseapp.com\",\n  databaseURL: \"https://mytale-comments.firebaseio.com\",\n  projectId: \"mytale-comments\",\n  storageBucket: \"mytale-comments.appspot.com\",\n  messagingSenderId: \"320636559583\",\n  appId: \"1:320636559583:web:a6c77ce3ebb26dfa48c96a\",\n  measurementId: \"G-12RZEF9E3K\"\n});\n\nexport const db = app.database()\nexport const firestoredb = app.firestore()\nexport const commentsRef = db.ref('comments')\nexport const accountsRef = db.ref('accounts')\nexport const tagsRef = db.ref('tags')\n\n","const StoryFormat = require('./StoryFormat.js');\n/**\n * @class StoryFormatParser\n * @module StoryFormatParser\n */\nclass StoryFormatParser {\n\t/**\n\t * @function StoryFormatParser\n\t * @class\n\t * @param {string} contents - Story Format file to read\n\t */\n\tconstructor(contents = ' ') {\n\t\tthis.storyformat = null;\n\n\t\tthis.parse(contents);\n\t}\n\n\t/**\n\t * Parse a Story Format file\n\t *\n\t * @param {string} file - File to read\n\t * @returns {void}\n\t */\n\tparse(contents) {\n\t\t// Harlowe has malformed JSON, so we have to test for it\n\t\tconst harlowePosition = contents.indexOf('harlowe');\n\n\t\tif (harlowePosition !== -1) {\n\t\t\t// The 'setup' property is malformed\n\t\t\tconst setupPosition = contents.lastIndexOf(',\"setup\": function');\n\t\t\tcontents = contents.slice(0, setupPosition) + '}';\n\t\t}\n\n\t\tconst openingCurlyBracketPosition = contents.indexOf('{');\n\t\tconst closingCurlyBracketPosition = contents.lastIndexOf('}');\n\n\t\tif (openingCurlyBracketPosition !== -1 && closingCurlyBracketPosition !== -1) {\n\t\t\t// Slice out the JSON\n\t\t\tcontents = contents.slice(openingCurlyBracketPosition, closingCurlyBracketPosition + 1);\n\t\t} else {\n\t\t\tthrow new Error('Unable to find Twine2 JSON chunk!');\n\t\t}\n\n\t\tlet jsonContent = '';\n\n\t\ttry {\n\t\t\tjsonContent = JSON.parse(contents);\n\t\t} catch (event) {\n\t\t\tthrow new Error('Unable to parse Twine2 JSON chunk!');\n\t\t}\n\n\t\tthis.storyformat = new StoryFormat(jsonContent);\n\t}\n}\n\nmodule.exports = StoryFormatParser;\n","export default{    \n    methods:{\n        storageAvailable: function(type) {\n            var storage;\n            try {\n                storage = window[type];\n                var x = '__storage_test__';\n                storage.setItem(x, x);\n                storage.removeItem(x);\n                return true;\n            }\n            catch(e) {\n                return e instanceof DOMException && (\n                    // everything except Firefox\n                    e.code === 22 ||\n                    // Firefox\n                    e.code === 1014 ||\n                    // test name field too, because code might not be present\n                    // everything except Firefox\n                    e.name === 'QuotaExceededError' ||\n                    // Firefox\n                    e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\n                    // acknowledge QuotaExceededError only if there's something already stored\n                    (storage && storage.length !== 0);\n            }\n        }\n    }\n}","/**\n * @external Story\n * @see Story.js\n * @external StoryFormat\n * @see StoryFormat.js\n */\n\nconst Story = require('./Story.js');\nconst StoryFormat = require('./StoryFormat.js');\n/**\n * @class HTMLWriter\n * @module HTMLWriter\n */\nclass HTMLWriter {\n  /**\n   * @function HTMLWriter\n   * @class\n   * @param {Story} story - Story object to write\n   * @param {StoryFormat} storyFormat - Story format to write\n   * @param {string} css - Any CSS to write\n   * @param {string} js - Any JS to write\n   */\n  constructor (story, storyFormat, css, js) {\n    if (!(story instanceof Story)) {\n      throw new Error('Error: story must be a Story object!');\n    }\n\n    if (!(storyFormat instanceof StoryFormat)) {\n      throw new Error('storyFormat must be a StoryFormat object!');\n    }\n\n    this.output = \"\";\n\n    const cssContent = css || null;\n    const jsContent = js || null;\n\n    this.writeFile(story, storyFormat, cssContent, jsContent);\n  }\n\n  /**\n   * Write story to file using story format and adding any CSS and JS\n   *\n   * @function writeFile\n   * @param {string} file - File to write\n   * @param {Story} story - Story object to write\n   * @param {StoryFormat} storyFormat - StoryFormat to write\n   * @param {string} cssContent - Any CSS to write\n   * @param {string} jsContent - Any JS to write\n   * @returns {void}\n   */\n  writeFile (story, storyFormat, cssContent, jsContent) {\n    let outputContents = '';\n    this.output = \"\";\n\n    // Build <tw-storydata>\n    let storyData =\n            '<tw-storydata name=\"' + story.name + '\" ' +\n            'startnode=\"' + story.getStartingPassage() + '\" ' +\n            'creator=\"' + story.creator + '\" ' +\n            'creator-version=\"' + story.creatorVersion + '\" ' +\n            'ifid=\"' + story.metadata.ifid + '\" ' +\n            'zoom=\"' + story.metadata.zoom + '\" ' +\n            'format=\"' + storyFormat.name + '\" ' +\n            'format-version=\"' + storyFormat.version + '\" ' +\n            'options hidden>\\n';\n\n    // Build the STYLE\n    storyData += '<style role=\"stylesheet\" id=\"twine-user-stylesheet\" type=\"text/twine-css\">';\n\n    // Get any passages tagged with 'stylesheet'\n    const stylePassages = story.getStylePassages();\n\n    // CSS passed through from DirectoryReader\n    if (cssContent != null) {\n      storyData += cssContent;\n    }\n\n    // Iterate through the collection and add to storyData\n    for (const content of stylePassages) {\n      storyData += content.text;\n    }\n\n    storyData += '</style>\\n';\n\n    // Build the SCRIPT\n    storyData += '<script role=\"script\" id=\"twine-user-script\" type=\"text/twine-javascript\">';\n\n    // Get any passages tagged with 'script'\n    const scriptPassages = story.getScriptPassages();\n\n    // JS passed through from DirectoryReader\n    if (jsContent != null) {\n      storyData += jsContent;\n    }\n\n    // Iterate through the collection and add to storyData\n    for (const content of scriptPassages) {\n      storyData += content.text;\n    }\n\n    storyData += '</script>\\n';\n\n    // All the script data has been written.\n    // Delete all 'script'-tagged passages\n    //story.deleteAllByTag('script');\n\n    // All the style data has been written.\n    // Delete all 'style'-tagged passages\n    //story.deleteAllByTag('stylesheet');\n\n    // Build the passages\n    for (const passage of story.getStoryPassages()) {\n\n      storyData += '<tw-passagedata pid=\"' + passage.pid + '\" name=\"' + passage.name + '\"';\n\n      // Write out any tags\n      if (passage.tags.length > 1) {\n        storyData += ' tags=\"';\n\n        for (const t of passage.tags) {\n          storyData += t + ' ';\n        }\n\n        storyData += '\" ';\n      } else if (passage.tags.length === 1) {\n        storyData += ' tags=\"' + passage.tags[0] + '\" ';\n      } else {\n        storyData += ' tags ';\n      }\n\n      // Write out position\n      if (Object.prototype.hasOwnProperty.call(passage.metadata, 'position')) {\n        storyData += 'position=\"' +\n                    passage.metadata.position + '\" ';\n      } else {\n        // Didn't have a position.\n        // Make one up.\n        storyData += 'position=\"100,100\" ';\n      }\n\n      // Write out size\n      if (Object.prototype.hasOwnProperty.call(passage.metadata, 'size')) {\n        storyData += 'size=\"' +\n                    passage.metadata.size + '\" ';\n      } else {\n        // Didn't have a size.\n        // Make one up.\n        storyData += 'size=\"100,100\" ';\n      }\n\n      storyData += '>' + passage.text + '</tw-passagedata>\\n';\n    }\n\n    storyData += '</tw-storydata>';\n\n    // Replace the story name in the source file\n    var source = storyFormat.source.replace('{{STORY_NAME}}', story.name);\n\n    // Replace the story data\n    source = source.replace('{{STORY_DATA}}', storyData);\n\n    outputContents += source;\n    \n    this.output = outputContents;\n  }\n}\n\nmodule.exports = HTMLWriter;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-app-bar',{attrs:{\"app\":\"\",\"color\":\"white\"}},[_c('v-toolbar-title',[_vm._v(\"Make Your Own \"),_c('span',{staticClass:\"font-weight-black\"},[_vm._v(\"SOCIAL STORIES\")])]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"index.html\"}},[_vm._v(\"Home\")]),(_vm.isVerified)?_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"dashboard.html\"}},[_vm._v(\"Profile\")]):_vm._e(),(!_vm.isVerified)?_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"account.html\"}},[_vm._v(\"Login\")]):_vm._e(),_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"search_app.html\"}},[_vm._v(\"Search\")]),_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"editor.html\"}},[_vm._v(\"Editor\")]),_c('v-btn',{attrs:{\"text\":\"\",\"href\":\"about.html\"}},[_vm._v(\"About\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <v-app-bar\n        app\n        color=\"white\"\n      >\n\n      <v-toolbar-title\n      >Make Your Own <span class=\"font-weight-black\">SOCIAL STORIES</span></v-toolbar-title>\n\n      <v-spacer></v-spacer>\n\n      <v-btn text href=\"index.html\">Home</v-btn>\n      <v-btn text href=\"dashboard.html\" v-if=\"isVerified\">Profile</v-btn>\n      <v-btn text href=\"account.html\" v-if=\"!isVerified\">Login</v-btn>\n      <v-btn text href=\"search_app.html\">Search</v-btn>\n      <v-btn text href=\"editor.html\">Editor</v-btn>\n      <v-btn text href=\"about.html\">About</v-btn>\n\n    </v-app-bar>\n  </div>\n</template>\n\n<script>\nimport firebase from 'firebase';\n\nexport default {\n  name: \"NavBar\",\n  data() {\n    return {\n      isLoggedIn: false,\n      isVerified: false,\n      currentUser: '',\n      user: \"Login\",\n      userLink: \"account.html\",\n    };\n  },\n  created(){\n    this.isLoggedIn = firebase.auth().currentUser\n    if(firebase.auth().currentUser){\n      this.isVerified = firebase.auth().currentUser.emailVerified\n    }\n  },\n}\n</script>\n\n<style scoped> \n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./NavBar.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./NavBar.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./NavBar.vue?vue&type=template&id=35f7e914&scoped=true&\"\nimport script from \"./NavBar.vue?vue&type=script&lang=js&\"\nexport * from \"./NavBar.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"35f7e914\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAppBar,VBtn,VSpacer,VToolbarTitle})\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","// store/index.js\n\nimport Vue from \"vue\";\nimport Vuex from \"vuex\";\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n\tstate: {\n\t\tstoryLocation: \"/stories/Story Template.twee\",\n    storyContent: String,\n    storyToPublish: '',\n    hello: \"Hello\",\n\t},\n\tgetters: {},\n\tmutations: {\n\t\tupdateDirectory(state, payload){\n\t\t\tstate.storyLocation = payload.searchLocation;\n\t\t},\n\n\t\tupdateContent(state, payload){\n\t\t\tstate.storyContent = payload.content;\n    },\n    \n    updateStoryPublish(state, payload){\n      state.storyToPublish = payload\n    },\n\n    updateHello(state, payload){\n      state.hello = payload\n    }\n\t},\n\tactions: {}\n});","//import firebase from 'firebase'\n//import { commentsRef } from \"@/firebaseConfig\"\nimport { accountsRef } from \"@/firebaseConfig\"\nimport storyMixin from \"@/mixins/storyMixin\"\nimport {db} from \"@/firebaseConfig\"\nimport {tagsRef} from \"@/firebaseConfig\"\n\nexport default{\n  methods:{\n    getName(UID){\n      var arr = []\n      var name = \"\";\n      const query = accountsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot){\n          name = snapshot.val()[UID].name\n          arr.push(name);\n        })\n      return arr;\n    },\n    getUserComments(UID){\n      var arr = []\n      const query = accountsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot){\n          var commentsObj = snapshot.val()[UID].comments\n          for(let key in commentsObj){\n            arr.push(commentsObj[key])\n          }\n        })\n      return arr;\n    },\n    getVarVals(UID){\n      var arr = []\n      const query = accountsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot){\n          var profileObj = snapshot.val()[UID].profile\n          for(let key in profileObj){\n            arr.push(profileObj[key])\n          }\n        })\n      return arr;\n    },\n    getVarNames(UID){\n      var arr = []\n      const query = accountsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot){\n          var profileObj = snapshot.val()[UID].profile\n          for(let key in profileObj){\n            arr.push(key)\n          }\n        })\n      return arr;\n    },\n    getStoriesWithDrafts(UID){\n      var arr = []\n      var storyObj = {}\n      const query = accountsRef.orderByKey()\n      query.once('value')\n      .then(function(snapshot){\n        var draftsObj = snapshot.val()[UID].drafts\n        for(let key in draftsObj){\n          storyObj[key] = snapshot.val()[UID].drafts[key]\n        }\n        arr.push(storyObj)\n      })\n      return arr;\n    },\n    getDraftsData(UID, title){\n      var arr = []\n      const query = accountsRef.orderByKey()\n      query.once('value')\n      .then(function(snapshot){\n        var draftsObj = snapshot.val()[UID].drafts[title]\n        for(let key in draftsObj){\n          arr.push(draftsObj[key].dateUpdated)\n        }\n      })\n      return arr;\n    },\n    removeStoryDrafts(storyTitle){\n      if(confirm(\"Are you sure you want to delete this story?\")){\n        db.ref('accounts/' + this.userID + '/drafts/' + storyTitle).remove()\n        location.reload()\n      }\n    },\n    removeComment(commentKey, userID){\n      if(confirm(\"Are you sure you want to delete this comment?\")){\n        location.reload()\n        db.ref('accounts/' + userID + '/comments/' + commentKey).remove()\n        db.ref('comments/'+ commentKey).remove()\n      }\n    },\n    editComment(commentKey, userID, comment){\n      if(comment.length <= 0){\n        alert(\"Your comment is too short.\")\n      }\n      else{\n        var commentObj = {\"comment\": comment}\n        if(db.ref('accounts/' + userID + '/comments/' + commentKey)){\n          db.ref('accounts/' + userID + '/comments/' + commentKey).update(commentObj)\n        }\n        db.ref('comments/'+ commentKey).update(commentObj)\n        this.editCommentKey = ''\n        this.commentEdit = ''\n        this.currentlyEditing = false\n        location.reload()\n      }\n    },\n    addTag(tag){\n      var tagObj = {\"tagName\": tag}\n      db.ref('tags/'+ tag).update(tagObj)\n      this.addingTag = false\n    },\n    getTags(){\n      var arr = []\n      const query = tagsRef.orderByKey()\n      query.once('value')\n      .then(function(snapshot){\n        var tagsObj = snapshot.val()\n        for(let key in tagsObj){\n          arr.push(key)\n        }\n      })\n      return arr;\n    }\n  },\n  mixins: [storyMixin]\n}","/**\n * @class StoryFormat\n * @module StoryFormat\n */\nclass StoryFormat {\n  /**\n   * @function StoryFormat\n   * @class\n   * @param {object} object - Object literal to become StoryFormat object\n   */\n  constructor (object) {\n    if (typeof object === 'object') {\n      this.name = object.name || null;\n      this.version = object.version || null;\n      this.description = object.description || null;\n      this.author = object.author || null;\n      this.image = object.image || null;\n      this.url = object.url || null;\n      this.license = object.license || null;\n      this.proofing = object.proofing || null;\n      this.source = object.source || null;\n    } else {\n      throw new Error('Expected JSON object!');\n    }\n  }\n}\n\nmodule.exports = StoryFormat;\n","import Axios from 'axios'\nimport StoryFormatParser from '@/js/extwee_utils/StoryFormatParser.js'\nimport StoryEditor from '@/js/extwee_utils/StoryEditor.js'\nimport HTMLWriter from '@/js/extwee_utils/HTMLWriter.js'\nimport HTMLParser from '@/js/extwee_utils/HTMLParser.js'\nimport TweeWriter from '@/js/extwee_utils/TweeWriter.js'\nimport TweeParser from '@/js/extwee_utils/TweeParser.js'\n\nexport default{\n\n    data(){\n        return{\n            storyFormat: Object,\n        }\n    },\n\n    methods:{\n        html(tweeContent){\n            var story = new TweeParser(tweeContent).story;\n            var editor = new StoryEditor(story);\n            \n            story = editor.generateViewStory(false);\n\n            let htmlWrite = new HTMLWriter(story, this.storyFormat, \"body{text-align:center;}\", \"\");\n\n            return htmlWrite.output;\n        },\n\n        twee(htmlContent){\n            var story = new HTMLParser(htmlContent).story;\n            let tweeWrite = new TweeWriter(story);\n            return tweeWrite.output;\n        }\n    },\n\n    created: function(){\n        Axios.get(\"/storyformats/harlowe-3/format.js\").then(response => {\n\n\t\t\tlet format = new StoryFormatParser(response.data);\n\t\t\tthis.storyFormat = format.storyformat;\n\t\t})\n    }\n    \n\n}","/**\n * @class Page\n * @module Page\n */\nclass Page {\n    /**\n     * @function Page\n     * @class \n     * @param passage - Passage Object\\\n     */\n\tconstructor(dispPassage, linkPassage, theme, pageNumber, metadata) {\n\t\tthis.dispPassage = dispPassage;\n\t\tthis.linkPassage = linkPassage;\n\n\t\tthis.story = metadata.story;\n\t\tthis.pages = metadata.pages;\n\n\t\tthis.theme = theme;\n\t\tthis.pageNumber = pageNumber;\n\t\tthis.pageName = this.linkPassage.name;\n\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\t\tthis.links = [];\n\n\t\tvar found = false;\n\n\t\tfor(var i = 0; i < this.linkPassage.tags.length; i++){\t\n\t\t\tif(this.linkPassage.tags[i].includes(\"theme_\")){\n\t\t\t\tthis.linkPassage.tags[i] = \"theme_\" + this.pageNumber;\n\t\t\t\tfound = true;\n\t\t\t} \n\t\t}\n\n\t\tif(!found){\n\t\t\tthis.linkPassage.tags.push(\"theme_\" + this.pageNumber);\n\t\t}\n\n\t\tthis.reparseLinks();\n\t}\n\n\t/**\n\t * Inserts a link to the bottom of the page\n\t * \n\t * @function addLink\n\t * @param {String} name \n\t */\n\taddLink(name){\n\t\tthis.linkPassage.text += \"\\n[[\" + name + \"]]\";\n\t}\n\n\t/**\n\t * Removes all instances of a link from a page.\n\t * \n\t * @function removeLink\n\t * @param {String} name \n\t */\n\tremoveLink(name){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == name){ process = true; }\n\t\t}\n\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\n\t\t\t\t\tvar contains = passageName.includes(name);\n\n\t\t\t\t\tif(!contains){\n\t\t\t\t\t\tsourceSplit[0] = passageName;\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\n\t\t\tthis.reparseLinks();\n\t\t\tthis.reparseMedia();\n\t\t}\n\t}\n\n\treparseMedia(imageVarMap, audioVarMap){\n\t\tthis.imageFiles = [];\n\t\tthis.audioFiles = [];\n\n\t\tvar sortedKeys = [];\n\n\t\timageVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\taudioVarMap.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t)\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\n\t\tvar source = this.linkPassage.text;\n\n\t\tfor(var i = 0; i < sortedKeys.length; i++){\n\t\t\tif(source.includes(sortedKeys[i])){\n\t\t\t\t\n\t\t\t\tif(audioVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.audioFiles.push({name: sortedKeys[i]});\n\t\t\t\t} else if(imageVarMap.has(sortedKeys[i])){\n\t\t\t\t\tthis.imageFiles.push({name: sortedKeys[i]});\n\t\t\t\t}\n\n\t\t\t\twhile(source.includes(sortedKeys[i])){\n\t\t\t\t\tsource = source.replace(sortedKeys[i], \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate the links found in the passage\n\t * @function reparseLinks\n\t */\n\treparseLinks(){\n\t\tvar source = this.linkPassage.text;\n\n\t\tsource = source.split(\"[[\");\n\n\t\tthis.links = [];\n\t\tvar linksAdded = [];\n\n\t\tfor(var j = 0; j < source.length; j++){\n\t\t\tif(source[j].includes(\"]]\")){\n\t\t\t\tvar passageName = source[j].split(\"]]\")[0];\n\t\t\t\t\n\t\t\t\t//console.log(passageName);\n\n\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\tpassageName = passageName.split(\"-&gt;\")[1];\n\t\t\t\t}\n\n\t\t\t\tfor(var k = 0; k < this.story.getStoryPassages().length; k++){\n\t\t\t\t\tif(this.story.getStoryPassages()[k].name == passageName){\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!linksAdded.includes(passageName)){\n\t\t\t\t\t\t\tthis.links.push({name: passageName, location: k});\n\t\t\t\t\t\t\tlinksAdded.push(passageName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//console.log(\"Pushed:\" + JSON.stringify({name: passageName, location: k}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Replaces the links within the story\n\t * \n\t * @function replaceLinks\n\t * @param {Event} event \n\t */\n\treplaceLinks(event){\n\t\tvar process = false;\n\n\t\tfor(var i = 0; i < this.links.length; i++){\n\t\t\tif(this.links[i].name == event.prevName){ process = true; }\n\t\t}\n\t\t\n\t\tif(process){\n\t\t\tvar source = this.linkPassage.text;\n\n\t\t\tsource = source.split(\"[[\");\n\n\t\t\tfor(var j = 0; j < source.length; j++){\n\t\t\t\tif(source[j].includes(\"]]\")){\n\n\t\t\t\t\tvar sourceSplit = source[j].split(\"]]\");\n\n\t\t\t\t\tvar passageName = sourceSplit[0];\n\t\t\t\t\t\n\t\t\t\t\t//console.log(passageName);\n\t\t\t\t\tvar split = false;\n\t\t\t\t\tvar splitArr;\n\n\t\t\t\t\tif(passageName.includes(\"-&gt;\")){\n\t\t\t\t\t\tsplitArr = passageName.split(\"-&gt;\");\n\t\t\t\t\t\tpassageName = splitArr[1];\n\t\t\t\t\t\tsplit = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar rebuiltText = \"\";\n\n\t\t\t\t\tvar contains = event.newName != \"\";\n\n\t\t\t\t\tif(passageName == event.prevName){\n\t\t\t\t\t\tif(split){\n\t\t\t\t\t\t\tsplitArr[1] = event.newName;\n\t\t\t\t\t\t\trebuiltText = splitArr.join(\"-&gt;\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trebuiltText = event.newName;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(contains){\n\t\t\t\t\t\t\tsourceSplit[0] = rebuiltText;\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"]]\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsourceSplit[0] = \"\";\n\t\t\t\t\t\t\tsource[j] = sourceSplit.join(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tsource = source.filter(str => str != \"\");\n\t\t\tthis.linkPassage.text = source.join(\"[[\");\n\t\t\t\n\t\t\tthis.linkPassage.text = this.linkPassage.text.trim();\n\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all variables as dictated by the event\n\t * @param {Event} event \n\t * @param {Map} variables \n\t */\n\treplaceVariable(event, variables){\n\t\tvar sortedKeys = [];\n\n\t\tvariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\t\t\n\t\tvar process = sortedKeys.includes(event.prevName);\n\t\t\n\t\tif(process){\n\t\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\n\t\t\t\n\t\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\t\t}\n\t}\n\n\t/**\n\t * Replaces all the variables recursively that need to be replaced.\n\t * \n\t * @function recursiveReplace\n\t * @param {Event} event \n\t * @param {Array} sortedKeys \n\t * @param {String} text \n\t */\n\trecursiveReplace(event, sortedKeys, text, index){\n\t\tvar key = sortedKeys[index]; \n\t\tvar source = text.split(key);\n\t\t\n\t\tif(key == event.prevName){\n\t\t\tif(source.length == 1){\n\t\t\t\treturn source[0];\n\t\t\t}\n\n\t\t\treturn source.join(event.newName);\n\t\t} else {\n\t\t\tvar ret = \"\";\n\n\t\t\tfor(var i = 0; i < source.length; i++){\n\t\t\t\tif(i < source.length - 1){\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1) + key;\n\t\t\t\t} else {\n\t\t\t\t\tret += this.recursiveReplace(event, sortedKeys, source[i], index + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\t/**\n\t * Adds image to page\n\t * \n\t * @function addImage\n\t * @param {*} imageData\n\t */\n\taddImage(imageData){\n\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.imageFiles.length; i++){\n\t\t\tif(this.imageFiles[i].name == imageData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.imageFiles.push(imageData);\n\n\t\tthis.linkPassage.text += \"\\n\" + imageData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of image from page\n\t * \n\t * @function removeImage\n\t * @param {*} imageData \n\t */\n\tremoveImage(imageData){\n\n\t\tthis.removeKeyFromText(this.imageFiles.concat(this.audioFiles), imageData.name);\n\n\t\tthis.imageFiles = this.imageFiles.filter(function(img){\n\t\t\treturn img.name != imageData.name;\n\t\t});\n\t}\n\n\t/**\n\t * Adds audio file to page\n\t * \n\t * @function addAudio\n\t * @param {*} audio \n\t */\n\taddAudio(audioData){\n\t\tvar process = true;\n\n\t\tfor(var i = 0; i < this.audioFiles.length; i++){\n\t\t\tif(this.audioFiles[i].name == audioData.name){\n\t\t\t\tprocess = false;\n\t\t\t}\n\t\t}\n\n\t\tif(process)\n\t\t\tthis.audioFiles.push(audioData);\n\n\t\tthis.linkPassage.text += \"\\n\" + audioData.name;\n\t}\n\n\t/**\n\t * Removes all occurences of audio from page\n\t * \n\t * @function removeAudio\n\t * @param {*} audio \n\t */\n\tremoveAudio(audioData){\n\n\t\tthis.removeKeyFromText(this.audioFiles.concat(this.imageFiles), audioData.name);\n\n\t\tthis.audioFiles = this.audioFiles.filter(function(aud){\n\t\t\treturn aud.name != audioData.name;\n\t\t});\t\t\n\t}\n\n\t/**\n\t * \n\t * Removes all occurances of 'key' from text\n\t * \n\t * @function removeKeyFromText\n\t * @param {Array} dataArr \n\t * @param {String} key \n\t */\n\tremoveKeyFromText(dataArr, key){\n\t\tvar sortedKeys = [];\n\n\t\tdataArr.forEach(\n\t\t\tfunction(value){\n\t\t\t\tsortedKeys.push(value.name);\n\t\t\t}\n\t\t);\n\n\t\tvar event = {prevName: key, newName: \"\"};\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n\t\t\treturn b.length - a.length;\n\t\t});\n\t\t\n\t\t\n\t\tthis.linkPassage.text = this.recursiveReplace(event, sortedKeys, this.linkPassage.text, 0);\n\n\t\tthis.validate();\n\t}\n\n\t/**\n\t * Used to determine styling for this story.\n\t * \n\t * @function injectCSSText\n\t */\n\tinjectCSSText(){\n\t\tvar inject = \"tw-story[tags~='\";\n\t\t\tinject += \"theme_\" + this.pageNumber + \"']{\\n\";\n\t\t\tinject +=  \"\\t\" + this.theme + \"\\n\";\n\t\t\tinject += \"}\";\n\n\t\treturn inject;\n\t}\n\n\t/**\n\t * @function extractCSSProperty\n\t * @param property\n\t * @returns {String} property description\n\t */\n\n\textractCSSProperty(property){\n\t\tvar source = this.theme;\n\n\t\tvar sourceArr = source.split(\";\");\n\n\t\tfor(var i = 0; i < sourceArr.length; i++){\n\t\t\t\n\t\t\tvar prop = sourceArr[i].split(\":\")[0].trim();\n\t\t\tvar val = sourceArr[i].split(\":\")[1].trim();\n\n\t\t\tif(prop == property){\n\t\t\t\treturn val;\n\t\t\t}\n\n\t\t\t//console.log(prop + ':' + val);\n\t\t}\n\n\t\treturn \"Property not found\";\n\t}\n\t\n\t/**\n\t * Validates and cleans the link text\n\t * \n\t * @function validate\n\t */\n\tvalidate(){\n\t\tvar source = this.linkPassage.text.split(\"[[\");\n\t\tvar rebuild = \"\";\n\n\t\tfor(var i = 0; i < source.length - 1; i++){\n\t\t\t\n\t\t\trebuild += source[i];\n\n\t\t\tif(source[i + 1].includes(\"]]\")){\n\t\t\t\trebuild += \"[[\";\n\t\t\t}\n\t\t}\n\n\t\trebuild += source[source.length - 1];\n\n\t\tthis.linkPassage.text = rebuild.trim();\n\t}\n}\n\nmodule.exports = Page;\n","//import Axios from 'axios'\nimport tweeConverter from \"../mixins/tweeConverterMixin\"\n\nexport default{\n  methods:{\n    browserView(item){\n      var linkBlob = new Blob([this.html(item.text)] , {type:\"text/html\"})\n      \n      const link = document.createElement('a');\n      link.href = URL.createObjectURL(linkBlob);\n      link.target = \"_blank\";\n      link.click();\n      URL.revokeObjectURL(link.href)\n    },\n\n    editorView(item){\n      sessionStorage.setItem(\"createTemplate\", \"\");\n      sessionStorage.setItem(\"OGstoryPassages\", \"\");\n      sessionStorage.setItem(\"storyLocation\", \"\");\n      sessionStorage.setItem(\"storyContent\", item.text);\n\n      const link = document.createElement('a');\n      link.href = \"editor.html\";\n      link.click();\n      URL.revokeObjectURL(link.href);\n\n    },\n\n    async updateViewsBrowser(item) {\n      await this.updateViews(item.id, item.title, item.author, item.synopsis, item.tags, item.views, item.dateNow, item.dateAdded, item.text, item.creator, item.storyKey);\n      this.browserView(item);\n    },\n\n    async updateViewsEditor(item) {\n      await this.updateViews(item.id, item.title, item.author, item.synopsis, item.tags, item.views, item.dateNow, item.dateAdded, item.text, item.creator, item.storyKey);\n      this.editorView(item);\n    },\n  },\n  mixins: [tweeConverter],\n}","import { firestoredb } from '../firebaseConfig'\n\nexport default {\n  data() {\n    return {\n      Typesense: require('typesense'),\n      client: '',\n      stories: [],\n    }\n  },\n  methods: {\n    createClient() {\n      this.client = new this.Typesense.Client({\n        'nodes': [{\n          //'host': 'localhost',\n          // 'host': 'vcm-15431.vm.duke.edu',\n          // 'port': '8108',\n          // 'protocol': 'https',\n          'host': 'av2xrki6y54hl3wbp-1.a1.typesense.net',\n          'port': '443',\n          'protocol': 'https',\n        }],\n        // 'apiKey': 'YOYCpFLj9u412ihigstCer5Zs2StzptR',\n        'apiKey': \"I1RDnpfBxdpllDchtj7gslzsqwpmnvmi\",\n      });\n    },\n    addStory(newStory) {\n      this.createClient();\n      const storeKey = firestoredb.collection('stories').doc().id;\n      newStory.storyKey = storeKey;\n      this.client.collections('stories').documents().create(newStory);\n      firestoredb.collection('stories').doc(storeKey).set(newStory);\n      this.isSubmitted = true;\n    },\n    removeStory(ID, storyKey) {\n      if (confirm(\"Are you sure you want to delete this story?\")) {\n        this.createClient();\n        this.client.collections('stories').documents(ID).delete();\n        firestoredb.collection('stories').doc(storyKey).delete();\n        this.isDeleted = true;\n      }\n    },\n    async updateViews(id, title, author, synopsis, tags, views, dateNow, dateAdded, text, creator, storyKey) {\n\n      this.createClient()\n      const updatedViewsStory = { //This is the story that is added when the button is pressed\n        \"id\": id,\n        \"title\": title,\n        \"author\": author,\n        \"synopsis\": synopsis,\n        \"tags\": tags,\n        \"views\": views + 1,\n        \"dateNow\": dateNow,\n        \"dateAdded\": dateAdded,\n        \"text\": text,\n        \"creator\": creator,\n        \"storyKey\": storyKey,\n      }\n\n      try {\n        await this.client.collections('stories').documents(id).delete();\n        console.log(\"Deleting existing story.\");\n      } catch (error) {\n        return;\n      }\n\n      try {\n        await this.client.collections('stories').documents().create(updatedViewsStory).then(function (returnData) {\n          console.log(returnData)\n        });\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    getStory(ID) {\n      this.createClient();\n      var storyHolder = [];\n      this.client.collections('stories').documents(ID).retrieve().then(function (data) {\n        storyHolder.push(data);\n      });\n      return storyHolder\n    },\n    retrieveTitles() {\n      this.createClient();\n      var titleArray = [];\n      this.client.collections('stories').documents().export().then(function (data) {\n        for (let key in data) {\n          titleArray.push(JSON.parse(data[key]).title)\n        }\n      });\n      return titleArray;\n    },\n    retrieveStoryTags(storyTitle) {\n      this.createClient();\n      var tagArray = [];\n      this.client.collections('stories').documents().export().then(function (data) {\n        for (let key in data) {\n          if (JSON.parse(data[key]).title === storyTitle) {\n            for (let tag in JSON.parse(data[key]).tags) {\n              tagArray.push(JSON.parse(data[key]).tags[tag]);\n            }\n          }\n        }\n      });\n      return tagArray;\n    },\n    retrieveUserStories(userEmail) {\n      this.createClient();\n      var storiesArray = [];\n      this.client.collections('stories').documents().export().then(function (data) {\n        for (let key in data) {\n          if (JSON.parse(data[key]).creator === userEmail) {\n            storiesArray.push(JSON.parse(data[key]))\n          }\n        }\n      });\n      return storiesArray;\n    },\n    removeTitleSpaces(title) {\n      var replaced = title.split(\" \").join(\"-\");\n      return replaced\n    }\n  }\n}\n","/**\n * @class Passage\n * @module Passage\n */\nclass Passage {\n  /**\n   * @function Passage\n   * @class\n   * @param {string} name - Name of passage\n   * @param {Array} tags - Tags\n   * @param {object} metadata - Metadata\n   * @param {string} text - Passage Content\n   * @param {number} pid - Passage ID (PID)\n   */\n  constructor (name = '', tags = [], metadata = {}, text = '', pid = 1) {\n    this.name = name;\n    this.tags = tags;\n    this.metadata = metadata;\n    this.text = text;\n    this.pid = pid;\n  }\n}\n\nmodule.exports = Passage;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.givenStory[0])?_c('div',[(!_vm.isDeleted)?_c('v-card',{staticClass:\"container\",attrs:{\"flat\":\"\"}},[(_vm.givenStory)?_c('v-card-title',{staticClass:\"display-1\"},[_vm._v(\" \"+_vm._s(_vm.givenStory[0].title)+\" \"),_c('v-spacer'),_c('v-btn',{attrs:{\"outlined\":\"\"},on:{\"click\":function($event){return _vm.updateViewsBrowser(_vm.givenStory[0])}}},[_vm._v(\"View in Browser\")]),_c('v-btn',{staticClass:\"ml-2\",attrs:{\"outlined\":\"\"},on:{\"click\":function($event){return _vm.updateViewsEditor(_vm.givenStory[0])}}},[_vm._v(\"Edit Story\")]),(_vm.givenStory[0].creator === _vm.userEmail)?_c('v-btn',{staticClass:\"ml-2\",attrs:{\"outlined\":\"\"},on:{\"click\":function($event){return _vm.removeStory(_vm.givenStory[0].id, _vm.givenStory[0].storyKey)}}},[_vm._v(\"Delete Story\")]):_vm._e()],1):_vm._e(),_c('v-card-subtitle',[_vm._v(\" by \"+_vm._s(_vm.givenStory[0].author)+\" \"),_c('v-spacer'),_vm._v(\" Created on \"+_vm._s(_vm.givenStory[0].dateAdded)+\" | \"+_vm._s(_vm.givenStory[0].views)+\" views \")],1),_c('v-card-title',[_vm._v(\"Synopsis\")]),_c('v-card-text',[_vm._v(_vm._s(_vm.givenStory[0].synopsis))]),_c('v-card-actions',[_c('v-chip',{staticClass:\"ml-2\"},[_c('v-icon',{attrs:{\"small\":\"\"}},[_vm._v(\"mdi-tag\")]),_vm._v(\" Tags \")],1),_vm._l((_vm.givenStory[0].tags),function(tag){return _c('v-chip',{key:tag['.key'],staticClass:\"ml-2\",attrs:{\"color\":\"orange\",\"text-color\":\"white\"}},[_vm._v(\" \"+_vm._s(tag)+\" \")])})],2),_c('v-list',{attrs:{\"two-line\":\"\"}},[_c('v-card-title',{staticClass:\"pb-0\"},[_vm._v(\"Comments\")]),_vm._l((_vm.storyComments),function(comment){return _c('div',{key:comment['.key']},[(comment.storyTitle === _vm.givenStory[0].title)?_c('v-list-item',{staticClass:\"comment\"},[(!_vm.currentlyEditing || comment.commentKey !== _vm.editCommentKey)?_c('v-list-item-content',[_c('v-list-item-title',{staticClass:\"text-wrap\"},[_vm._v(_vm._s(comment.comment))]),_c('v-list-item-subtitle',[_vm._v(\" \"+_vm._s(comment.name)+\" \"+_vm._s(comment.dateAdded)+\" \")])],1):_vm._e(),(!_vm.currentlyEditing || comment.commentKey !== _vm.editCommentKey)?_c('v-list-item-action',{staticClass:\"comment-actions\"},[(_vm.userEmail === comment.email)?_c('v-btn',{attrs:{\"title\":\"Edit Comment\",\"icon\":\"\"},on:{\"click\":function($event){return _vm.confirmEdit(comment.commentKey, comment.comment)}}},[_c('v-icon',[_vm._v(\"mdi-pencil\")])],1):_vm._e()],1):_vm._e(),(!_vm.currentlyEditing || comment.commentKey !== _vm.editCommentKey)?_c('v-list-item-action',{staticClass:\"comment-actions\"},[(_vm.userEmail === comment.email)?_c('v-btn',{attrs:{\"title\":\"Remove Comment\",\"icon\":\"\"},on:{\"click\":function($event){return _vm.removeComment(comment.commentKey, _vm.userID)}}},[_c('v-icon',[_vm._v(\"mdi-delete\")])],1):_vm._e()],1):_vm._e(),(comment.commentKey === _vm.editCommentKey)?_c('v-list-item-content',[_c('form',{staticClass:\"edit-comment\"},[_c('v-text-field',{model:{value:(_vm.commentEdit),callback:function ($$v) {_vm.commentEdit=$$v},expression:\"commentEdit\"}}),_c('v-btn',{staticClass:\"mb-2\",attrs:{\"outlined\":\"\",\"small\":\"\"},on:{\"click\":function($event){return _vm.editComment(comment.commentKey, _vm.userID, _vm.commentEdit)}}},[_vm._v(\"Submit\")])],1)]):_vm._e()],1):_vm._e()],1)})],2),_c('v-card-text',{staticClass:\"pt-1\"},[_c('v-btn',{attrs:{\"outlined\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.showAddComment = true}}},[_vm._v(\"Add Comment\")]),(_vm.showAddComment)?_c('div',{staticClass:\"add-comment\"},[(_vm.isVerified)?_c('addComment',{attrs:{\"givenStoryTitle\":_vm.givenStory[0].title}}):_vm._e(),(!_vm.isLoggedIn)?_c('p',[_vm._v(\" You need to log in to comment\")]):_vm._e()],1):_vm._e()],1)],1):_vm._e(),(_vm.isDeleted)?_c('h3',[_vm._v(\"This story has been deleted!\")]):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('form',[(!_vm.commentChecker)?_c('v-text-field',{attrs:{\"disabled\":_vm.isSubmitted,\"label\":\"Add a comment...\",\"required\":\"\"},model:{value:(_vm.newComment.comment),callback:function ($$v) {_vm.$set(_vm.newComment, \"comment\", $$v)},expression:\"newComment.comment\"}}):_vm._e(),(!_vm.commentChecker)?_c('button',{staticClass:\"button\",attrs:{\"disabled\":!_vm.commentComplete},on:{\"click\":function($event){return _vm.getTags()}}},[_vm._v(\"Next\")]):_vm._e()],1),_c('div',{attrs:{\"id\":\"second-form\"}},[_c('form',[(_vm.commentChecker)?_c('v-select',{attrs:{\"items\":_vm.tagsInStory,\"disabled\":_vm.isSubmitted,\"multiple\":true,\"label\":\"Tags that you found were well-represented in this story\",\"required\":\"\"},model:{value:(_vm.newComment.helpfulTags),callback:function ($$v) {_vm.$set(_vm.newComment, \"helpfulTags\", $$v)},expression:\"newComment.helpfulTags\"}}):_vm._e(),(_vm.commentChecker && !_vm.isSubmitted)?_c('button',{staticClass:\"button\",attrs:{\"disabled\":!_vm.tagsComplete},on:{\"click\":function($event){return _vm.post()}}},[_vm._v(\"Comment\")]):_vm._e(),(_vm.isSubmitted)?_c('p',[_vm._v(\"Thank you for commenting!\")]):_vm._e()],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <form>\n      <v-text-field\n        v-model=\"newComment.comment\"\n        v-if=\"!commentChecker\"\n        :disabled=\"isSubmitted\"\n        label=\"Add a comment...\"\n        required\n      />\n      <button class=\"button\" :disabled=\"!commentComplete\" v-if=\"!commentChecker\" v-on:click=\"getTags()\">Next</button>\n    </form>\n    <div id=\"second-form\">\n      <form>\n      <v-select\n        v-model=\"newComment.helpfulTags\"\n        v-if=\"commentChecker\"\n        :items=\"tagsInStory\"\n        :disabled=\"isSubmitted\"\n        :multiple=\"true\"\n        label=\"Tags that you found were well-represented in this story\"\n        required\n      />\n      <button class=\"button\" :disabled=\"!tagsComplete\" v-if=\"commentChecker && !isSubmitted\" v-on:click=\"post()\">Comment</button>\n      <p v-if=\"isSubmitted\">Thank you for commenting!</p>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport storyMixin from \"@/mixins/storyMixin\"\nimport firebase from 'firebase'\nimport firebaseMixin from \"@/mixins/firebaseMixin\"\nimport { db } from \"@/firebaseConfig\"\n\nvar d = new Date();\n\nexport default {\n  props: ['givenStoryTitle'],\n  data (){\n    return{\n      newComment: {\n        \"storyTitle\": '',\n        \"name\": '',\n        \"email\": '',\n        \"comment\": '',\n        \"dateNow\": Date.now(),\n        \"dateAdded\": d.getMonth()+1+'/'+d.getDate()+'/'+d.getFullYear(), \n        \"helpfulTags\": [],\n        \"commentKey\":'',\n      },\n      isSubmitted: false,\n      nameArray:[],\n      commentChecker: false,\n      tagsInStory: [],\n    }\n  },\n  computed: {\n    commentComplete () {\n      return this.newComment.comment && this.newComment.storyTitle\n    },\n    tagsComplete(){\n      if(this.newComment.helpfulTags.length > 0){\n        return true\n      }\n      return false\n    }\n  },\n  methods: {\n    getTags(){\n      this.tagsInStory = this.retrieveStoryTags(this.newComment.storyTitle)\n      this.commentChecker = true;\n    },\n    post(){\n      var newKey = db.ref().push().key;\n      this.newComment.commentKey = newKey\n      db.ref('accounts/'+firebase.auth().currentUser.uid + '/comments/' + newKey).update(this.newComment);\n      db.ref('comments/' + newKey).update(this.newComment)\n      this.isSubmitted = true;\n    },\n  },\n  created() {\n    this.newComment.storyTitle = this.givenStoryTitle;\n    if(firebase.auth().currentUser){\n      this.newComment.name = firebase.auth().currentUser.displayName\n      this.newComment.email = firebase.auth().currentUser.email\n    }\n  },\n  mixins: [storyMixin, firebaseMixin],\n}\n</script>\n\n<style scoped>\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addComments.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addComments.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./addComments.vue?vue&type=template&id=b4afe72e&scoped=true&\"\nimport script from \"./addComments.vue?vue&type=script&lang=js&\"\nexport * from \"./addComments.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b4afe72e\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VSelect,VTextField})\n","<template>\n  <div v-if=\"givenStory[0]\">\n    <v-card flat class=\"container\" v-if=\"!isDeleted\">\n      <v-card-title v-if=\"givenStory\" class=\"display-1\">\n        {{givenStory[0].title}} \n        <v-spacer></v-spacer>\n        <v-btn outlined v-on:click=\"updateViewsBrowser(givenStory[0])\">View in Browser</v-btn>\n        <v-btn outlined class=\"ml-2\" v-on:click=\"updateViewsEditor(givenStory[0])\">Edit Story</v-btn>\n        <v-btn outlined class=\"ml-2\" v-if=\"givenStory[0].creator === userEmail\" v-on:click=\"removeStory(givenStory[0].id, givenStory[0].storyKey)\">Delete Story</v-btn>\n        \n      </v-card-title>\n\n        <v-card-subtitle>\n        by {{givenStory[0].author}}\n        <v-spacer></v-spacer>\n        Created on {{givenStory[0].dateAdded}} | {{givenStory[0].views}} views\n      </v-card-subtitle>\n\n      <v-card-title>Synopsis</v-card-title>\n      <v-card-text>{{givenStory[0].synopsis}}</v-card-text>\n      \n      <v-card-actions>\n        <v-chip class=\"ml-2\">\n          <v-icon small>mdi-tag</v-icon> Tags\n        </v-chip>\n        <v-chip class=\"ml-2\" color=\"orange\" text-color=\"white\" v-for=\"tag of givenStory[0].tags\" v-bind:key=\"tag['.key']\">\n          {{tag}}\n        </v-chip>\n      </v-card-actions>\n\n      <v-list two-line>\n        <v-card-title class=\"pb-0\">Comments</v-card-title>\n        <div v-for=\"comment of storyComments\" v-bind:key=\"comment['.key']\">\n          <v-list-item class= \"comment\" v-if=\"comment.storyTitle === givenStory[0].title\">\n            <v-list-item-content v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-list-item-title class=\"text-wrap\">{{comment.comment}}</v-list-item-title>\n              <v-list-item-subtitle>\n                {{comment.name}} {{comment.dateAdded}}\n              </v-list-item-subtitle>\n            </v-list-item-content>  \n            \n            <v-list-item-action class = \"comment-actions\" v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-btn title = \"Edit Comment\" icon v-if=\"userEmail === comment.email\" v-on:click=\"confirmEdit(comment.commentKey, comment.comment)\">\n                <v-icon>mdi-pencil</v-icon>\n              </v-btn>\n            </v-list-item-action>\n            <v-list-item-action class = \"comment-actions\" v-if=\"!currentlyEditing || comment.commentKey !== editCommentKey\">\n              <v-btn title = \"Remove Comment\" icon v-if=\"userEmail === comment.email\" v-on:click=\"removeComment(comment.commentKey, userID)\">\n                <v-icon>mdi-delete</v-icon>\n              </v-btn>\n            </v-list-item-action>\n\n            <v-list-item-content v-if=\"comment.commentKey === editCommentKey\">\n              <form class = \"edit-comment\">\n                <v-text-field v-model=\"commentEdit\"></v-text-field>\n                <v-btn class=\"mb-2\" outlined small v-on:click=\"editComment(comment.commentKey, userID, commentEdit)\">Submit</v-btn>\n              </form>\n            </v-list-item-content>\n          </v-list-item>\n        </div>\n      </v-list>\n\n      <v-card-text class=\"pt-1\">\n        <v-btn outlined small @click=\"showAddComment = true\">Add Comment</v-btn>\n        <div class=\"add-comment\" v-if=\"showAddComment\">\n          <addComment v-if=\"isVerified\" v-bind:givenStoryTitle = \"givenStory[0].title\" />\n          <p v-if=\"!isLoggedIn\"> You need to log in to comment</p>\n        </div>\n      </v-card-text>\n    </v-card>\n\n    <!--<h3>Ratings for Tags:</h3>\n    <div v-for=\"(object,i) in tagsData\" :key=\"i\">\n      <ul v-for=\"(tag,i) in object[givenStory[0].title]\" :key=\"i\">\n        <li>\n          {{tag[0]}}: {{tag[1]}}\n        </li>\n      </ul>\n    </div>-->\n\n    <h3 v-if=\"isDeleted\">This story has been deleted!</h3>\n  </div>\n</template>\n\n<script>\nimport firebase from 'firebase'\nimport storyMixin from \"@/mixins/storyMixin\"\nimport firebaseMixin from \"@/mixins/firebaseMixin\"\nimport browserEditorMixin from \"@/mixins/browserEditorMixin\"\nimport { commentsRef } from \"@/firebaseConfig\"\nimport addComment from '@/components/comments/addComments.vue' \n\nexport default {\n  name: 'Story',\n  components:{\n    addComment,\n  },\n  data (){\n    return{\n      storyID: '',\n      tagsData:[],\n      givenStory:[{}],\n      storyComments: [],\n      givenStoryComments: [],\n      isLoggedIn: false,\n      isVerified: false, \n      showAddComment: false,\n      isMyComment: false,\n      userEmail: '',\n      userID: '',\n      editCommentKey: '',\n      commentEdit: '',\n      currentlyEditing: false,\n      isDeleted: false,\n    }\n  },\n  firebase:{\n    storyComments: commentsRef,\n  },\n  methods: {\n    populateTagsObj(){\n      var arr = []\n      var keys = {}\n      const query = commentsRef.orderByKey();\n      query.once('value')\n        .then(function(snapshot) {\n          snapshot.forEach(function(childSnapshot) {\n            var key = childSnapshot.val().storyTitle;\n            if(typeof keys[key] === \"undefined\"){\n              keys[key] = {}\n            }\n            childSnapshot.val().helpfulTags.forEach(function(tag) {\n              if(typeof keys[key][tag] === \"undefined\"){\n                keys[key][tag] = 0;\n              }\n              keys[key][tag] += 1;\n            })\n          })\n          for(let key in keys){\n            keys[key] = Object.entries(keys[key])\n            keys[key].sort(function(a,b){\n              return b[1]-a[1]\n            })\n            if(keys[key].length>3){\n              keys[key] = keys[key].slice(0,3)\n            }\n          }\n          arr.push(keys)\n        })\n      return arr;\n    },\n    showAdd() {\n      this.ShowAddComments = true;\n    },\n    confirmEdit(commentKey, comment){\n      this.editCommentKey = commentKey;\n      this.commentEdit = comment;\n      this.currentlyEditing = true;\n    },\n  },\n  async created(){\n    if(firebase.auth().currentUser){\n      this.isVerified = firebase.auth().currentUser.emailVerified\n      this.isLoggedIn = firebase.auth().currentUser;\n      this.userEmail = firebase.auth().currentUser.email;\n      this.userID = firebase.auth().currentUser.uid;\n    }\n    this.tagsData = this.populateTagsObj();\n    this.storyID = this.$route.params.id;\n    this.givenStory = await this.getStory(this.storyID)\n\n  \n  },\n  mixins: [storyMixin, browserEditorMixin, firebaseMixin],\n}\n</script>\n\n<style scoped>\n.comment .comment-actions{\n  visibility: hidden;\n}\n.comment:hover .comment-actions{\n  visibility: visible;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./storyPage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./storyPage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./storyPage.vue?vue&type=template&id=6e0e829c&scoped=true&\"\nimport script from \"./storyPage.vue?vue&type=script&lang=js&\"\nexport * from \"./storyPage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./storyPage.vue?vue&type=style&index=0&id=6e0e829c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6e0e829c\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VList } from 'vuetify/lib/components/VList';\nimport { VListItem } from 'vuetify/lib/components/VList';\nimport { VListItemAction } from 'vuetify/lib/components/VList';\nimport { VListItemContent } from 'vuetify/lib/components/VList';\nimport { VListItemSubtitle } from 'vuetify/lib/components/VList';\nimport { VListItemTitle } from 'vuetify/lib/components/VList';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardSubtitle,VCardText,VCardTitle,VChip,VIcon,VList,VListItem,VListItemAction,VListItemContent,VListItemSubtitle,VListItemTitle,VSpacer,VTextField})\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./storyPage.vue?vue&type=style&index=0&id=6e0e829c&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./storyPage.vue?vue&type=style&index=0&id=6e0e829c&scoped=true&lang=css&\"","function getTitle (vm) {\n  const { title } = vm.$options\n  if (title) {\n    return typeof title === 'function'\n      ? title.call(vm)\n      : title\n  }\n}\nexport default {\n  created () {\n    const title = getTitle(this)\n    if (title) {\n      document.title = title\n    }\n  }\n}","/**\n * @external Story\n * @see Story.js\n */\n\nconst Story = require('./Story.js');\n\n/**\n * @class TweeWriter\n * @module TweeWriter\n */\nclass TweeWriter {\n  /**\n   * @function TweeWriter\n   * @class\n   * @param {Story} story - Story object to write\n   * @param {string} file - File to write to\n   */\n  constructor (story) {\n    if (!(story instanceof Story)) {\n      throw new Error('Not a Story object!');\n    }\n\n    this.output = null;\n\n    this.writeFile(story);\n  }\n\n  /**\n   * Write to a file using a Story object\n   *\n   * @param {Story} story - Story format to write\n   * @returns {void}\n   */\n  writeFile (story) {\n    // Write StoryTitle first\n    let outputContents = ':: StoryTitle\\n' + story.name + '\\n\\n';\n\n    // Write the StoryData second\n    outputContents += ':: StoryData\\n';\n\n    // Test if story.metadata is an object or not\n    if (typeof story.metadata === 'object') {\n      // Write any metadata in pretty format\n      outputContents += ' ' + JSON.stringify(story.metadata, undefined, 2);\n    } else {\n      // If, for whatever reason, story.metadata is not an object, throw error.\n      throw new Error('Story Metadata MUST be an object!');\n    }\n\n    // Add two newlines\n    outputContents += '\\n\\n';\n\n    // Are there any passages?\n    if (story.passages.length > 0) {\n      // Build the contents\n      for (const passage in story.passages) {\n        // Write the name\n        outputContents += ':: ' + story.passages[passage].name;\n\n        // Test if it has any tags\n        if (story.passages[passage].tags.length > 0) {\n          outputContents += ' [';\n\n          for (const tag of story.passages[passage].tags) {\n            outputContents += ' ' + tag;\n          }\n\n          outputContents += ']';\n        }\n\n        // Write out any passage metadata\n        outputContents += JSON.stringify(story.passages[passage].metadata);\n\n        // Add the text and two newlines\n        outputContents += '\\n' + story.passages[passage].text + '\\n\\n';\n      }\n    } else {\n      // Create empty Start passage\n      outputContents += ':: Start\\n';\n    }\n\n    this.output = outputContents;\n  }\n}\n\nmodule.exports = TweeWriter;\n","const Passage = require(\"./Passage\");\nconst Page = require(\"./Page\");\nconst Story = require(\"./Story\");\n\nconst VAR_TAG = 'variables';\n\n/*const SWATCHES = [\"#33658A\" , \"#86BBD8\", \"#2F4858\", \"#F6AE2D\", \"#F26419\", \"#8AAA79\", \"#FA8334\", \"#FFFD77\",\n                    \"#FFE882\", \"#388697\", \"#271033\", \"#50514F\", \"#F79256\", \"#FBD1A2\", \"#7DCFB6\", \"#00B2CA\",\n                    \"#1D4E89\", \"#7E78D2\", \"#E71D36\", \"#AF4319\", \"#772014\", \"#3F220F\", \"#19180A\", \"#C0F8D1\"];*/\n\nvar NUM_VARS = 0;\nvar NUM_IMG_VARS = 0;\nvar NUM_AUD_VARS = 0;\n\n/**\n * @class StoryEditor\n * @module StoryEditor\n */\nclass StoryEditor {\n    /**\n     * @function StoryEditor\n     * @param {Story} story - The story to generate\n     * @class StoryEditor\n     */\n    constructor(story) {\n\n        this.baseStory = story;\n        this.exportedStoryPages = [];\n\n        this.variables = new Map();\n        this.imageVariables = new Map();\n        this.audioVariables = new Map();\n\n        this.css = \"\";\n        this.js = \"\";\n        \n        this.regeneratePages();\n\n        this.parseVariables();\n        this.generateStoryText(true);\n\n        this.reparseMedia();\n    }\n\n    /** \n     * Get the default value of a text variable\n     * \n     * @function extractDefault\n     * @param {string} line - Line to extract from\n     * @returns {String}\n     */\n    extractDefault(line) {\n\n        var pos1 = line.indexOf(\";\");\n        var pos2 = line.lastIndexOf(\"&\");\n\n        return line.slice(pos1 + 1, pos2);\n\n    }\n\n    /**\n     * Changes the value of the variable\n     * \n     * @param {String} line - Line to splice into\n     * @param {String} newVal - Value to splice\n     * @returns {String}\n     */\n    writeVariable(line, newVal) {\n        var pos1 = line.indexOf(\";\");\n        var pos2 = line.lastIndexOf(\"&\");\n\n        return line.slice(0, pos1 + 1) + newVal + line.slice(pos2, line.length);\n\n    }\n\n    /** \n     * Get the default name of a text variable\n     * \n     * @function extractVariable\n     * @param {String} line - Line to extract from\n     * @returns {String}\n     */\n    extractVariable(line) {\n        var pos = line.indexOf(\"$\");\n\n        var variable = \"\";\n\n        while ((line.charAt(pos)) != \" \") {\n            variable += line.charAt(pos);\n            pos++;\n        }\n\n        return variable;\n    }\n\n    /** \n     * Obtain all the variables from a story object\n     * \n     * @function parseVariables\n     * @returns {void}\n     */\n    parseVariables() {\n\n        //Extract the passage with variable tag,\n        //IMPORTANT: VAR_TAG SHOULD NOT BE USED DURING STORY CREATION\n        //           THIS PASSAGE WILL BE AUTOMATICALLY GENERATED AND ADDED \n        //           TO THE FIRST PASSAGE OF THE STORY.\n        let variablePassage = [];\n\n        if (this.baseStory.passages.length > 0) {\n            variablePassage = this.baseStory.passages.filter(function (passage) {\n                const results = passage.tags.filter(tag => tag === VAR_TAG);\n\n                return (results.length > 0);\n            });\n        }\n\n        this.variables.clear();\n        //Checks if there is only one passage with the variable tag\n\n        if (variablePassage.length == 1) {\n            var variableText = variablePassage[0].text;\n            var lines = variableText.split(\"\\n\");\n\n            console.log(lines.length);\n\n            for (var j = 0; j < lines.length; j++) {\n\n                if (lines[j].includes(\"(set:\")) {\n\n                    //Adds each variable to a js Map\n\n                    var variable = this.extractVariable(lines[j]);\n                    var defVal = this.extractDefault(lines[j]);\n                    \n                    if(this.variables.has(variable)){\n                        alert(\"Duplicate Variable \\n\\nUpdating Value to: \" + \"\\\"\" + defVal + \"\\\"\");\n                    }\n\n\n                    this.variables.set(variable, {value: defVal, color: \"\", id: NUM_VARS++});\n                    console.log(variable + \" \" + defVal);\n\n                } else if(lines[j].includes(\"(hidden:)\")){\n                    var varData = this.extractArr(lines[j]); \n\n                    if(varData.type == \"image\"){\n\n                        for(var k = 0; k < varData.data.length; k++){\n                            var imgSrc = this.extractSrc(varData.data[k]);\n\n                            this.imageVariables.set(varData.data[k].substring(0, varData.data[k].indexOf(\"{\")), {file: null, fileName: imgSrc.name, path: imgSrc.src, color: \"\", id: NUM_IMG_VARS++, uploaded: !imgSrc.src.i.includes(\"blob\")});\n                        }\n                    } else if(varData.type == \"audio\"){\n\n                        for(var a = 0; a < varData.data.length; a++){\n                            var audSrc = this.extractSrc(varData.data[a]);\n\n                            this.audioVariables.set(varData.data[a].substring(0, varData.data[a].indexOf(\"{\")), {file: null, fileName: imgSrc.name, path: audSrc.src, color: \"\", id: NUM_AUD_VARS++, uploaded: !audSrc.src.i.includes(\"blob\")});\n                        }\n\n                    }\n\n                }\n\n            }\n\n            lines = lines.filter(function(line) {\n                return !line.includes(\"(set:\") && !line.includes(\"(hidden:)\");  \n            });\n            \n            for(var l = 0; l<  this.baseStory.passages.length; l++){\n                if(this.baseStory.passages[l].tags.includes(VAR_TAG)){\n\n                    this.baseStory.passages[l].text = lines.join(\"\\n\");\n\n                    break;\n                }\n            }\n        } else {\n            throw new Error(\"Please remove extra variable passage tags\");\n        }\n\n        this.detVariableColors();\n        this.printVariableData();\n    }\n\n    /**\n     * Extracts the image variable data in the story\n     * \n     * @function extractArr\n     * @param {String} line \n     */\n    extractArr(line){\n        var source = line.split(\"[\");\n        var chunk = source[1].replace(\"]\", \"\");\n        source = chunk.split(\":\");\n\n        var type = source[0];\n        var arr = chunk.replace(source[0] + \":\", \"\").split(\",\");\n\n        arr = arr.filter(function(i){\n            return i != \"\";\n        })\n\n        console.log(arr);\n\n        return {type: type, data: arr};\n    }\n\n    extractSrc(line){\n        var source = line.split(\"{\");\n\n        var src = \"\";\n        var fileName = \"\";\n\n        if(source.length > 1){\n            src = source[1].split(\" \")[0];\n            fileName = source[1].split(\" \")[1].replace(\"}\", \"\");\n        }\n\n        return {src: {i: src}, name: fileName};\n    }\n\n    /**\n     * Removes the variable code injection\n     * \n     * @function removeVariableInject\n     * \n     */\n    removeVariableInject(){\n\n        var text = sessionStorage.getItem(\"preProcessedBaseText\");\n        var process = text != \"\";\n\n        if(process){\n            for(var k = 0; k< this.baseStory.passages.length; k++){\n                if(this.baseStory.passages[k].tags.includes(VAR_TAG)){\n                \n                    \n                    this.baseStory.passages[k].text = text;\n\n                    break;\n                }\n            }\n\n            for(var i = 0; i< this.exportedStoryPages.length; i++){\n                if(this.exportedStoryPages[i].linkPassage.tags.includes(VAR_TAG)){\n\n                    this.exportedStoryPages[i].linkPassage.text = text;\n                    break;\n                }\n            }\n        }\n\n        /*let variablePassage = [];\n\n        if (this.baseStory.passages.length > 0) {\n            variablePassage = this.baseStory.passages.filter(function (passage) {\n                const results = passage.tags.filter(tag => tag === VAR_TAG);\n\n                return (results.length > 0);\n            });\n        }\n\n        //Checks if there is only one passage with the variable tag\n\n        if (variablePassage.length == 1) {\n            var variableText = variablePassage[0].text;\n            var lines = variableText.split(\"\\n\");\n\n            lines = lines.filter(function(line) {\n                return !line.includes(\"(set:\");  \n            });\n            \n            for(var k = 0; k< this.baseStory.passages.length; k++){\n                if(this.baseStory.passages[k].tags.includes(VAR_TAG)){\n                    this.baseStory.passages[k].text = lines.join(\"\\n\");\n\n                    break;\n                }\n            }\n        } else {\n            throw new Error(\"Please remove extra variable passage tags\");\n        }*/\n    }\n\n    detVariableColors(){\n        this.detTextVariableColors();\n        this.detImageVariableColors();\n        this.detAudioVariableColors();\n    }\n\n    detImageVariableColors(){\n        var sortedKeys = [];\n\n\t\tthis.imageVariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n        );\n        \n        var varMap = this.imageVariables;\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            var idA = varMap.get(a).id;\n            var idB = varMap.get(b).id;\n\n            return idA - idB;\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.imageVariables.get(sortedKeys[i]);\n\n\n            if(data.color == \"\"){\n                var oR = 255;\n                var oG = 165;\n                var oB = 0;\n\n                var randR = Math.random() * 256\n                var randG = Math.random() * 256;\n                var randB = Math.random() * 256;\n\n                data.color = \"rgb(\" + ((oR + randR)/2) + \",\" + ((oG + randG)/2) + \",\" + ((oB + randB)/2) + \")\";\n            }\n\n            this.imageVariables.set(sortedKeys[i], data);\n        }\n    }\n\n    detAudioVariableColors(){\n        var sortedKeys = [];\n\n\t\tthis.audioVariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n        );\n        \n        var varMap = this.audioVariables;\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            var idA = varMap.get(a).id;\n            var idB = varMap.get(b).id;\n\n            return idA - idB;\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.audioVariables.get(sortedKeys[i]);\n\n\n            if(data.color == \"\"){\n                var oR = 255;\n                var oG = 165;\n                var oB = 0;\n\n                var randR = Math.random() * 256\n                var randG = Math.random() * 256;\n                var randB = Math.random() * 256;\n\n                data.color = \"rgb(\" + ((oR + randR)/2) + \",\" + ((oG + randG)/2) + \",\" + ((oB + randB)/2) + \")\";\n            }\n\n\n\n            this.audioVariables.set(sortedKeys[i], data);\n        }\n    }\n    /**\n     * Determines the swatch of the variable\n     * \n     * @function detVariableColors\n     * \n     */\n    detTextVariableColors(){\n        var sortedKeys = [];\n\n\t\tthis.variables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n        );\n        \n        var varMap = this.variables;\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            var idA = varMap.get(a).id;\n            var idB = varMap.get(b).id;\n\n            return idA - idB;\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.variables.get(sortedKeys[i]);\n\n\n            if(data.color == \"\"){\n                var oR = 255;\n                var oG = 165;\n                var oB = 0;\n\n                var randR = Math.random() * 256\n                var randG = Math.random() * 256;\n                var randB = Math.random() * 256;\n\n                data.color = \"rgb(\" + ((oR + randR)/2) + \",\" + ((oG + randG)/2) + \",\" + ((oB + randB)/2) + \")\";\n            }\n\n\n\n            this.variables.set(sortedKeys[i], data);\n        }\n\t\t\n    }\n\n    printVariableData(){\n        this.imageVariables.forEach(function(data, key){\n            console.log(key + \"==>\" + JSON.stringify(data));\n        });\n\n        this.audioVariables.forEach(function(data, key){\n            console.log(key + \"==>\" + JSON.stringify(data));\n        });\n\n        this.variables.forEach(function(data, key){\n            console.log(key + \"==>\" + JSON.stringify(data));\n        });\n    }\n\n    /**\n     * Reparses the links in the passage text\n     * @function reparseLinks\n     */\n    reparseLinks(){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            this.exportedStoryPages[i].reparseLinks();\n        }\n    }\n\n    /**\n     * \n     */\n    reparseMedia(){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            this.exportedStoryPages[i].reparseMedia(this.imageVariables, this.audioVariables);\n        }\n    }\n\n    /**\n     * \n     * @param {*} event \n     */\n    addAudioToPage(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            if(this.exportedStoryPages[i].pageName == event.pageName)\n                this.exportedStoryPages[i].addAudio(event);\n        }\n        \n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /**\n     * \n     * @param {*} event \n     */\n    removeAudioFromPage(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            if(this.exportedStoryPages[i].pageName == event.pageName)\n                this.exportedStoryPages[i].removeAudio(event);\n        }\n        \n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /**\n     * \n     * @param {*} event \n     */\n    addImageToPage(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            if(this.exportedStoryPages[i].pageName == event.pageName)\n                this.exportedStoryPages[i].addImage(event);\n        }\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /**\n     * \n     * @param {*} event \n     */\n    removeImageFromPage(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n            if(this.exportedStoryPages[i].pageName == event.pageName)\n                this.exportedStoryPages[i].removeImage(event);\n        }\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n\n    /**\n     * Refactors the link text so that it is properly configured\n     * \n     * @function replaceLinks\n     * @param {Event} event \n     */\n    replaceLinks(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n\n            this.exportedStoryPages[i].replaceLinks(event);\n\n            for(var j = 0; j < this.baseStory.passages.length; j++){\n                if(this.baseStory.passages[j].name == this.exportedStoryPages[i].linkPassage.name){\n                    this.baseStory.passages[j].text = this.exportedStoryPages[i].linkPassage.text;\n                }\n            }\n        }\n    }\n\n    /**\n     * Refactors the link text so that it is properly configured\n     * \n     * @function replaceLinks\n     * @param {Event} event \n     */\n    replaceVariables(event){\n\n        var mergedMap = new Map();\n\n        this.variables.forEach(function(value, key){\n            mergedMap.set(key, value);\n        });\n\n        this.imageVariables.forEach(function(value, key){\n            mergedMap.set(key, value);\n        });\n\n        this.audioVariables.forEach(function(value, key){\n            mergedMap.set(key, value);\n        });\n\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n\n            this.exportedStoryPages[i].replaceVariable(event, mergedMap);\n\n            for(var j = 0; j < this.baseStory.passages.length; j++){\n                if(this.baseStory.passages[j].name == this.exportedStoryPages[i].linkPassage.name){\n                    this.baseStory.passages[j].text = this.exportedStoryPages[i].linkPassage.text;\n                }\n            }\n        }\n\n        /*for(var m = 0; m < this.exportedStoryPages.length; m++){\n\n            this.exportedStoryPages[m].replaceVariable(event, this.imageVariables);\n\n            for(var n = 0; n < this.baseStory.passages.length; n++){\n                if(this.baseStory.passages[n].name == this.exportedStoryPages[m].linkPassage.name){\n                    this.baseStory.passages[n].text = this.exportedStoryPages[m].linkPassage.text;\n                }\n            }\n        }\n\n        for(var k = 0; k < this.exportedStoryPages.length; k++){\n\n            this.exportedStoryPages[k].replaceVariable(event, this.audioVariables);\n\n            for(var l = 0; l < this.baseStory.passages.length; l++){\n                if(this.baseStory.passages[l].name == this.exportedStoryPages[k].linkPassage.name){\n                    this.baseStory.passages[l].text = this.exportedStoryPages[k].linkPassage.text;\n                }\n            }\n        }*/\n\n        //this.printVariableData();\n    }\n\n    /**\n     * Programmatically adds a link to a page\n     * \n     * @function addLink\n     * @param {Event} event - data\n     */\n    addLink(event){\n\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n\n            if(this.exportedStoryPages[i].pageName == event.pageName){\n                this.exportedStoryPages[i].addLink(event.name);\n                break;\n            }\n            \n        }\n\n        this.reparseLinks();\n        //this.printVariableData();\n    }\n\n    /**\n     * Removes a link from a page\n     * \n     * @function removeLink\n     * @param {Event} event - data\n     */\n    removeLink(event){\n        for(var i = 0; i < this.exportedStoryPages.length; i++){\n\n            if(this.exportedStoryPages[i].pageName == event.name){\n                this.exportedStoryPages[i].removeLink(event.removeLink);\n                break;\n            }\n            \n        }\n\n        this.reparseLinks();\n    }\n\n    /**\n     * Sets the start page for the story\n     * \n     * @function setStartPage\n     * @param {Event} event - data\n     */\n    setStartPage(event){\n\n        for(var i = 0; i < this.baseStory.passages.length; i++){\n            if(this.baseStory.passages[i].tags.includes(\"start\")){\n                this.baseStory.passages[i].tags = this.baseStory.passages[i].tags.filter(function(tag){\n                    return tag != \"start\";\n                });\n            } \n\n            if(this.baseStory.passages[i].tags.includes(VAR_TAG)){\n                this.baseStory.passages[i].tags = this.baseStory.passages[i].tags.filter(function(tag){\n                    return tag != VAR_TAG;\n                });\n            } \n\n            if(this.baseStory.passages[i].name == event.name){\n                this.baseStory.passages[i].tags.push(\"start\");\n                this.baseStory.passages[i].tags.push(VAR_TAG);\n            }\n            \n            \n            var remText = this.baseStory.passages[i].text;\n            var source = remText.split(\"\\n\");\n            \n            source = source.filter(function(line) {\n                return !line.includes(\"(set:\");  \n            });\n            \n            this.baseStory.passages[i].text = source.join(\"\\n\");\n        }\n\n        \n    }\n    \n    /**\n     * Adds a new page to the story\n     * \n     * @function addPage\n     * @param {Event} event \n     */\n    addPage(event){\n        var pageName = event.name;  \n        \n        var process = true;\n\n        if(process){\n            var baseText = \"This is a new passage. Edit it to create your own story!\\n[[go back-&gt;\" + event.prevLink + \"]]\";\n\n            var nLinkPassage = new Passage(pageName, [\"story\"], {position:\"500, 500\", size:\"100,100\"}, baseText, this.baseStory.passages.length + 1);\n            this.baseStory.passages.push(nLinkPassage);\n\n            this.exportedStoryPages.push(new Page(null, nLinkPassage, \"background-color: #ffffff; color: #000000;\", this.baseStory.getStoryPassages().length, {story: this.baseStory, pages: this.baseStory.getStoryPassages().length}));\n\n            this.reparseLinks();\n            this.reparseMedia();\n        }\n    }\n\n    /**\n     * Resets all the pages in the story\n     * \n     * @function regeneratePages\n     */\n    regeneratePages(){\n        this.exportedStoryPages = [];\n        var length = this.baseStory.getStoryPassages().length;\n\n        for(var i = 0; i < length; i++){\n            this.exportedStoryPages.push(new Page(null, this.baseStory.getStoryPassages()[i], \"background-color: #ffffff; color: #000000;\", i + 1, {story: this.baseStory, pages: length}));\n        }\n    }\n\n    /**\n     * Safely changes the passage name\n     * \n     * @function changePassageName\n     * @param {Event} event \n     */\n    changePassageName(event){\n            \n        if(event.prevName != event.newName){\n            for(var i = 0; i < this.baseStory.passages.length; i++){\n                if(this.baseStory.passages[i].name == event.prevName){\n                    this.baseStory.passages[i].name = event.newName;\n                    console.log(\"Changed Name\");\n                }\n            }\n\n            for(var j = 0; j < this.exportedStoryPages.length; j++){\n                if(this.exportedStoryPages[j].linkPassage.name == event.prevName){\n                    this.exportedStoryPages[j].linkPassage.name = event.newName;\n                    console.log(\"Changed Name\");\n                }\n            }\n\n            this.replaceLinks(event);\n            this.reparseLinks();\n        }\n    }\n\n    /**\n     * Removes a passage from the story;\n     * @function deletePassage\n     * @param {Event} event \n     */\n    deletePassage(event){\n\n        var passage;\n        var index = 0;\n\n        for(var i = 0; i< this.baseStory.passages.length; i++){\n            if(this.baseStory.passages[i].name == event.name){\n                passage = this.baseStory.passages[i];\n                index = i;\n\n                console.log(\"Passage:\" + passage.name);\n\n                break;\n            }\n        }\n\n        if(passage.tags.includes(VAR_TAG)){\n            alert(\"DELETING THIS PASSAGE WILL RESULT IN STORY BREAKAGE\\nABORTING DELETE\");\n        } else {\n            \n            if(passage.tags.includes('start')){\n                alert(\"Deleting this passage will randomly assign a new start passage, select a start passage from the passages menu\");\n                this.baseStory.passages[index + 1].tags.push(\"start\");\n            }\n            \n            this.baseStory.passages = this.baseStory.passages.filter(function(passage){\n                return passage.name != event.name;\n            });\n\n            this.exportedStoryPages = this.exportedStoryPages.filter(function(page){\n                return page.pageName != event.name;\n            });\n\n            this.replaceLinks({prevName: event.name, newName: \"\"});\n            this.reparseLinks();\n        }\n\n    }\n\n    /** \n     * Change the generated value of a text variable\n     * \n     * @function setTextVariable\n     * @param {String} variableName - Variable Name to change\n     * @param {String} newText - Text to change the variable to\n     * @returns {void}\n     */\n    setTextVariable(variableName, newText) {\n        var data = this.variables.get(variableName);\n        \n        console.log(JSON.stringify(data));\n\n        data.value = newText;\n\n        this.variables.set(variableName, data);\n    }\n\n\n    /** \n     * Change the generated value of a text variable\n     * \n     * @function setTextVariable\n     * @param {String} variableName \n     * @param {Event} data {}\n     * @returns {void}\n     */\n    setImageVariable(variableName, data){\n        this.imageVariables.set(variableName, data);\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /** \n     * Change the generated value of a text variable\n     * \n     * @function setTextVariable\n     * @param {String} variableName \n     * @param {Event} data {}\n     * @returns {void}\n     */\n    setAudioVariable(variableName, data){\n        this.audioVariables.set(variableName, data);\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /**\n     * \n     * @function changeVariableName\n     * @param {Event} event \n     */\n    changeTextVariableName(event){\n        var process = this.checkEvent({name: event.newName}, \"text\");\n\n        if(process){\n            this.replaceVariables(event);\n\n            var data = this.variables.get(event.prevName);\n            this.variables.delete(event.prevName);\n            this.variables.set(event.newName, data);\n        }\n\n        return process;\n\n    }\n\n    /**\n     * \n     * @function changeVariableName\n     * @param {Event} event \n     */\n    changeImageVariableName(event){\n        var process = this.checkEvent({name: event.newName}, \"media\");\n\n        console.log()\n\n        if(process){\n            this.replaceVariables(event);\n\n            var data = this.imageVariables.get(event.prevName);\n            this.imageVariables.delete(event.prevName);\n            this.imageVariables.set(event.newName, data);\n\n            this.reparseMedia();\n        }\n\n        return process;\n            //this.printVariableData();\n    }\n\n    /**\n     * \n     * @function changeVariableName\n     * @param {Event} event \n     */\n    changeAudioVariableName(event){\n\n        var process = this.checkEvent({name: event.newName}, \"media\");\n\n        if(process){\n            this.replaceVariables(event);\n\n            var data = this.audioVariables.get(event.prevName);\n            this.audioVariables.delete(event.prevName);\n            this.audioVariables.set(event.newName, data);\n\n            this.reparseMedia();\n        }\n\n        return process;\n        //this.printVariableData();\n    }\n    \n    /**\n     * Adds a variable to the story\n     * \n     * @function addVariable\n     * @param {Event} event \n     */\n    addTextVariable(event){\n        \n        var process = this.checkEvent(event, \"text\");\n\n        if(process){\n            this.variables.set(event.name, {value: event.value, color: \"\", id: NUM_VARS++});\n\n            this.detVariableColors();\n        }\n\n        return process;\n    }\n\n    /**\n     * Adds an image variable\n     * @function addImageVariable\n     * @param {Event} event {name: varName, file: null, fileName: \"\", path: \"\", id: \"\"}\n     */\n    addImageVariable(event){\n\n        var process = this.checkEvent(event, \"media\");\n        if(process){\n            this.imageVariables.set(event.name, {file: event.file, fileName: event.fileName, path: event.path, color: \"\", id: NUM_IMG_VARS++, uploaded: event.uploaded});\n            //this.printVariableData();\n\n            this.detVariableColors();\n        }\n\n        return process;\n    }\n\n    /**\n     * Adds an image variable\n     * @function addImageVariable\n     * @param {Event} event {name: varName, file: null, fileName: \"\", path: \"\", id: \"\"}\n     */\n    addAudioVariable(event){\n        var process = this.checkEvent(event, \"media\");\n        if(process){\n            this.audioVariables.set(event.name, {file: event.file, fileName: event.fileName, path: event.path, color: \"\", id: NUM_AUD_VARS++, uploaded: event.uploaded});\n            //this.printVariableData();\n\n            this.detVariableColors();\n        }\n\n        return process;\n    }\n\n    checkEvent(event, type){\n\n        var process = false;\n\n        if(type == \"text\"){\n            process = !(this.variables.has(event.name));\n        } else if(type == \"media\"){\n            process = !((this.imageVariables.has(event.name)) || (this.audioVariables.has(event.name)));\n        }\n\n        if(!process){\n            alert(event.name + \" already exists!\");\n        }\n\n        return process;\n    }\n\n    /**\n     * Removes a variable from the story\n     * \n     * @function deleteVariable\n     * @param {Event} event \n     */\n    deleteTextVariable(event){\n\n        var dataArr = [];\n\n        this.variables.forEach(\n            function(value, key){\n                dataArr.push({name: key});\n            }\n        );\n\n        for(var j = 0; j < this.exportedStoryPages.length; j++){\n            this.exportedStoryPages[j].removeKeyFromText(dataArr, event.name);\n        }\n        \n        this.variables.delete(event.name);\n\n        var sortedKeys = [];\n\n\t\tthis.variables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            if(a > b){\n                return 1;\n            } else if(a < b){\n                return -1;\n            } else {\n                return 0;\n            }\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.variables.get(sortedKeys[i]);\n            data.id--;\n            this.variables.set(sortedKeys[i], data);\n        }\n        \n\n        NUM_VARS--;\n\n    }\n\n    deleteImageVariable(event){\n\n        var dataArr = [];\n\n        this.imageVariables.forEach(\n            function(value, key){\n                dataArr.push({name: key});\n            }\n        );\n\n        this.audioVariables.forEach(\n            function(value, key){\n                dataArr.push({name: key});\n            }\n        );\n\n        for(var j = 0; j < this.exportedStoryPages.length; j++){\n            this.exportedStoryPages[j].removeKeyFromText(dataArr, event.name);\n        }\n        \n        this.imageVariables.delete(event.name);\n\n        var sortedKeys = [];\n\n\t\tthis.imageVariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            if(a > b){\n                return 1;\n            } else if(a < b){\n                return -1;\n            } else {\n                return 0;\n            }\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.imageVariables.get(sortedKeys[i]);\n            data.id--;\n            this.imageVariables.set(sortedKeys[i], data);\n        }\n\n        NUM_IMG_VARS--;\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    deleteAudioVariable(event){\n\n        var dataArr = [];\n\n        this.imageVariables.forEach(\n            function(value, key){\n                dataArr.push({name: key});\n            }\n        );\n\n        this.audioVariables.forEach(\n            function(value, key){\n                dataArr.push({name: key});\n            }\n        );\n\n        for(var j = 0; j < this.exportedStoryPages.length; j++){\n            this.exportedStoryPages[j].removeKeyFromText(dataArr, event.name);\n        }\n\n        this.audioVariables.delete(event.name);\n\n        var sortedKeys = [];\n\n\t\tthis.audioVariables.forEach(\n\t\t\tfunction(value, key){\n\t\t\t\tsortedKeys.push(key);\n\t\t\t}\n\t\t);\n\n\t\tsortedKeys = sortedKeys.sort(function(a, b){\n            if(a > b){\n                return 1;\n            } else if(a < b){\n                return -1;\n            } else {\n                return 0;\n            }\n            \n        });\n        \n\n        for(var i = 0; i < sortedKeys.length; i++){\n            var data = this.audioVariables.get(sortedKeys[i]);\n            data.id--;\n            this.audioVariables.set(sortedKeys[i], data);\n        }\n\n        NUM_AUD_VARS--;\n\n\n        this.reparseMedia();\n        //this.printVariableData();\n    }\n\n    /**\n     * Get the new text for a passage and replace it in the story\n     * \n     * @function setPassage\n     * @param {String} passageName - Name of the passage\n     * @param {String} newText - New text for the passage\n     * @param {String} hidden - Value to regenerate story text\n     * @returns {void}\n     */\n    setPassage(passageName, newText){\n        for(var i = 0; i < this.baseStory.passages.length; i++){\n            if(this.baseStory.passages[i].name == passageName){\n                this.baseStory.passages[i].text = newText;\n\n                console.log(\"Text Changed\");\n\n            }\n            \n        }\n\n        this.reparseLinks();\n        this.reparseMedia();\n    }\n\n    /**\n     * Changes the name of the story\n     * \n     * @function changeStoryName\n     * @param {Event} event \n     */\n    changeStoryName(event){\n        this.baseStory.name = event.name;\n    }\n\n\n    /** \n     * Generate the story with the revised variables.\n     * \n     * @function generateViewStory\n     * @returns {void}\n     */\n    generateViewStory(media) {\n        //Extract the passage with variable tag,\n        //IMPORTANT: VAR_TAG SHOULD NOT BE USED DURING STORY CREATION\n        //           THIS PASSAGE WILL BE AUTOMATICALLY GENERATED AND ADDED \n        //           TO THE FIRST PASSAGE OF THE STORY.\n\n        this.css = \"\";\n\n        console.log(\"Generating Story...\");\n\n        var viewStory = new Story(JSON.parse(JSON.stringify(this.baseStory)));\n\n        console.log(viewStory.name);\n\n        for(var i = 0; i < viewStory.passages.length; i++){\n            \n            var passageObj = JSON.parse(JSON.stringify(this.exportedStoryPages[i].linkPassage));\n\n            viewStory.passages[i] = new Passage(passageObj.name, passageObj.tags, passageObj.metadata, passageObj.text, passageObj.pid);\n\n            viewStory.passages[i].text = viewStory.passages[i].text.trim();\n\n            if(viewStory.passages[i].tags.includes(VAR_TAG)){\n                \n                //console.log(\"Text Changed:\" + this.baseStory.passages[i].text);\n                var textToPush = viewStory.passages[i].text;\n            \n                var sortedKeys = [];\n\n                this.variables.forEach(\n                    function(value, key){\n                        sortedKeys.push(key);\n                    }\n                );\n\n                sortedKeys = sortedKeys.sort(function(a, b){\n                    return a.length - b.length;\n                });            \n\n                for(var j = 0; j < sortedKeys.length; j++){\n                    \n                    //console.log(\"KEY: \" + sortedKeys[j])\n\n                        //console.log(\"KEY: \" + key + \" VALUE: \" + value)\n                    var key = sortedKeys[j];    \n                    var temp = textToPush.split(key);\n                    var data = this.variables.get(key);\n                    \n                    textToPush = temp.join(data.value);\n                   \n                }\n                \n                \n                viewStory.passages[i].text = textToPush +  \"\\n\"  + this.injectVariableText();\n            } \n\n            if(media)\n                viewStory.passages[i].text = this.injectMedia(viewStory.passages[i].text);\n\n            this.css += this.exportedStoryPages[i].injectCSSText() + '\\n';\n        }\n\n        this.css += \"body{ text-align: center;}\"\n\n        return viewStory;\n\n    }\n\n    injectMedia(textToPush){\n\n        var sortedKeys = [];\n\n        this.imageVariables.forEach(\n            function(value, key){\n                sortedKeys.push(key);\n            }\n        );\n\n        this.audioVariables.forEach(\n            function(value, key){\n                sortedKeys.push(key);\n            }\n        )\n\n        sortedKeys = sortedKeys.sort(function(a, b){\n            return b.length - a.length;\n        });            \n\n        for(var j = 0; j < sortedKeys.length; j++){\n            \n            //console.log(\"KEY: \" + sortedKeys[j])\n\n                //console.log(\"KEY: \" + key + \" VALUE: \" + value)\n            var key = sortedKeys[j];    \n            var temp = textToPush.split(key);\n            \n            var data = null;\n\n            if(this.imageVariables.has(key)){\n                data = this.imageVariables.get(key);\n                \n                textToPush = temp.join(\"<img style = 'max-width: 50%; max-height:50%;' src = '\" + data.path.i + \"' alt = \" + key.replace(\"@\", \"\") + \"/>\");\n\n            } else if(this.audioVariables.has(key)){\n                data = this.audioVariables.get(key);\n\n                textToPush = temp.join(\"<audio controls><source src = '\" + data.path.i + \"'> Your Browser Does not support the audio element </audio>\");\n            }\n\n            //textToPush = temp.join(\"<img style = 'max-width: 50%; max-height:50%;' src = '\" + data.path.i + \"' alt = \" + key + \"/>\");\n            \n            /*if(data.uploaded) {\n                \n            }\n            if(!data.uploaded) {\n                textToPush = temp.join(\"<img style = 'max-width: 50%; max-height:50%;' src = '\" + data.path + \"' alt = \" + key + \"/>\");\n            }*/\n        }\n\n        return textToPush;\n    }\n\n\n    /**\n     * Generates variable insertion text\n     *  \n     * @function injectVariableText\n     */\n    injectVariableText(){\n        var inject = \"\";\n\n        this.variables.forEach(function(data, key){\n            inject += \"(set: \";\n            inject += key;\n            inject += \" to &quot;\";\n            inject += data.value;\n            inject += \"&quot;)\\n\"\n        });\n        \n        inject += \"(hidden:)[image:\"\n\n        this.imageVariables.forEach(function(data, key){\n            //console.log(key + \": \" + JSON.stringify(data));\n\n            inject += key + \"{\" + data.path.i + \" \" + data.fileName + \"},\"\n        });\n\n        inject += \"]\\n\"\n\n        inject += \"(hidden:)[audio:\"\n\n        this.audioVariables.forEach(function(data, key){\n\n            inject += key + \"{\" + data.path.i + \" \" + data.fileName + \"},\"\n\n        });\n\n        inject += \"]\\n\"\n\n        return inject;\n        \n    }\n\n\n    /**\n     * Get cloud save story\n     * \n     * @function generateSaveStory\n     * @returns {Story} story to be pushed to cloud;\n     */\n    generateSaveStory(){\n\n        this.css = \"\";\n\n        var cloudStory = new Story(JSON.parse(JSON.stringify(this.baseStory)));\n\n        for(var i = 0; i < cloudStory.passages.length; i++){\n\n            var passageObj = JSON.parse(JSON.stringify(this.exportedStoryPages[i].linkPassage));\n\n            cloudStory.passages[i] = new Passage(passageObj.name, passageObj.tags, passageObj.metadata, passageObj.text, passageObj.pid);\n\n            cloudStory.passages[i].text = cloudStory.passages[i].text.trim();\n\n            if(cloudStory.passages[i].tags.includes(VAR_TAG)){\n                \n                //console.log(\"Text Changed:\" + this.baseStory.passages[i].text);    \n                cloudStory.passages[i].text = cloudStory.passages[i].text +  \"\\n\"  + this.injectVariableText();\n            } \n            \n            this.css += this.exportedStoryPages[i].injectCSSText() + '\\n';\n        }\n\n        return cloudStory;\n    }\n\n\n    /** \n     * Generate the story with the revised text.\n     * \n     * @function generateStoryText\n     * @returns {void}\n     */\n    generateStoryText(hidden, inVariables, inMedia) {\n\n        //this.exportedStoryText = [];\n\n        let scriptPassages = this.baseStory.getStoryPassages();\n\n        for (var i = 0; i < scriptPassages.length; i++) {\n\n            var textToPush = scriptPassages[i].text;\n\n            textToPush = this.processTextVariables(textToPush, hidden, inVariables);\n            textToPush = this.processMediaVariables(textToPush, hidden, inMedia);\n            \n            while(textToPush.includes(\"]]\") || textToPush.includes(\"[[\")){ \n                textToPush = textToPush.replace('[[', \"<u>\");\n                textToPush = textToPush.replace(']]', \"</u>\");\n            }\n            \n\n            while (textToPush.includes(\"&quot;\") || textToPush.includes(\"&#39;\") || textToPush.includes(\"&gt;\") || textToPush.includes(\"&lt;\")) {\n                textToPush = textToPush.replace(\"&quot;\", \"\\\"\");\n                textToPush = textToPush.replace(\"&#39;\", \"'\");\n                textToPush = textToPush.replace(\"&lt;\", \"<\");\n                textToPush = textToPush.replace(\"&gt;\", \">\");\n            }\n            \n            //textToPush = textToPush.replace(/(\\r\\n|\\r|\\n){2,}/g, '\\n');\n\n            var nPassage = new Passage(scriptPassages[i].name, \n                scriptPassages[i].tags, scriptPassages[i].metadata, textToPush, scriptPassages[i].pid);\n\n            this.exportedStoryPages[i].dispPassage = nPassage;\n            this.exportedStoryPages[i].pageName = nPassage.name;\n            this.exportedStoryPages[i].story = this.baseStory;\n            this.exportedStoryPages[i].pages = this.baseStory.getStoryPassages().length;\n\n        }\n    }\n\n\n    processTextVariables(textToPush, hidden, inVariables){\n        var sortedKeys = [];\n\n        this.variables.forEach(\n            function(value, key){\n                sortedKeys.push(key);\n            }\n        );\n\n        sortedKeys = sortedKeys.sort(function(a, b){\n            return b.length - a.length;\n        });            \n\n        for(var j = 0; j < sortedKeys.length; j++){\n            \n            //console.log(\"KEY: \" + sortedKeys[j])\n\n                //console.log(\"KEY: \" + key + \" VALUE: \" + value)\n            var key = sortedKeys[j];    \n            var temp = textToPush.split(key);\n            var data = this.variables.get(key);\n\n            if(!hidden){\n                if(inVariables){\n                    textToPush = temp.join(\"<span style = 'color:\" + data.color + \";'><strong>(\" + key.replace(\"$\", \"\") + \")</strong></span>\" + data.value);\n                } else {\n                    textToPush = temp.join(\"<span>(\" + key.replace(\"$\", \"\") + \")</span>\" + data.value);\n                }\n            } else {\n                if(inVariables){\n                    textToPush = temp.join(\"<span style = 'color:\" + data.color + \";'><strong>\" + data.value + \"</strong></span>\");\n                } else{\n                    textToPush = temp.join(\"<span>\" + data.value + \"</span>\");   \n                }\n            }\n            \n        }\n\n        return textToPush;\n    }\n\n\n    processMediaVariables(textToPush, hidden, inMedia){\n        \n        var sortedKeys = [];\n\n        this.imageVariables.forEach(\n            function(value, key){\n                sortedKeys.push(key);\n            }\n        );\n\n        this.audioVariables.forEach(\n            function(value, key){\n                sortedKeys.push(key);\n            }\n        );\n\n        sortedKeys = sortedKeys.sort(function(a, b){\n            return b.length - a.length;\n        });            \n\n        for(var j = 0; j < sortedKeys.length; j++){\n            \n            //console.log(\"KEY: \" + sortedKeys[j])\n\n                //console.log(\"KEY: \" + key + \" VALUE: \" + value)\n            var key = sortedKeys[j];    \n            var temp = textToPush.split(key);\n            var data = this.imageVariables.has(key) ? this.imageVariables.get(key) : this.audioVariables.get(key);\n            \n            var value = \"\";\n\n            if(data.fileName.length > 30){\n                value = data.fileName.substr(0, 30) + \"...\";\n            } else {\n                value = data.fileName;\n            }\n\n            if(value == \"\"){\n                value = \"No File Uploaded\";\n            }\n\n            if(!hidden){\n                if(inMedia){\n                    textToPush = temp.join(\"<span style = 'color:\" + data.color + \";'><strong>(\" + key.replace(\"@\", \"\") + \")</strong></span>\" + value);\n                } else {\n                    textToPush = temp.join(\"<span>(\" + key.replace(\"@\", \"\") + \")</span>\" + value);\n                }\n            } else {\n                if(inMedia){\n                    textToPush = temp.join(\"<span style = 'color:\" + data.color + \";'><strong>(\" + value + \")</strong></span>\");\n                } else {\n                    textToPush = temp.join(\"<span>(\" + value + \")</span>\");\n                }\n            }\n            \n        }\n\n        return textToPush;\n    }\n\n    generatePublishStory(){\n        this.css = \"\";\n\n        var cloudStory = new Story(JSON.parse(JSON.stringify(this.baseStory)));\n\n        for(var i = 0; i < cloudStory.passages.length; i++){\n\n            var passageObj = JSON.parse(JSON.stringify(this.exportedStoryPages[i].linkPassage));\n\n            cloudStory.passages[i] = new Passage(passageObj.name, passageObj.tags, passageObj.metadata, passageObj.text, passageObj.pid);\n\n            cloudStory.passages[i].text = cloudStory.passages[i].text.trim();\n\n            if(cloudStory.passages[i].tags.includes(VAR_TAG)){\n                \n                //console.log(\"Text Changed:\" + this.baseStory.passages[i].text);    \n                cloudStory.passages[i].text = cloudStory.passages[i].text +  \"\\n\"  + this.injectPublishVariableText();\n            } \n            \n            this.css += this.exportedStoryPages[i].injectCSSText() + '\\n';\n        }\n\n        this.css += \"body{ text-align: center;}\"\n\n        return cloudStory;\n    }\n\n      /**\n     * Generates variable insertion text\n     *  \n     * @function injectVariableText\n     */\n    injectPublishVariableText(){\n        var inject = \"\";\n\n        this.variables.forEach(function(data, key){\n            inject += \"(set: \";\n            inject += key;\n            inject += \" to &quot;\";\n            inject += \"(\" + key.replace(\"$\", \"\") + \")\";\n            inject += \"&quot;)\\n\"\n        });\n        \n        inject += \"(hidden:)[image:\"\n\n        this.imageVariables.forEach(function(data, key){\n            //console.log(key + \": \" + JSON.stringify(data));\n\n            inject += key + \"{ },\"\n        });\n\n        inject += \"]\\n\"\n\n        inject += \"(hidden:)[audio:\"\n\n        this.audioVariables.forEach(function(data, key){\n\n            inject += key + \"{ },\"\n\n        });\n\n        inject += \"]\\n\"\n\n        return inject;\n        \n    }\n\n\n    destroy(){\n        /*this.imageVariables.forEach(function(data){\n            if(data.path.includes(\"blob\")){\n                URL.revokeObjectURL(data.path);\n                data.path = \"\";\n            }\n            \n        });\n\n        this.audioVariables.forEach(function(data){\n            if(data.path.includes(\"blob\")){\n                URL.revokeObjectURL(data.path);\n                data.path = \"\";\n            }\n            \n        });*/\n    }\n}\n\nmodule.exports = StoryEditor;\n","/**\n * @external HTML\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/HTML|HTML}\n */\n\nconst { parse } = require('node-html-parser');\nconst HtmlParser = parse;\nconst Story = require('./Story.js');\nconst Passage = require('./Passage.js');\n/**\n * @class HTMLParser\n * @module HTMLParser\n */\nclass HTMLParser {\n  /**\n   * @function HTMLParser\n   * @class\n   * @param {HTML} content - HTML to parse\n   */\n  constructor (content) {\n    this.story = null;\n    this.parse(content);\n  }\n\n  /**\n   * Parse HTML text into a JS DOM-like object\n   *\n   * @param {string} content - Content to parse\n   * @returns {void}\n   */\n  parse (content) {\n    // Send to node-html-parser\n    // Enable getting the content of 'script', 'style', and 'pre' elements\n    // Get back a DOM\n    const dom = new HtmlParser(\n      content,\n      {\n        lowerCaseTagName: false,\n        script: true,\n        style: true,\n        pre: true\n      });\n\n    // Pull out the tw-storydata element\n    const storyData = dom.querySelector('tw-storydata');\n\n    if (storyData != null) {\n      this.story = new Story();\n      this.story.name = storyData.attributes.name;\n      this.story.creator = storyData.attributes.creator;\n      this.story.creatorVersion = storyData.attributes['creator-version'];\n\n      this.story.metadata = {};\n      this.story.metadata.ifid = storyData.attributes.ifid;\n      this.story.metadata.format = storyData.attributes.format;\n      this.story.metadata.formatVersion = storyData.attributes['format-version'];\n      this.story.metadata.zoom = storyData.attributes.zoom;\n      this.story.metadata.start = storyData.attributes.startnode;\n    } else {\n      throw new Error('Error: Not a Twine 2-style file!');\n    }\n\n    // Pull out the tw-passagedata elements\n    const storyPassages = dom.querySelectorAll('tw-passagedata');\n\n    // Create an empty array\n    this.story.passages = [];\n\n    // Set default pid\n    let pid = 1;\n\n    // Add StoryTitle\n    this.story.passages.push(\n      new Passage(\n        'StoryTitle',\n        [],\n        {},\n        this.story.name,\n        pid\n      )\n    );\n\n    // Increase PID by one before parsing any other passages\n    pid++;\n\n    // Move through the passages\n    for (const passage in storyPassages) {\n      // Get the passage attributes\n      const attr = storyPassages[passage].attributes;\n      // Get the passage text\n      const text = storyPassages[passage].rawText;\n\n      // Save position\n      const position = attr.position;\n\n      // Save size\n      const size = attr.size;\n\n      // Escape the name\n      const name = this._escapeMetacharacters(attr.name);\n\n      // Create empty tags\n      let tags = '';\n\n      // Escape any tags\n      // (Attributes can, themselves, be emtpy strings.)\n      if (attr.tags.length > 0 && attr.tags !== '\"\"') {\n        tags = this._escapeMetacharacters(attr.tags);\n      }\n\n      // Split by spaces\n      tags = tags.split(' ');\n\n      // Remove any empty strings\n      tags = tags.filter(tag => tag !== '');\n\n      // Add a new Passage into an array\n      this.story.passages.push(\n        new Passage(\n          name,\n          tags,\n          {\n            position: position,\n            size: size\n\n          },\n          text,\n          pid\n        )\n      );\n\n      pid++;\n    }\n\n    // Look for the style element\n    const styleElement = dom.querySelector('#twine-user-stylesheet');\n\n    // Check if there is any content.\n    // If not, we won't add empty passages\n    if (styleElement.rawText.length > 0) {\n      // Add UserStylesheet\n      this.story.passages.push(\n        new Passage(\n          'UserStylesheet',\n          ['stylesheet'],\n          {},\n          styleElement.rawText\n        )\n      );\n    }\n\n    // Look for the script element\n    const scriptElement = dom.querySelector('#twine-user-script');\n\n    // Check if there is any content.\n    // If not, we won't add empty passages\n    if (scriptElement.rawText.length > 0) {\n      // Add UserScript\n      this.story.passages.push(\n        new Passage(\n          'UserScript',\n          ['script'],\n          {},\n          scriptElement.rawText\n        )\n      );\n    }\n\n    // Now that all passages have been handled,\n    //  change the start name\n    this.story.metadata.start = this.story.getStartingPassage();\n\n    // Add StoryData\n    this.story.passages.push(\n      new Passage(\n        'StoryData',\n        [],\n        {},\n        JSON.stringify(this.story.metadata, null, 4)\n      )\n    );\n  }\n\n  /**\n   * Try to escape meta-characters\n   *\n   * @param {string} result - Text to parse\n   * @returns {string} Escaped characters\n   */\n  _escapeMetacharacters (result) {\n    // Replace any single backslash with two of them\n    result = result.replace(/\\\\/g, '\\\\');\n    // Double-escape escaped {\n    result = result.replace(/\\\\\\{/g, '\\\\\\\\{');\n    // Double-escape escaped }\n    result = result.replace(/\\\\\\}/g, '\\\\\\\\}');\n    // Double-escape escaped [\n    result = result.replace(/\\\\\\[/g, '\\\\\\\\[');\n    // Double-escape escaped ]\n    result = result.replace(/\\\\\\]/g, '\\\\\\\\]');\n\n    return result;\n  }\n}\n\nmodule.exports = HTMLParser;\n","const pkg = require('../../json/extwee/package.json');\n/**\n * @class Story\n * @module Story\n */\nclass Story {\n\t/**\n\t * @function Story\n\t * @class\n\t */\n\tconstructor(obj) {\n\t\tif(obj == null){\n\t\t\tthis.name = 'Unknown';\n\t\t\tthis.metadata = {\n\t\t\t\tifid: '',\n\t\t\t\tformat: '',\n\t\t\t\tformatVersion: '',\n\t\t\t\tzoom: '',\n\t\t\t\tstart: '',\n\t\t\t};\n\n\t\t\tthis.passages = [];\n\t\t\t// Store the creator and version\n\t\t\tthis.creator = pkg.name;\n\t\t\tthis.creatorVersion = pkg.version;\n\t\t} else {\n\t\t\tObject.assign(this, obj);\n\t\t}\n\t}\n\n\t/**\n\t * Search for passages with the 'stylesheet' tag\n\t *\n\t * @function getStylePassages\n\t * @returns {Array} - Empty or array of passages\n\t */\n\tgetStylePassages() {\n\t\tlet stylePassages = [];\n\n\t\tif (this.passages.length > 0) {\n\t\t\tstylePassages = this.passages.filter(function (passage) {\n\t\t\t\tconst results = passage.tags.filter(tag => tag === 'stylesheet');\n\n\t\t\t\treturn (results.length > 0);\n\t\t\t});\n\t\t}\n\n\t\treturn stylePassages;\n\t}\n\n\t/**\n\t * Search for passages with the 'script' tag\n\t *\n\t * @function getScriptPassages\n\t * @returns {Array}  - Empty or array of passages\n\t */\n\tgetScriptPassages() {\n\t\tlet scriptPassages = [];\n\n\t\tif (this.passages.length > 0) {\n\t\t\tscriptPassages = this.passages.filter(function (passage) {\n\t\t\t\tconst results = passage.tags.filter(tag => tag === 'script');\n\n\t\t\t\treturn (results.length > 0);\n\t\t\t});\n\t\t}\n\n\t\treturn scriptPassages;\n\t}\n\n\t/**\n\t * Search for passages with the 'stylesheet' tag\n\t *\n\t * @function getStoryPassages\n\t * @returns {Array} - Empty or array of passages\n\t */\n\tgetStoryPassages() {\n\t\tlet storyPassages = [];\n\n\t\tif (this.passages.length > 0) {\n\t\t\tstoryPassages = this.passages.filter(function (passage) {\n\t\t\t\tconst results = passage.tags.filter(tag => tag === 'story');\n\n\t\t\t\treturn (results.length > 0);\n\t\t\t});\n\t\t}\n\n\t\treturn storyPassages;\n\t}\n\n\n\t\n\n\t/**\n\t * Delete specific passages by their tag\n\t *\n\t * @function deleteAllByTag\n\t * @param {string} searchTag - Tag to search for\n\t * @returns {void}\n\t */\n\tdeleteAllByTag(searchTag) {\n\t\tif (this.passages.length > 0) {\n\t\t\tthis.passages = this.passages.filter(function (passage) {\n\t\t\t\treturn !passage.tags.includes(searchTag);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Find the starting passages\n\t *\n\t * @function getStartingPassage\n\t * @returns {string|null} Return passage name or null\n\t */\n\tgetStartingPassage() {\n\t\tlet pid = null;\n\t\tlet searchName = null;\n\n\t\tif (Object.prototype.hasOwnProperty.call(this.metadata, 'start')) {\n\t\t\t// Check if the property is an empty string\n\t\t\t// If so, ignore it.\n\t\t\tif (this.metadata.start !== '') {\n\t\t\t\tsearchName = this.metadata.start;\n\t\t\t}\n\t\t}\n\n\t\tif (this.passages.length > 0) {\n\t\t\tfor (const passage in this.passages) {\n\t\t\t\tif (this.passages[passage].name === searchName) {\n\t\t\t\t\tpid = this.passages[passage].pid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (this.passages[passage].name === 'Start') {\n\t\t\t\t\tpid = this.passages[passage].pid;\n\t\t\t\t}\n\n\t\t\t\tif(this.passages[passage].tags.includes(\"start\")){\n\t\t\t\t\tpid = this.passages[passage].pid;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (pid === null) {\n\t\t\tthrow new Error('Starting passage not found!');\n\t\t} else {\n\t\t\treturn pid;\n\t\t}\n\t}\n}\n\nmodule.exports = Story;\n","const Passage = require('./Passage.js');\nconst Story = require('./Story.js');\n/**\n * @class TweeParser\n * @module TweeParser\n */\nclass TweeParser {\n  /**\n   * @function TweeParser\n   * @class\n   * @param {string} content - Twee content to parse\n   */\n  constructor (content = '') {\n    this.story = new Story();\n    this._passageMetadataError = false;\n    this._storydataError = false;\n\n    this.parse(content);\n  }\n\n  /**\n   * Parse Twee\n   *\n   * @function parse\n   * @param {string} fileContents - File contents to parse\n   */\n  parse (fileContents) {\n    // Throw error if fileContents is empty\n    if (fileContents.length === 0) {\n      throw new Error('No file contents!');\n    }\n\n    let passages = [];\n    let adjusted = '';\n\n    // Check if there are extra content in the files\n    // If so, cut it all out for the parser\n    if (fileContents[0] !== ':' && fileContents[1] !== ':') {\n      adjusted = fileContents.slice(fileContents.indexOf('::'), fileContents.length);\n    } else {\n      adjusted = fileContents;\n    }\n\n    // Split the file based on the passage sigil (::) proceeded by a newline\n    const parsingPassages = adjusted.split('\\n::');\n\n    // Fix the first result\n    parsingPassages[0] = parsingPassages[0].slice(2, parsingPassages[0].length);\n\n    // Set the initial pid\n    let pid = 0;\n\n    // Iterate through the passages\n    parsingPassages.forEach((passage) => {\n      // Set default values\n      let tags = '';\n      let metadata = '';\n      let text = '';\n      let name = '';\n\n      // Header is everything to the first newline\n      let header = passage.slice(0, passage.indexOf('\\n'));\n      // Text is everything else\n      // (Also eat the leading newline character.)\n      // (And trim any remaining whitespace.)\n      text = passage.substring(header.length + 1, passage.length).trim();\n\n      // Test for metadata\n      const openingCurlyBracketPosition = header.lastIndexOf('{');\n      const closingCurlyBracketPosition = header.lastIndexOf('}');\n\n      if (openingCurlyBracketPosition !== -1 && closingCurlyBracketPosition !== -1) {\n        // Save the text metadata\n        metadata = header.slice(openingCurlyBracketPosition, closingCurlyBracketPosition + 1);\n\n        // Remove the metadata from the header\n        header = header.substring(0, openingCurlyBracketPosition) + header.substring(closingCurlyBracketPosition + 1);\n      }\n\n      // There was passage metadata\n      if (metadata.length > 0) {\n        // Try to parse the metadata\n        try {\n          metadata = JSON.parse(metadata);\n        } catch (event) {\n          this._passageMetadataError = true;\n        }\n      }\n\n      // Test for tags\n      const openingSquareBracketPosition = header.lastIndexOf('[');\n      const closingSquareBracketPosition = header.lastIndexOf(']');\n\n      if (openingSquareBracketPosition !== -1 && closingSquareBracketPosition !== -1) {\n        tags = header.slice(openingSquareBracketPosition, closingSquareBracketPosition + 1);\n\n        // Remove the tags from the header\n        header = header.substring(0, openingSquareBracketPosition) + header.substring(closingSquareBracketPosition + 1);\n      }\n\n      // Parse tags\n      if (tags.length > 0) {\n        // Eat the opening and closing square brackets\n        tags = tags.substring(1, tags.length - 1);\n\n        // Set empty default\n        let tagsArray = [];\n\n        // Test if tags is not single, empty string\n        if (!(tags === '')) {\n          tagsArray = tags.split(' ');\n        }\n\n        // There are multiple tags\n        if (tagsArray.length > 1) {\n        // Create future array\n          const futureTagArray = [];\n\n          // Move through entries\n          // Add a trimmed version into future array\n          tagsArray.forEach((tag) => { futureTagArray.push(tag.trim()); });\n\n          // Set the tags back to the future array\n          tags = futureTagArray;\n        } else if (tagsArray.length === 1) {\n        // There was only one tag\n        // Store it\n          const temp = tags;\n\n          // Switch tags over to an array\n          tags = [];\n          // Push the single entry\n          tags.push(temp);\n        } else {\n        // Make sure tags is set to empty array if no tags were found\n          tags = [];\n        }\n      } else {\n        // There were no tags, so set it to an empty array;\n        tags = [];\n      }\n\n      // Filter out any empty string tags\n      tags = tags.filter(tag => tag !== '');\n\n      // Trim any remaining whitespace\n      header = header.trim();\n\n      // Check if there is a name left\n      if (header.length > 0) {\n        name = header;\n      } else {\n        // No name left. Something went wrong. Blame user.\n        throw new Error('Malformed passage header!');\n      }\n\n      if (this._passageMetadataError) {\n        console.warn('Error parsing metadata for \"' + name + '\". It was ignored.');\n      }\n\n      // Add the new Passage to the internal array\n      passages.push(new Passage(name, tags, metadata, text, pid));\n\n      // Increase pid\n      pid++;\n    });\n\n    // All formats share StoryTitle\n    // Find it and set it\n    let pos = passages.find((el) => { return el.name === 'StoryTitle'; });\n\n    if (pos !== undefined) {\n      this.story.name = pos.text;\n      // Remove the StoryTitle passage\n      passages = passages.filter(p => p.name !== 'StoryTitle');\n    } else {\n    // There was no StoryTitle passage\n    // Set a value of \"Unknown\"\n      this.story.name = 'Unknown';\n    }\n\n    // Look for StoryData\n    pos = passages.find((el) => { return el.name === 'StoryData'; });\n\n    if (pos !== undefined) {\n    // Try to parse the StoryData\n      try {\n        this.story.metadata = JSON.parse(pos.text);\n      } catch (event) {\n        // Silently fail with default values\n        this._storydataError = true;\n      }\n\n      // Remove the StoryData passage\n      passages = passages.filter(p => p.name !== 'StoryData');\n    }\n\n    if (this._storydataError) {\n      console.warn('Error with processing StoryData JSON data. It was ignored.');\n    }\n\n    // Set the passages to the internal story\n    this.story.passages = passages;\n  }\n}\n\nmodule.exports = TweeParser;\n"],"sourceRoot":""}