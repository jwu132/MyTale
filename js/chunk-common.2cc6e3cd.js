(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-common"],{"13fd":function(e){e.exports=JSON.parse('{"_from":"extwee@^1.6.2","_id":"extwee@1.6.2","_inBundle":false,"_integrity":"sha512-vIGP3s6va/iJT0qXt0VmQpnXMSjaS2N2bLe4ziC2Ts9lRsP4C7Chvq4LMETS9Ku8ztnF5Pi0fUtTP/Da079ilw==","_location":"/extwee","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"extwee@^1.6.2","name":"extwee","escapedName":"extwee","rawSpec":"^1.6.2","saveSpec":null,"fetchSpec":"^1.6.2"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/extwee/-/extwee-1.6.2.tgz","_shasum":"d66100dac1969f76b44803098d80389e01926268","_spec":"extwee@^1.6.2","_where":"D:\\\\projects\\\\Programming\\\\HTML\\\\story_personalization_system","author":{"name":"Dan Cox"},"bugs":{"url":"https://github.com/videlais/extwee/issues"},"bundleDependencies":false,"dependencies":{"clean-css":"^4.2.3","node-html-parser":"^1.2.3","shelljs":"^0.8.3","yargs":"^15.0.2"},"deprecated":false,"description":"A Twee 3 compiler written in JS.","devDependencies":{"eslint":"^6.8.0","eslint-config-standard":"^14.1.0","eslint-plugin-import":"^2.20.1","eslint-plugin-jsdoc":"^21.0.0","eslint-plugin-node":"^11.0.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","mocha":"^7.0.1","nyc":"^15.0.0"},"homepage":"https://github.com/videlais/extwee#readme","keywords":["twine","twee","parser","compiler"],"license":"MIT","main":"index.js","name":"extwee","repository":{"type":"git","url":"git+https://github.com/videlais/extwee.git"},"scripts":{"lint":"eslint src/**/*.js --fix","report-coverage":"nyc report --reporter=text-lcov > coverage.lcov","start":"node main.js","test":"nyc mocha test/test.js"},"version":"1.6.2"}')},1543:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l})),a.d(t,"e",(function(){return c}));var s=a("8aa5"),r=Object(s["initializeApp"])({apiKey:"AIzaSyAu5EUOxMPPdrRrZo-hfQs19RDNaJ4mgR4",authDomain:"mytale-comments.firebaseapp.com",databaseURL:"https://mytale-comments.firebaseio.com",projectId:"mytale-comments",storageBucket:"mytale-comments.appspot.com",messagingSenderId:"320636559583",appId:"1:320636559583:web:a6c77ce3ebb26dfa48c96a",measurementId:"G-12RZEF9E3K"}),i=r.database(),n=r.firestore(),o=i.ref("comments"),l=i.ref("accounts"),c=i.ref("tags")},"1bbf":function(e,t,a){a("c975"),a("baa5"),a("fb6a");var s=a("970b"),r=a("5bc3"),i=a("5d3e"),n=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ";s(this,e),this.storyformat=null,this.parse(t)}return r(e,[{key:"parse",value:function(e){var t=e.indexOf("harlowe");if(-1!==t){var a=e.lastIndexOf(',"setup": function');e=e.slice(0,a)+"}"}var s=e.indexOf("{"),r=e.lastIndexOf("}");if(-1===s||-1===r)throw new Error("Unable to find Twine2 JSON chunk!");e=e.slice(s,r+1);var n="";try{n=JSON.parse(e)}catch(o){throw new Error("Unable to parse Twine2 JSON chunk!")}this.storyformat=new i(n)}}]),e}();e.exports=n},"23e8":function(e,t,a){"use strict";a("b0c0");t["a"]={methods:{storageAvailable:function(e){var t;try{t=window[e];var a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(s){return s instanceof DOMException&&(22===s.code||1014===s.code||"QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&t&&0!==t.length}}}}},"2a30":function(e,t,a){a("b0c0"),a("ac1f"),a("5319");var s=a("6374"),r=a("970b"),i=a("5bc3"),n=a("e349"),o=a("5d3e"),l=function(){"use strict";function e(t,a,s,i){if(r(this,e),!(t instanceof n))throw new Error("Error: story must be a Story object!");if(!(a instanceof o))throw new Error("storyFormat must be a StoryFormat object!");this.output="";var l=s||null,c=i||null;this.writeFile(t,a,l,c)}return i(e,[{key:"writeFile",value:function(e,t,a,r){var i="";this.output="";var n='<tw-storydata name="'+e.name+'" startnode="'+e.getStartingPassage()+'" creator="'+e.creator+'" creator-version="'+e.creatorVersion+'" ifid="'+e.metadata.ifid+'" zoom="'+e.metadata.zoom+'" format="'+t.name+'" format-version="'+t.version+'" options hidden>\n';n+='<style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">';var o=e.getStylePassages();null!=a&&(n+=a);var l,c=s(o);try{for(c.s();!(l=c.n()).done;){var u=l.value;n+=u.text}}catch(w){c.e(w)}finally{c.f()}n+="</style>\n",n+='<script role="script" id="twine-user-script" type="text/twine-javascript">';var h=e.getScriptPassages();null!=r&&(n+=r);var d,g=s(h);try{for(g.s();!(d=g.n()).done;){var m=d.value;n+=m.text}}catch(w){g.e(w)}finally{g.f()}n+="<\/script>\n";var f,p=s(e.getStoryPassages());try{for(p.s();!(f=p.n()).done;){var v=f.value;if(n+='<tw-passagedata pid="'+v.pid+'" name="'+v.name+'"',v.tags.length>1){n+=' tags="';var y,b=s(v.tags);try{for(b.s();!(y=b.n()).done;){var S=y.value;n+=S+" "}}catch(w){b.e(w)}finally{b.f()}n+='" '}else 1===v.tags.length?n+=' tags="'+v.tags[0]+'" ':n+=" tags ";Object.prototype.hasOwnProperty.call(v.metadata,"position")?n+='position="'+v.metadata.position+'" ':n+='position="100,100" ',Object.prototype.hasOwnProperty.call(v.metadata,"size")?n+='size="'+v.metadata.size+'" ':n+='size="100,100" ',n+=">"+v.text+"</tw-passagedata>\n"}}catch(w){p.e(w)}finally{p.f()}n+="</tw-storydata>";var x=t.source.replace("{{STORY_NAME}}",e.name);x=x.replace("{{STORY_DATA}}",n),i+=x,this.output=i}}]),e}();e.exports=l},3:function(e,t){},"35e0":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-app-bar",{attrs:{app:"",color:"white"}},[a("v-toolbar-title",[e._v("Make Your Own "),a("span",{staticClass:"font-weight-black"},[e._v("SOCIAL STORIES")])]),a("v-spacer"),a("v-btn",{attrs:{text:"",href:"index.html"}},[e._v("Home")]),e.isVerified?a("v-btn",{attrs:{text:"",href:"dashboard.html"}},[e._v("Profile")]):e._e(),e.isVerified?e._e():a("v-btn",{attrs:{text:"",href:"account.html"}},[e._v("Login")]),a("v-btn",{attrs:{text:"",href:"search_app.html"}},[e._v("Search")]),a("v-btn",{attrs:{text:"",href:"editor.html"}},[e._v("Editor")]),a("v-btn",{attrs:{text:"",href:"about.html"}},[e._v("About")])],1)],1)},r=[],i=a("8aa5"),n=a.n(i),o={name:"NavBar",data:function(){return{isLoggedIn:!1,isVerified:!1,currentUser:"",user:"Login",userLink:"account.html"}},created:function(){this.isLoggedIn=n.a.auth().currentUser,n.a.auth().currentUser&&(this.isVerified=n.a.auth().currentUser.emailVerified)}},l=o,c=a("2877"),u=a("6544"),h=a.n(u),d=a("40dc"),g=a("8336"),m=a("2fa4"),f=a("2a7f"),p=Object(c["a"])(l,s,r,!1,null,"35f7e914",null);t["a"]=p.exports;h()(p,{VAppBar:d["a"],VBtn:g["a"],VSpacer:m["a"],VToolbarTitle:f["a"]})},"402c":function(e,t,a){"use strict";var s=a("2b0e"),r=a("f309");s["a"].use(r["a"]),t["a"]=new r["a"]({})},4360:function(e,t,a){"use strict";var s=a("2b0e"),r=a("2f62");s["a"].use(r["a"]),t["a"]=new r["a"].Store({state:{storyLocation:"/stories/Story Template.twee",storyContent:String,storyToPublish:"",hello:"Hello"},getters:{},mutations:{updateDirectory:function(e,t){e.storyLocation=t.searchLocation},updateContent:function(e,t){e.storyContent=t.content},updateStoryPublish:function(e,t){e.storyToPublish=t},updateHello:function(e,t){e.hello=t}},actions:{}})},"48c3":function(e,t,a){"use strict";a("b0c0");var s=a("1543"),r=a("8b4c");t["a"]={methods:{getName:function(e){var t=[],a="",r=s["a"].orderByKey();return r.once("value").then((function(s){a=s.val()[e].name,t.push(a)})),t},getUserComments:function(e){var t=[],a=s["a"].orderByKey();return a.once("value").then((function(a){var s=a.val()[e].comments;for(var r in s)t.push(s[r])})),t},getVarVals:function(e){var t=[],a=s["a"].orderByKey();return a.once("value").then((function(a){var s=a.val()[e].profile;for(var r in s)t.push(s[r])})),t},getVarNames:function(e){var t=[],a=s["a"].orderByKey();return a.once("value").then((function(a){var s=a.val()[e].profile;for(var r in s)t.push(r)})),t},getStoriesWithDrafts:function(e){var t=[],a={},r=s["a"].orderByKey();return r.once("value").then((function(s){var r=s.val()[e].drafts;for(var i in r)a[i]=s.val()[e].drafts[i];t.push(a)})),t},getDraftsData:function(e,t){var a=[],r=s["a"].orderByKey();return r.once("value").then((function(s){var r=s.val()[e].drafts[t];for(var i in r)a.push(r[i].dateUpdated)})),a},removeStoryDrafts:function(e){confirm("Are you sure you want to delete this story?")&&(s["c"].ref("accounts/"+this.userID+"/drafts/"+e).remove(),location.reload())},removeComment:function(e,t){confirm("Are you sure you want to delete this comment?")&&(location.reload(),s["c"].ref("accounts/"+t+"/comments/"+e).remove(),s["c"].ref("comments/"+e).remove())},editComment:function(e,t,a){if(a.length<=0)alert("Your comment is too short.");else{var r={comment:a};s["c"].ref("accounts/"+t+"/comments/"+e)&&s["c"].ref("accounts/"+t+"/comments/"+e).update(r),s["c"].ref("comments/"+e).update(r),this.editCommentKey="",this.commentEdit="",this.currentlyEditing=!1,location.reload()}},addTag:function(e){var t={tagName:e};s["c"].ref("tags/"+e).update(t),this.addingTag=!1},getTags:function(){var e=[],t=s["e"].orderByKey();return t.once("value").then((function(t){var a=t.val();for(var s in a)e.push(s)})),e}},mixins:[r["a"]]}},"5d3e":function(e,t,a){a("a4d3"),a("e01a"),a("b0c0");var s=a("7037"),r=a("970b"),i=function e(t){"use strict";if(r(this,e),"object"!==s(t))throw new Error("Expected JSON object!");this.name=t.name||null,this.version=t.version||null,this.description=t.description||null,this.author=t.author||null,this.image=t.image||null,this.url=t.url||null,this.license=t.license||null,this.proofing=t.proofing||null,this.source=t.source||null};e.exports=i},"6f5a":function(e,t,a){"use strict";var s=a("bc3a"),r=a.n(s),i=a("1bbf"),n=a.n(i),o=a("dec3"),l=a.n(o),c=a("2a30"),u=a.n(c),h=a("df22"),d=a.n(h),g=a("cf78"),m=a.n(g),f=a("fc8c"),p=a.n(f);t["a"]={data:function(){return{storyFormat:Object}},methods:{html:function(e){var t=new p.a(e).story,a=new l.a(t);t=a.generateViewStory(!1);var s=new u.a(t,this.storyFormat,"body{text-align:center;}","");return s.output},twee:function(e){var t=new d.a(e).story,a=new m.a(t);return a.output}},created:function(){var e=this;r.a.get("/storyformats/harlowe-3/format.js").then((function(t){var a=new n.a(t.data);e.storyFormat=a.storyformat}))}}},"736e":function(e,t,a){a("99af"),a("4de4"),a("4160"),a("caad"),a("a15b"),a("b0c0"),a("ac1f"),a("2532"),a("5319"),a("1276"),a("498a"),a("159b");var s=a("970b"),r=a("5bc3"),i=function(){"use strict";function e(t,a,r,i,n){s(this,e),this.dispPassage=t,this.linkPassage=a,this.story=n.story,this.pages=n.pages,this.theme=r,this.pageNumber=i,this.pageName=this.linkPassage.name,this.imageFiles=[],this.audioFiles=[],this.links=[];for(var o=!1,l=0;l<this.linkPassage.tags.length;l++)this.linkPassage.tags[l].includes("theme_")&&(this.linkPassage.tags[l]="theme_"+this.pageNumber,o=!0);o||this.linkPassage.tags.push("theme_"+this.pageNumber),this.reparseLinks()}return r(e,[{key:"addLink",value:function(e){this.linkPassage.text+="\n[["+e+"]]"}},{key:"removeLink",value:function(e){for(var t=!1,a=0;a<this.links.length;a++)this.links[a].name==e&&(t=!0);if(t){var s=this.linkPassage.text;s=s.split("[[");for(var r=0;r<s.length;r++)if(s[r].includes("]]")){var i=s[r].split("]]"),n=i[0],o=n.includes(e);o?(i[0]="",s[r]=i.join("")):(i[0]=n,s[r]=i.join("]]"))}s=s.filter((function(e){return""!=e})),this.linkPassage.text=s.join("[["),this.linkPassage.text=this.linkPassage.text.trim(),this.validate(),this.reparseLinks(),this.reparseMedia()}}},{key:"reparseMedia",value:function(e,t){this.imageFiles=[],this.audioFiles=[];var a=[];e.forEach((function(e,t){a.push(t)})),t.forEach((function(e,t){a.push(t)})),a=a.sort((function(e,t){return t.length-e.length}));for(var s=this.linkPassage.text,r=0;r<a.length;r++)if(s.includes(a[r])){t.has(a[r])?this.audioFiles.push({name:a[r]}):e.has(a[r])&&this.imageFiles.push({name:a[r]});while(s.includes(a[r]))s=s.replace(a[r],"")}}},{key:"reparseLinks",value:function(){var e=this.linkPassage.text;e=e.split("[["),this.links=[];for(var t=[],a=0;a<e.length;a++)if(e[a].includes("]]")){var s=e[a].split("]]")[0];s.includes("-&gt;")&&(s=s.split("-&gt;")[1]);for(var r=0;r<this.story.getStoryPassages().length;r++)this.story.getStoryPassages()[r].name==s&&(t.includes(s)||(this.links.push({name:s,location:r}),t.push(s)))}}},{key:"replaceLinks",value:function(e){for(var t=!1,a=0;a<this.links.length;a++)this.links[a].name==e.prevName&&(t=!0);if(t){var s=this.linkPassage.text;s=s.split("[[");for(var r=0;r<s.length;r++)if(s[r].includes("]]")){var i,n=s[r].split("]]"),o=n[0],l=!1;o.includes("-&gt;")&&(i=o.split("-&gt;"),o=i[1],l=!0);var c="",u=""!=e.newName;o==e.prevName&&(l?(i[1]=e.newName,c=i.join("-&gt;")):c=e.newName,u?(n[0]=c,s[r]=n.join("]]")):(n[0]="",s[r]=n.join("")))}s=s.filter((function(e){return""!=e})),this.linkPassage.text=s.join("[["),this.linkPassage.text=this.linkPassage.text.trim(),this.validate()}}},{key:"replaceVariable",value:function(e,t){var a=[];t.forEach((function(e,t){a.push(t)}));var s=a.includes(e.prevName);s&&(a=a.sort((function(e,t){return t.length-e.length})),this.linkPassage.text=this.recursiveReplace(e,a,this.linkPassage.text,0))}},{key:"recursiveReplace",value:function(e,t,a,s){var r=t[s],i=a.split(r);if(r==e.prevName)return 1==i.length?i[0]:i.join(e.newName);for(var n="",o=0;o<i.length;o++)o<i.length-1?n+=this.recursiveReplace(e,t,i[o],s+1)+r:n+=this.recursiveReplace(e,t,i[o],s+1);return n}},{key:"addImage",value:function(e){for(var t=!0,a=0;a<this.imageFiles.length;a++)this.imageFiles[a].name==e.name&&(t=!1);t&&this.imageFiles.push(e),this.linkPassage.text+="\n"+e.name}},{key:"removeImage",value:function(e){this.removeKeyFromText(this.imageFiles.concat(this.audioFiles),e.name),this.imageFiles=this.imageFiles.filter((function(t){return t.name!=e.name}))}},{key:"addAudio",value:function(e){for(var t=!0,a=0;a<this.audioFiles.length;a++)this.audioFiles[a].name==e.name&&(t=!1);t&&this.audioFiles.push(e),this.linkPassage.text+="\n"+e.name}},{key:"removeAudio",value:function(e){this.removeKeyFromText(this.audioFiles.concat(this.imageFiles),e.name),this.audioFiles=this.audioFiles.filter((function(t){return t.name!=e.name}))}},{key:"removeKeyFromText",value:function(e,t){var a=[];e.forEach((function(e){a.push(e.name)}));var s={prevName:t,newName:""};a=a.sort((function(e,t){return t.length-e.length})),this.linkPassage.text=this.recursiveReplace(s,a,this.linkPassage.text,0),this.validate()}},{key:"injectCSSText",value:function(){var e="tw-story[tags~='";return e+="theme_"+this.pageNumber+"']{\n",e+="\t"+this.theme+"\n",e+="}",e}},{key:"extractCSSProperty",value:function(e){for(var t=this.theme,a=t.split(";"),s=0;s<a.length;s++){var r=a[s].split(":")[0].trim(),i=a[s].split(":")[1].trim();if(r==e)return i}return"Property not found"}},{key:"validate",value:function(){for(var e=this.linkPassage.text.split("[["),t="",a=0;a<e.length-1;a++)t+=e[a],e[a+1].includes("]]")&&(t+="[[");t+=e[e.length-1],this.linkPassage.text=t.trim()}}]),e}();e.exports=i},"83ca":function(e,t,a){"use strict";a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("96cf");var s=a("1da1"),r=a("6f5a");t["a"]={methods:{browserView:function(e){var t=new Blob([this.html(e.text)],{type:"text/html"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.target="_blank",a.click(),URL.revokeObjectURL(a.href)},editorView:function(e){sessionStorage.setItem("createTemplate",""),sessionStorage.setItem("OGstoryPassages",""),sessionStorage.setItem("storyLocation",""),sessionStorage.setItem("storyContent",e.text);var t=document.createElement("a");t.href="editor.html",t.click(),URL.revokeObjectURL(t.href)},updateViewsBrowser:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.updateViews(e.id,e.title,e.author,e.synopsis,e.tags,e.views,e.dateNow,e.dateAdded,e.text,e.creator,e.storyKey);case 2:t.browserView(e);case 3:case"end":return a.stop()}}),a)})))()},updateViewsEditor:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.updateViews(e.id,e.title,e.author,e.synopsis,e.tags,e.views,e.dateNow,e.dateAdded,e.text,e.creator,e.storyKey);case 2:t.editorView(e);case 3:case"end":return a.stop()}}),a)})))()}},mixins:[r["a"]]}},"8b4c":function(e,t,a){"use strict";a("a15b"),a("ac1f"),a("1276"),a("96cf");var s=a("1da1"),r=a("1543");t["a"]={data:function(){return{Typesense:a("f3b2"),client:"",stories:[]}},methods:{createClient:function(){this.client=new this.Typesense.Client({nodes:[{host:"av2xrki6y54hl3wbp-1.a1.typesense.net",port:"443",protocol:"https"}],apiKey:"I1RDnpfBxdpllDchtj7gslzsqwpmnvmi"})},addStory:function(e){this.createClient();var t=r["d"].collection("stories").doc().id;e.storyKey=t,this.client.collections("stories").documents().create(e),r["d"].collection("stories").doc(t).set(e),this.isSubmitted=!0},removeStory:function(e,t){confirm("Are you sure you want to delete this story?")&&(this.createClient(),this.client.collections("stories").documents(e).delete(),r["d"].collection("stories").doc(t).delete(),this.isDeleted=!0)},updateViews:function(e,t,a,r,i,n,o,l,c,u,h){var d=this;return Object(s["a"])(regeneratorRuntime.mark((function s(){var g;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return d.createClient(),g={id:e,title:t,author:a,synopsis:r,tags:i,views:n+1,dateNow:o,dateAdded:l,text:c,creator:u,storyKey:h},s.prev=2,s.next=5,d.client.collections("stories").documents(e).delete();case 5:console.log("Deleting existing story."),s.next=11;break;case 8:return s.prev=8,s.t0=s["catch"](2),s.abrupt("return");case 11:return s.prev=11,s.next=14,d.client.collections("stories").documents().create(g).then((function(e){console.log(e)}));case 14:s.next=19;break;case 16:s.prev=16,s.t1=s["catch"](11),console.log(s.t1);case 19:case"end":return s.stop()}}),s,null,[[2,8],[11,16]])})))()},getStory:function(e){this.createClient();var t=[];return this.client.collections("stories").documents(e).retrieve().then((function(e){t.push(e)})),t},retrieveTitles:function(){this.createClient();var e=[];return this.client.collections("stories").documents().export().then((function(t){for(var a in t)e.push(JSON.parse(t[a]).title)})),e},retrieveStoryTags:function(e){this.createClient();var t=[];return this.client.collections("stories").documents().export().then((function(a){for(var s in a)if(JSON.parse(a[s]).title===e)for(var r in JSON.parse(a[s]).tags)t.push(JSON.parse(a[s]).tags[r])})),t},retrieveUserStories:function(e){this.createClient();var t=[];return this.client.collections("stories").documents().export().then((function(a){for(var s in a)JSON.parse(a[s]).creator===e&&t.push(JSON.parse(a[s]))})),t},removeTitleSpaces:function(e){var t=e.split(" ").join("-");return t}}}},"8d3b":function(e,t,a){a("b0c0");var s=a("970b"),r=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;s(this,e),this.name=t,this.tags=a,this.metadata=r,this.text=i,this.pid=n}return e}();e.exports=r},"8ed9":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.givenStory[0]?a("div",[e.isDeleted?e._e():a("v-card",{staticClass:"container",attrs:{flat:""}},[e.givenStory?a("v-card-title",{staticClass:"display-1"},[e._v(" "+e._s(e.givenStory[0].title)+" "),a("v-spacer"),a("v-btn",{attrs:{outlined:""},on:{click:function(t){return e.updateViewsBrowser(e.givenStory[0])}}},[e._v("View in Browser")]),a("v-btn",{staticClass:"ml-2",attrs:{outlined:""},on:{click:function(t){return e.updateViewsEditor(e.givenStory[0])}}},[e._v("Edit Story")]),e.givenStory[0].creator===e.userEmail?a("v-btn",{staticClass:"ml-2",attrs:{outlined:""},on:{click:function(t){return e.removeStory(e.givenStory[0].id,e.givenStory[0].storyKey)}}},[e._v("Delete Story")]):e._e()],1):e._e(),a("v-card-subtitle",[e._v(" by "+e._s(e.givenStory[0].author)+" "),a("v-spacer"),e._v(" Created on "+e._s(e.givenStory[0].dateAdded)+" | "+e._s(e.givenStory[0].views)+" views ")],1),a("v-card-title",[e._v("Synopsis")]),a("v-card-text",[e._v(e._s(e.givenStory[0].synopsis))]),a("v-card-actions",[a("v-chip",{staticClass:"ml-2"},[a("v-icon",{attrs:{small:""}},[e._v("mdi-tag")]),e._v(" Tags ")],1),e._l(e.givenStory[0].tags,(function(t){return a("v-chip",{key:t[".key"],staticClass:"ml-2",attrs:{color:"orange","text-color":"white"}},[e._v(" "+e._s(t)+" ")])}))],2),a("v-list",{attrs:{"two-line":""}},[a("v-card-title",{staticClass:"pb-0"},[e._v("Comments")]),e._l(e.storyComments,(function(t){return a("div",{key:t[".key"]},[t.storyTitle===e.givenStory[0].title?a("v-list-item",{staticClass:"comment"},[e.currentlyEditing&&t.commentKey===e.editCommentKey?e._e():a("v-list-item-content",[a("v-list-item-title",{staticClass:"text-wrap"},[e._v(e._s(t.comment))]),a("v-list-item-subtitle",[e._v(" "+e._s(t.name)+" "+e._s(t.dateAdded)+" ")])],1),e.currentlyEditing&&t.commentKey===e.editCommentKey?e._e():a("v-list-item-action",{staticClass:"comment-actions"},[e.userEmail===t.email?a("v-btn",{attrs:{title:"Edit Comment",icon:""},on:{click:function(a){return e.confirmEdit(t.commentKey,t.comment)}}},[a("v-icon",[e._v("mdi-pencil")])],1):e._e()],1),e.currentlyEditing&&t.commentKey===e.editCommentKey?e._e():a("v-list-item-action",{staticClass:"comment-actions"},[e.userEmail===t.email?a("v-btn",{attrs:{title:"Remove Comment",icon:""},on:{click:function(a){return e.removeComment(t.commentKey,e.userID)}}},[a("v-icon",[e._v("mdi-delete")])],1):e._e()],1),t.commentKey===e.editCommentKey?a("v-list-item-content",[a("form",{staticClass:"edit-comment"},[a("v-text-field",{model:{value:e.commentEdit,callback:function(t){e.commentEdit=t},expression:"commentEdit"}}),a("v-btn",{staticClass:"mb-2",attrs:{outlined:"",small:""},on:{click:function(a){return e.editComment(t.commentKey,e.userID,e.commentEdit)}}},[e._v("Submit")])],1)]):e._e()],1):e._e()],1)}))],2),a("v-card-text",{staticClass:"pt-1"},[a("v-btn",{attrs:{outlined:"",small:""},on:{click:function(t){e.showAddComment=!0}}},[e._v("Add Comment")]),e.showAddComment?a("div",{staticClass:"add-comment"},[e.isVerified?a("addComment",{attrs:{givenStoryTitle:e.givenStory[0].title}}):e._e(),e.isLoggedIn?e._e():a("p",[e._v(" You need to log in to comment")])],1):e._e()],1)],1),e.isDeleted?a("h3",[e._v("This story has been deleted!")]):e._e()],1):e._e()},r=[],i=(a("4160"),a("fb6a"),a("4fad"),a("159b"),a("96cf"),a("1da1")),n=a("8aa5"),o=a.n(n),l=a("8b4c"),c=a("48c3"),u=a("83ca"),h=a("1543"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",[e.commentChecker?e._e():a("v-text-field",{attrs:{disabled:e.isSubmitted,label:"Add a comment...",required:""},model:{value:e.newComment.comment,callback:function(t){e.$set(e.newComment,"comment",t)},expression:"newComment.comment"}}),e.commentChecker?e._e():a("button",{staticClass:"button",attrs:{disabled:!e.commentComplete},on:{click:function(t){return e.getTags()}}},[e._v("Next")])],1),a("div",{attrs:{id:"second-form"}},[a("form",[e.commentChecker?a("v-select",{attrs:{items:e.tagsInStory,disabled:e.isSubmitted,multiple:!0,label:"Tags that you found were well-represented in this story",required:""},model:{value:e.newComment.helpfulTags,callback:function(t){e.$set(e.newComment,"helpfulTags",t)},expression:"newComment.helpfulTags"}}):e._e(),e.commentChecker&&!e.isSubmitted?a("button",{staticClass:"button",attrs:{disabled:!e.tagsComplete},on:{click:function(t){return e.post()}}},[e._v("Comment")]):e._e(),e.isSubmitted?a("p",[e._v("Thank you for commenting!")]):e._e()],1)])])},g=[],m=(a("b0c0"),new Date),f={props:["givenStoryTitle"],data:function(){return{newComment:{storyTitle:"",name:"",email:"",comment:"",dateNow:Date.now(),dateAdded:m.getMonth()+1+"/"+m.getDate()+"/"+m.getFullYear(),helpfulTags:[],commentKey:""},isSubmitted:!1,nameArray:[],commentChecker:!1,tagsInStory:[]}},computed:{commentComplete:function(){return this.newComment.comment&&this.newComment.storyTitle},tagsComplete:function(){return this.newComment.helpfulTags.length>0}},methods:{getTags:function(){this.tagsInStory=this.retrieveStoryTags(this.newComment.storyTitle),this.commentChecker=!0},post:function(){var e=h["c"].ref().push().key;this.newComment.commentKey=e,h["c"].ref("accounts/"+o.a.auth().currentUser.uid+"/comments/"+e).update(this.newComment),h["c"].ref("comments/"+e).update(this.newComment),this.isSubmitted=!0}},created:function(){this.newComment.storyTitle=this.givenStoryTitle,o.a.auth().currentUser&&(this.newComment.name=o.a.auth().currentUser.displayName,this.newComment.email=o.a.auth().currentUser.email)},mixins:[l["a"],c["a"]]},p=f,v=a("2877"),y=a("6544"),b=a.n(y),S=a("b974"),x=a("8654"),w=Object(v["a"])(p,d,g,!1,null,"b4afe72e",null),k=w.exports;b()(w,{VSelect:S["a"],VTextField:x["a"]});var V={name:"Story",components:{addComment:k},data:function(){return{storyID:"",tagsData:[],givenStory:[{}],storyComments:[],givenStoryComments:[],isLoggedIn:!1,isVerified:!1,showAddComment:!1,isMyComment:!1,userEmail:"",userID:"",editCommentKey:"",commentEdit:"",currentlyEditing:!1,isDeleted:!1}},firebase:{storyComments:h["b"]},methods:{populateTagsObj:function(){var e=[],t={},a=h["b"].orderByKey();return a.once("value").then((function(a){for(var s in a.forEach((function(e){var a=e.val().storyTitle;"undefined"===typeof t[a]&&(t[a]={}),e.val().helpfulTags.forEach((function(e){"undefined"===typeof t[a][e]&&(t[a][e]=0),t[a][e]+=1}))})),t)t[s]=Object.entries(t[s]),t[s].sort((function(e,t){return t[1]-e[1]})),t[s].length>3&&(t[s]=t[s].slice(0,3));e.push(t)})),e},showAdd:function(){this.ShowAddComments=!0},confirmEdit:function(e,t){this.editCommentKey=e,this.commentEdit=t,this.currentlyEditing=!0}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o.a.auth().currentUser&&(e.isVerified=o.a.auth().currentUser.emailVerified,e.isLoggedIn=o.a.auth().currentUser,e.userEmail=o.a.auth().currentUser.email,e.userID=o.a.auth().currentUser.uid),e.tagsData=e.populateTagsObj(),e.storyID=e.$route.params.id,t.next=5,e.getStory(e.storyID);case 5:e.givenStory=t.sent;case 6:case"end":return t.stop()}}),t)})))()},mixins:[l["a"],u["a"],c["a"]]},P=V,N=(a("9d79"),a("8336")),C=a("b0af"),E=a("99d9"),_=a("cc20"),T=a("132d"),O=a("8860"),j=a("da13"),I=a("1800"),L=a("5d23"),A=a("2fa4"),M=Object(v["a"])(P,s,r,!1,null,"6e0e829c",null);t["a"]=M.exports;b()(M,{VBtn:N["a"],VCard:C["a"],VCardActions:E["a"],VCardSubtitle:E["b"],VCardText:E["c"],VCardTitle:E["d"],VChip:_["a"],VIcon:T["a"],VList:O["a"],VListItem:j["a"],VListItemAction:I["a"],VListItemContent:L["a"],VListItemSubtitle:L["b"],VListItemTitle:L["c"],VSpacer:A["a"],VTextField:x["a"]})},"9d79":function(e,t,a){"use strict";var s=a("f3a5"),r=a.n(s);r.a},b84b:function(e,t,a){"use strict";function s(e){var t=e.$options.title;if(t)return"function"===typeof t?t.call(e):t}t["a"]={created:function(){var e=s(this);e&&(document.title=e)}}},cf78:function(e,t,a){a("b0c0");var s=a("6374"),r=a("7037"),i=a("970b"),n=a("5bc3"),o=a("e349"),l=function(){"use strict";function e(t){if(i(this,e),!(t instanceof o))throw new Error("Not a Story object!");this.output=null,this.writeFile(t)}return n(e,[{key:"writeFile",value:function(e){var t=":: StoryTitle\n"+e.name+"\n\n";if(t+=":: StoryData\n","object"!==r(e.metadata))throw new Error("Story Metadata MUST be an object!");if(t+=" "+JSON.stringify(e.metadata,void 0,2),t+="\n\n",e.passages.length>0)for(var a in e.passages){if(t+=":: "+e.passages[a].name,e.passages[a].tags.length>0){t+=" [";var i,n=s(e.passages[a].tags);try{for(n.s();!(i=n.n()).done;){var o=i.value;t+=" "+o}}catch(l){n.e(l)}finally{n.f()}t+="]"}t+=JSON.stringify(e.passages[a].metadata),t+="\n"+e.passages[a].text+"\n\n"}else t+=":: Start\n";this.output=t}}]),e}();e.exports=l},dec3:function(e,t,a){a("4de4"),a("4160"),a("caad"),a("c975"),a("a15b"),a("baa5"),a("fb6a"),a("b0c0"),a("4ec9"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("5319"),a("1276"),a("498a"),a("159b"),a("ddb0");var s=a("970b"),r=a("5bc3"),i=a("8d3b"),n=a("736e"),o=a("e349"),l="variables",c=0,u=0,h=0,d=function(){"use strict";function e(t){s(this,e),this.baseStory=t,this.exportedStoryPages=[],this.variables=new Map,this.imageVariables=new Map,this.audioVariables=new Map,this.css="",this.js="",this.regeneratePages(),this.parseVariables(),this.generateStoryText(!0),this.reparseMedia()}return r(e,[{key:"extractDefault",value:function(e){var t=e.indexOf(";"),a=e.lastIndexOf("&");return e.slice(t+1,a)}},{key:"writeVariable",value:function(e,t){var a=e.indexOf(";"),s=e.lastIndexOf("&");return e.slice(0,a+1)+t+e.slice(s,e.length)}},{key:"extractVariable",value:function(e){var t=e.indexOf("$"),a="";while(" "!=e.charAt(t))a+=e.charAt(t),t++;return a}},{key:"parseVariables",value:function(){var e=[];if(this.baseStory.passages.length>0&&(e=this.baseStory.passages.filter((function(e){var t=e.tags.filter((function(e){return e===l}));return t.length>0}))),this.variables.clear(),1!=e.length)throw new Error("Please remove extra variable passage tags");var t=e[0].text,a=t.split("\n");console.log(a.length);for(var s=0;s<a.length;s++)if(a[s].includes("(set:")){var r=this.extractVariable(a[s]),i=this.extractDefault(a[s]);this.variables.has(r)&&alert('Duplicate Variable \n\nUpdating Value to: "'+i+'"'),this.variables.set(r,{value:i,color:"",id:c++}),console.log(r+" "+i)}else if(a[s].includes("(hidden:)")){var n=this.extractArr(a[s]);if("image"==n.type)for(var o=0;o<n.data.length;o++){var d=this.extractSrc(n.data[o]);this.imageVariables.set(n.data[o].substring(0,n.data[o].indexOf("{")),{file:null,fileName:d.name,path:d.src,color:"",id:u++,uploaded:!d.src.i.includes("blob")})}else if("audio"==n.type)for(var g=0;g<n.data.length;g++){var m=this.extractSrc(n.data[g]);this.audioVariables.set(n.data[g].substring(0,n.data[g].indexOf("{")),{file:null,fileName:d.name,path:m.src,color:"",id:h++,uploaded:!m.src.i.includes("blob")})}}a=a.filter((function(e){return!e.includes("(set:")&&!e.includes("(hidden:)")}));for(var f=0;f<this.baseStory.passages.length;f++)if(this.baseStory.passages[f].tags.includes(l)){this.baseStory.passages[f].text=a.join("\n");break}this.detVariableColors(),this.printVariableData()}},{key:"extractArr",value:function(e){var t=e.split("["),a=t[1].replace("]","");t=a.split(":");var s=t[0],r=a.replace(t[0]+":","").split(",");return r=r.filter((function(e){return""!=e})),console.log(r),{type:s,data:r}}},{key:"extractSrc",value:function(e){var t=e.split("{"),a="",s="";return t.length>1&&(a=t[1].split(" ")[0],s=t[1].split(" ")[1].replace("}","")),{src:{i:a},name:s}}},{key:"removeVariableInject",value:function(){var e=sessionStorage.getItem("preProcessedBaseText"),t=""!=e;if(t){for(var a=0;a<this.baseStory.passages.length;a++)if(this.baseStory.passages[a].tags.includes(l)){this.baseStory.passages[a].text=e;break}for(var s=0;s<this.exportedStoryPages.length;s++)if(this.exportedStoryPages[s].linkPassage.tags.includes(l)){this.exportedStoryPages[s].linkPassage.text=e;break}}}},{key:"detVariableColors",value:function(){this.detTextVariableColors(),this.detImageVariableColors(),this.detAudioVariableColors()}},{key:"detImageVariableColors",value:function(){var e=[];this.imageVariables.forEach((function(t,a){e.push(a)}));var t=this.imageVariables;e=e.sort((function(e,a){var s=t.get(e).id,r=t.get(a).id;return s-r}));for(var a=0;a<e.length;a++){var s=this.imageVariables.get(e[a]);if(""==s.color){var r=255,i=165,n=0,o=256*Math.random(),l=256*Math.random(),c=256*Math.random();s.color="rgb("+(r+o)/2+","+(i+l)/2+","+(n+c)/2+")"}this.imageVariables.set(e[a],s)}}},{key:"detAudioVariableColors",value:function(){var e=[];this.audioVariables.forEach((function(t,a){e.push(a)}));var t=this.audioVariables;e=e.sort((function(e,a){var s=t.get(e).id,r=t.get(a).id;return s-r}));for(var a=0;a<e.length;a++){var s=this.audioVariables.get(e[a]);if(""==s.color){var r=255,i=165,n=0,o=256*Math.random(),l=256*Math.random(),c=256*Math.random();s.color="rgb("+(r+o)/2+","+(i+l)/2+","+(n+c)/2+")"}this.audioVariables.set(e[a],s)}}},{key:"detTextVariableColors",value:function(){var e=[];this.variables.forEach((function(t,a){e.push(a)}));var t=this.variables;e=e.sort((function(e,a){var s=t.get(e).id,r=t.get(a).id;return s-r}));for(var a=0;a<e.length;a++){var s=this.variables.get(e[a]);if(""==s.color){var r=255,i=165,n=0,o=256*Math.random(),l=256*Math.random(),c=256*Math.random();s.color="rgb("+(r+o)/2+","+(i+l)/2+","+(n+c)/2+")"}this.variables.set(e[a],s)}}},{key:"printVariableData",value:function(){this.imageVariables.forEach((function(e,t){console.log(t+"==>"+JSON.stringify(e))})),this.audioVariables.forEach((function(e,t){console.log(t+"==>"+JSON.stringify(e))})),this.variables.forEach((function(e,t){console.log(t+"==>"+JSON.stringify(e))}))}},{key:"reparseLinks",value:function(){for(var e=0;e<this.exportedStoryPages.length;e++)this.exportedStoryPages[e].reparseLinks()}},{key:"reparseMedia",value:function(){for(var e=0;e<this.exportedStoryPages.length;e++)this.exportedStoryPages[e].reparseMedia(this.imageVariables,this.audioVariables)}},{key:"addAudioToPage",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)this.exportedStoryPages[t].pageName==e.pageName&&this.exportedStoryPages[t].addAudio(e);this.reparseMedia()}},{key:"removeAudioFromPage",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)this.exportedStoryPages[t].pageName==e.pageName&&this.exportedStoryPages[t].removeAudio(e);this.reparseMedia()}},{key:"addImageToPage",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)this.exportedStoryPages[t].pageName==e.pageName&&this.exportedStoryPages[t].addImage(e);this.reparseMedia()}},{key:"removeImageFromPage",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)this.exportedStoryPages[t].pageName==e.pageName&&this.exportedStoryPages[t].removeImage(e);this.reparseMedia()}},{key:"replaceLinks",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++){this.exportedStoryPages[t].replaceLinks(e);for(var a=0;a<this.baseStory.passages.length;a++)this.baseStory.passages[a].name==this.exportedStoryPages[t].linkPassage.name&&(this.baseStory.passages[a].text=this.exportedStoryPages[t].linkPassage.text)}}},{key:"replaceVariables",value:function(e){var t=new Map;this.variables.forEach((function(e,a){t.set(a,e)})),this.imageVariables.forEach((function(e,a){t.set(a,e)})),this.audioVariables.forEach((function(e,a){t.set(a,e)}));for(var a=0;a<this.exportedStoryPages.length;a++){this.exportedStoryPages[a].replaceVariable(e,t);for(var s=0;s<this.baseStory.passages.length;s++)this.baseStory.passages[s].name==this.exportedStoryPages[a].linkPassage.name&&(this.baseStory.passages[s].text=this.exportedStoryPages[a].linkPassage.text)}}},{key:"addLink",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)if(this.exportedStoryPages[t].pageName==e.pageName){this.exportedStoryPages[t].addLink(e.name);break}this.reparseLinks()}},{key:"removeLink",value:function(e){for(var t=0;t<this.exportedStoryPages.length;t++)if(this.exportedStoryPages[t].pageName==e.name){this.exportedStoryPages[t].removeLink(e.removeLink);break}this.reparseLinks()}},{key:"setStartPage",value:function(e){for(var t=0;t<this.baseStory.passages.length;t++){this.baseStory.passages[t].tags.includes("start")&&(this.baseStory.passages[t].tags=this.baseStory.passages[t].tags.filter((function(e){return"start"!=e}))),this.baseStory.passages[t].tags.includes(l)&&(this.baseStory.passages[t].tags=this.baseStory.passages[t].tags.filter((function(e){return e!=l}))),this.baseStory.passages[t].name==e.name&&(this.baseStory.passages[t].tags.push("start"),this.baseStory.passages[t].tags.push(l));var a=this.baseStory.passages[t].text,s=a.split("\n");s=s.filter((function(e){return!e.includes("(set:")})),this.baseStory.passages[t].text=s.join("\n")}}},{key:"addPage",value:function(e){var t=e.name,a=!0;if(a){var s="This is a new passage. Edit it to create your own story!\n[[go back-&gt;"+e.prevLink+"]]",r=new i(t,["story"],{position:"500, 500",size:"100,100"},s,this.baseStory.passages.length+1);this.baseStory.passages.push(r),this.exportedStoryPages.push(new n(null,r,"background-color: #ffffff; color: #000000;",this.baseStory.getStoryPassages().length,{story:this.baseStory,pages:this.baseStory.getStoryPassages().length})),this.reparseLinks(),this.reparseMedia()}}},{key:"regeneratePages",value:function(){this.exportedStoryPages=[];for(var e=this.baseStory.getStoryPassages().length,t=0;t<e;t++)this.exportedStoryPages.push(new n(null,this.baseStory.getStoryPassages()[t],"background-color: #ffffff; color: #000000;",t+1,{story:this.baseStory,pages:e}))}},{key:"changePassageName",value:function(e){if(e.prevName!=e.newName){for(var t=0;t<this.baseStory.passages.length;t++)this.baseStory.passages[t].name==e.prevName&&(this.baseStory.passages[t].name=e.newName,console.log("Changed Name"));for(var a=0;a<this.exportedStoryPages.length;a++)this.exportedStoryPages[a].linkPassage.name==e.prevName&&(this.exportedStoryPages[a].linkPassage.name=e.newName,console.log("Changed Name"));this.replaceLinks(e),this.reparseLinks()}}},{key:"deletePassage",value:function(e){for(var t,a=0,s=0;s<this.baseStory.passages.length;s++)if(this.baseStory.passages[s].name==e.name){t=this.baseStory.passages[s],a=s,console.log("Passage:"+t.name);break}t.tags.includes(l)?alert("DELETING THIS PASSAGE WILL RESULT IN STORY BREAKAGE\nABORTING DELETE"):(t.tags.includes("start")&&(alert("Deleting this passage will randomly assign a new start passage, select a start passage from the passages menu"),this.baseStory.passages[a+1].tags.push("start")),this.baseStory.passages=this.baseStory.passages.filter((function(t){return t.name!=e.name})),this.exportedStoryPages=this.exportedStoryPages.filter((function(t){return t.pageName!=e.name})),this.replaceLinks({prevName:e.name,newName:""}),this.reparseLinks())}},{key:"setTextVariable",value:function(e,t){var a=this.variables.get(e);console.log(JSON.stringify(a)),a.value=t,this.variables.set(e,a)}},{key:"setImageVariable",value:function(e,t){this.imageVariables.set(e,t),this.reparseMedia()}},{key:"setAudioVariable",value:function(e,t){this.audioVariables.set(e,t),this.reparseMedia()}},{key:"changeTextVariableName",value:function(e){var t=this.checkEvent({name:e.newName},"text");if(t){this.replaceVariables(e);var a=this.variables.get(e.prevName);this.variables.delete(e.prevName),this.variables.set(e.newName,a)}return t}},{key:"changeImageVariableName",value:function(e){var t=this.checkEvent({name:e.newName},"media");if(console.log(),t){this.replaceVariables(e);var a=this.imageVariables.get(e.prevName);this.imageVariables.delete(e.prevName),this.imageVariables.set(e.newName,a),this.reparseMedia()}return t}},{key:"changeAudioVariableName",value:function(e){var t=this.checkEvent({name:e.newName},"media");if(t){this.replaceVariables(e);var a=this.audioVariables.get(e.prevName);this.audioVariables.delete(e.prevName),this.audioVariables.set(e.newName,a),this.reparseMedia()}return t}},{key:"addTextVariable",value:function(e){var t=this.checkEvent(e,"text");return t&&(this.variables.set(e.name,{value:e.value,color:"",id:c++}),this.detVariableColors()),t}},{key:"addImageVariable",value:function(e){var t=this.checkEvent(e,"media");return t&&(this.imageVariables.set(e.name,{file:e.file,fileName:e.fileName,path:e.path,color:"",id:u++,uploaded:e.uploaded}),this.detVariableColors()),t}},{key:"addAudioVariable",value:function(e){var t=this.checkEvent(e,"media");return t&&(this.audioVariables.set(e.name,{file:e.file,fileName:e.fileName,path:e.path,color:"",id:h++,uploaded:e.uploaded}),this.detVariableColors()),t}},{key:"checkEvent",value:function(e,t){var a=!1;return"text"==t?a=!this.variables.has(e.name):"media"==t&&(a=!(this.imageVariables.has(e.name)||this.audioVariables.has(e.name))),a||alert(e.name+" already exists!"),a}},{key:"deleteTextVariable",value:function(e){var t=[];this.variables.forEach((function(e,a){t.push({name:a})}));for(var a=0;a<this.exportedStoryPages.length;a++)this.exportedStoryPages[a].removeKeyFromText(t,e.name);this.variables.delete(e.name);var s=[];this.variables.forEach((function(e,t){s.push(t)})),s=s.sort((function(e,t){return e>t?1:e<t?-1:0}));for(var r=0;r<s.length;r++){var i=this.variables.get(s[r]);i.id--,this.variables.set(s[r],i)}c--}},{key:"deleteImageVariable",value:function(e){var t=[];this.imageVariables.forEach((function(e,a){t.push({name:a})})),this.audioVariables.forEach((function(e,a){t.push({name:a})}));for(var a=0;a<this.exportedStoryPages.length;a++)this.exportedStoryPages[a].removeKeyFromText(t,e.name);this.imageVariables.delete(e.name);var s=[];this.imageVariables.forEach((function(e,t){s.push(t)})),s=s.sort((function(e,t){return e>t?1:e<t?-1:0}));for(var r=0;r<s.length;r++){var i=this.imageVariables.get(s[r]);i.id--,this.imageVariables.set(s[r],i)}u--,this.reparseMedia()}},{key:"deleteAudioVariable",value:function(e){var t=[];this.imageVariables.forEach((function(e,a){t.push({name:a})})),this.audioVariables.forEach((function(e,a){t.push({name:a})}));for(var a=0;a<this.exportedStoryPages.length;a++)this.exportedStoryPages[a].removeKeyFromText(t,e.name);this.audioVariables.delete(e.name);var s=[];this.audioVariables.forEach((function(e,t){s.push(t)})),s=s.sort((function(e,t){return e>t?1:e<t?-1:0}));for(var r=0;r<s.length;r++){var i=this.audioVariables.get(s[r]);i.id--,this.audioVariables.set(s[r],i)}h--,this.reparseMedia()}},{key:"setPassage",value:function(e,t){for(var a=0;a<this.baseStory.passages.length;a++)this.baseStory.passages[a].name==e&&(this.baseStory.passages[a].text=t,console.log("Text Changed"));this.reparseLinks(),this.reparseMedia()}},{key:"changeStoryName",value:function(e){this.baseStory.name=e.name}},{key:"generateViewStory",value:function(e){this.css="",console.log("Generating Story...");var t=new o(JSON.parse(JSON.stringify(this.baseStory)));console.log(t.name);for(var a=0;a<t.passages.length;a++){var s=JSON.parse(JSON.stringify(this.exportedStoryPages[a].linkPassage));if(t.passages[a]=new i(s.name,s.tags,s.metadata,s.text,s.pid),t.passages[a].text=t.passages[a].text.trim(),t.passages[a].tags.includes(l)){var r=t.passages[a].text,n=[];this.variables.forEach((function(e,t){n.push(t)})),n=n.sort((function(e,t){return e.length-t.length}));for(var c=0;c<n.length;c++){var u=n[c],h=r.split(u),d=this.variables.get(u);r=h.join(d.value)}t.passages[a].text=r+"\n"+this.injectVariableText()}e&&(t.passages[a].text=this.injectMedia(t.passages[a].text)),this.css+=this.exportedStoryPages[a].injectCSSText()+"\n"}return this.css+="body{ text-align: center;}",t}},{key:"injectMedia",value:function(e){var t=[];this.imageVariables.forEach((function(e,a){t.push(a)})),this.audioVariables.forEach((function(e,a){t.push(a)})),t=t.sort((function(e,t){return t.length-e.length}));for(var a=0;a<t.length;a++){var s=t[a],r=e.split(s),i=null;this.imageVariables.has(s)?(i=this.imageVariables.get(s),e=r.join("<img style = 'max-width: 50%; max-height:50%;' src = '"+i.path.i+"' alt = "+s.replace("@","")+"/>")):this.audioVariables.has(s)&&(i=this.audioVariables.get(s),e=r.join("<audio controls><source src = '"+i.path.i+"'> Your Browser Does not support the audio element </audio>"))}return e}},{key:"injectVariableText",value:function(){var e="";return this.variables.forEach((function(t,a){e+="(set: ",e+=a,e+=" to &quot;",e+=t.value,e+="&quot;)\n"})),e+="(hidden:)[image:",this.imageVariables.forEach((function(t,a){e+=a+"{"+t.path.i+" "+t.fileName+"},"})),e+="]\n",e+="(hidden:)[audio:",this.audioVariables.forEach((function(t,a){e+=a+"{"+t.path.i+" "+t.fileName+"},"})),e+="]\n",e}},{key:"generateSaveStory",value:function(){this.css="";for(var e=new o(JSON.parse(JSON.stringify(this.baseStory))),t=0;t<e.passages.length;t++){var a=JSON.parse(JSON.stringify(this.exportedStoryPages[t].linkPassage));e.passages[t]=new i(a.name,a.tags,a.metadata,a.text,a.pid),e.passages[t].text=e.passages[t].text.trim(),e.passages[t].tags.includes(l)&&(e.passages[t].text=e.passages[t].text+"\n"+this.injectVariableText()),this.css+=this.exportedStoryPages[t].injectCSSText()+"\n"}return e}},{key:"generateStoryText",value:function(e,t,a){for(var s=this.baseStory.getStoryPassages(),r=0;r<s.length;r++){var n=s[r].text;n=this.processTextVariables(n,e,t),n=this.processMediaVariables(n,e,a);while(n.includes("]]")||n.includes("[["))n=n.replace("[[","<u>"),n=n.replace("]]","</u>");while(n.includes("&quot;")||n.includes("&#39;")||n.includes("&gt;")||n.includes("&lt;"))n=n.replace("&quot;",'"'),n=n.replace("&#39;","'"),n=n.replace("&lt;","<"),n=n.replace("&gt;",">");var o=new i(s[r].name,s[r].tags,s[r].metadata,n,s[r].pid);this.exportedStoryPages[r].dispPassage=o,this.exportedStoryPages[r].pageName=o.name,this.exportedStoryPages[r].story=this.baseStory,this.exportedStoryPages[r].pages=this.baseStory.getStoryPassages().length}}},{key:"processTextVariables",value:function(e,t,a){var s=[];this.variables.forEach((function(e,t){s.push(t)})),s=s.sort((function(e,t){return t.length-e.length}));for(var r=0;r<s.length;r++){var i=s[r],n=e.split(i),o=this.variables.get(i);e=t?a?n.join("<span style = 'color:"+o.color+";'><strong>"+o.value+"</strong></span>"):n.join("<span>"+o.value+"</span>"):a?n.join("<span style = 'color:"+o.color+";'><strong>("+i.replace("$","")+")</strong></span>"+o.value):n.join("<span>("+i.replace("$","")+")</span>"+o.value)}return e}},{key:"processMediaVariables",value:function(e,t,a){var s=[];this.imageVariables.forEach((function(e,t){s.push(t)})),this.audioVariables.forEach((function(e,t){s.push(t)})),s=s.sort((function(e,t){return t.length-e.length}));for(var r=0;r<s.length;r++){var i=s[r],n=e.split(i),o=this.imageVariables.has(i)?this.imageVariables.get(i):this.audioVariables.get(i),l="";l=o.fileName.length>30?o.fileName.substr(0,30)+"...":o.fileName,""==l&&(l="No File Uploaded"),e=t?a?n.join("<span style = 'color:"+o.color+";'><strong>("+l+")</strong></span>"):n.join("<span>("+l+")</span>"):a?n.join("<span style = 'color:"+o.color+";'><strong>("+i.replace("@","")+")</strong></span>"+l):n.join("<span>("+i.replace("@","")+")</span>"+l)}return e}},{key:"generatePublishStory",value:function(){this.css="";for(var e=new o(JSON.parse(JSON.stringify(this.baseStory))),t=0;t<e.passages.length;t++){var a=JSON.parse(JSON.stringify(this.exportedStoryPages[t].linkPassage));e.passages[t]=new i(a.name,a.tags,a.metadata,a.text,a.pid),e.passages[t].text=e.passages[t].text.trim(),e.passages[t].tags.includes(l)&&(e.passages[t].text=e.passages[t].text+"\n"+this.injectPublishVariableText()),this.css+=this.exportedStoryPages[t].injectCSSText()+"\n"}return this.css+="body{ text-align: center;}",e}},{key:"injectPublishVariableText",value:function(){var e="";return this.variables.forEach((function(t,a){e+="(set: ",e+=a,e+=" to &quot;",e+="("+a.replace("$","")+")",e+="&quot;)\n"})),e+="(hidden:)[image:",this.imageVariables.forEach((function(t,a){e+=a+"{ },"})),e+="]\n",e+="(hidden:)[audio:",this.audioVariables.forEach((function(t,a){e+=a+"{ },"})),e+="]\n",e}},{key:"destroy",value:function(){}}]),e}();e.exports=d},df22:function(e,t,a){a("4de4"),a("b0c0"),a("ac1f"),a("5319"),a("1276");var s=a("970b"),r=a("5bc3"),i=a("d556"),n=i.parse,o=n,l=a("e349"),c=a("8d3b"),u=function(){"use strict";function e(t){s(this,e),this.story=null,this.parse(t)}return r(e,[{key:"parse",value:function(e){var t=new o(e,{lowerCaseTagName:!1,script:!0,style:!0,pre:!0}),a=t.querySelector("tw-storydata");if(null==a)throw new Error("Error: Not a Twine 2-style file!");this.story=new l,this.story.name=a.attributes.name,this.story.creator=a.attributes.creator,this.story.creatorVersion=a.attributes["creator-version"],this.story.metadata={},this.story.metadata.ifid=a.attributes.ifid,this.story.metadata.format=a.attributes.format,this.story.metadata.formatVersion=a.attributes["format-version"],this.story.metadata.zoom=a.attributes.zoom,this.story.metadata.start=a.attributes.startnode;var s=t.querySelectorAll("tw-passagedata");this.story.passages=[];var r=1;for(var i in this.story.passages.push(new c("StoryTitle",[],{},this.story.name,r)),r++,s){var n=s[i].attributes,u=s[i].rawText,h=n.position,d=n.size,g=this._escapeMetacharacters(n.name),m="";n.tags.length>0&&'""'!==n.tags&&(m=this._escapeMetacharacters(n.tags)),m=m.split(" "),m=m.filter((function(e){return""!==e})),this.story.passages.push(new c(g,m,{position:h,size:d},u,r)),r++}var f=t.querySelector("#twine-user-stylesheet");f.rawText.length>0&&this.story.passages.push(new c("UserStylesheet",["stylesheet"],{},f.rawText));var p=t.querySelector("#twine-user-script");p.rawText.length>0&&this.story.passages.push(new c("UserScript",["script"],{},p.rawText)),this.story.metadata.start=this.story.getStartingPassage(),this.story.passages.push(new c("StoryData",[],{},JSON.stringify(this.story.metadata,null,4)))}},{key:"_escapeMetacharacters",value:function(e){return e=e.replace(/\\/g,"\\"),e=e.replace(/\\\{/g,"\\\\{"),e=e.replace(/\\\}/g,"\\\\}"),e=e.replace(/\\\[/g,"\\\\["),e=e.replace(/\\\]/g,"\\\\]"),e}}]),e}();e.exports=u},e349:function(e,t,a){a("4de4"),a("caad"),a("b0c0"),a("2532");var s=a("970b"),r=a("5bc3"),i=a("13fd"),n=function(){"use strict";function e(t){s(this,e),null==t?(this.name="Unknown",this.metadata={ifid:"",format:"",formatVersion:"",zoom:"",start:""},this.passages=[],this.creator=i.name,this.creatorVersion=i.version):Object.assign(this,t)}return r(e,[{key:"getStylePassages",value:function(){var e=[];return this.passages.length>0&&(e=this.passages.filter((function(e){var t=e.tags.filter((function(e){return"stylesheet"===e}));return t.length>0}))),e}},{key:"getScriptPassages",value:function(){var e=[];return this.passages.length>0&&(e=this.passages.filter((function(e){var t=e.tags.filter((function(e){return"script"===e}));return t.length>0}))),e}},{key:"getStoryPassages",value:function(){var e=[];return this.passages.length>0&&(e=this.passages.filter((function(e){var t=e.tags.filter((function(e){return"story"===e}));return t.length>0}))),e}},{key:"deleteAllByTag",value:function(e){this.passages.length>0&&(this.passages=this.passages.filter((function(t){return!t.tags.includes(e)})))}},{key:"getStartingPassage",value:function(){var e=null,t=null;if(Object.prototype.hasOwnProperty.call(this.metadata,"start")&&""!==this.metadata.start&&(t=this.metadata.start),this.passages.length>0)for(var a in this.passages){if(this.passages[a].name===t){e=this.passages[a].pid;break}"Start"===this.passages[a].name&&(e=this.passages[a].pid),this.passages[a].tags.includes("start")&&(e=this.passages[a].pid)}if(null===e)throw new Error("Starting passage not found!");return e}}]),e}();e.exports=n},f3a5:function(e,t,a){},fc8c:function(e,t,a){a("4de4"),a("7db0"),a("4160"),a("c975"),a("baa5"),a("fb6a"),a("b0c0"),a("ac1f"),a("1276"),a("498a"),a("159b");var s=a("970b"),r=a("5bc3"),i=a("8d3b"),n=a("e349"),o=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";s(this,e),this.story=new n,this._passageMetadataError=!1,this._storydataError=!1,this.parse(t)}return r(e,[{key:"parse",value:function(e){var t=this;if(0===e.length)throw new Error("No file contents!");var a=[],s="";s=":"!==e[0]&&":"!==e[1]?e.slice(e.indexOf("::"),e.length):e;var r=s.split("\n::");r[0]=r[0].slice(2,r[0].length);var n=0;r.forEach((function(e){var s="",r="",o="",l="",c=e.slice(0,e.indexOf("\n"));o=e.substring(c.length+1,e.length).trim();var u=c.lastIndexOf("{"),h=c.lastIndexOf("}");if(-1!==u&&-1!==h&&(r=c.slice(u,h+1),c=c.substring(0,u)+c.substring(h+1)),r.length>0)try{r=JSON.parse(r)}catch(v){t._passageMetadataError=!0}var d=c.lastIndexOf("["),g=c.lastIndexOf("]");if(-1!==d&&-1!==g&&(s=c.slice(d,g+1),c=c.substring(0,d)+c.substring(g+1)),s.length>0){s=s.substring(1,s.length-1);var m=[];if(""!==s&&(m=s.split(" ")),m.length>1){var f=[];m.forEach((function(e){f.push(e.trim())})),s=f}else if(1===m.length){var p=s;s=[],s.push(p)}else s=[]}else s=[];if(s=s.filter((function(e){return""!==e})),c=c.trim(),!(c.length>0))throw new Error("Malformed passage header!");l=c,t._passageMetadataError&&console.warn('Error parsing metadata for "'+l+'". It was ignored.'),a.push(new i(l,s,r,o,n)),n++}));var o=a.find((function(e){return"StoryTitle"===e.name}));if(void 0!==o?(this.story.name=o.text,a=a.filter((function(e){return"StoryTitle"!==e.name}))):this.story.name="Unknown",o=a.find((function(e){return"StoryData"===e.name})),void 0!==o){try{this.story.metadata=JSON.parse(o.text)}catch(l){this._storydataError=!0}a=a.filter((function(e){return"StoryData"!==e.name}))}this._storydataError&&console.warn("Error with processing StoryData JSON data. It was ignored."),this.story.passages=a}}]),e}();e.exports=o}}]);
//# sourceMappingURL=chunk-common.2cc6e3cd.js.map